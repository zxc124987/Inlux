"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[3710],{4865:function(t,e,s){s.d(e,{Z:function(){return u}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.totalLength,"current-page":t.currentPage},on:{"current-change":t.changePage}})],1)},r=[],o={name:"pagination1-component",props:["totalLength"],computed:{currentPage(){return this.$store.state.currentPage}},methods:{changePage(t){this.$emit("changePageHandler",t)}},mounted(){}},i=o,n=s(1001),l=(0,n.Z)(i,a,r,!1,null,"86225bf4",null),u=l.exports},1919:function(t,e,s){s.d(e,{Z:function(){return u}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-responsive"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.data,"row-key":t.getRowKeys,"default-sort":{prop:"id",order:"ascending"},"empty-text":"查無資料","cell-class-name":t.rowStyleHandler,border:"","highlight-current-row":""},on:{"selection-change":t.selectChangeHandler}},[t._t("custom-selection"),t._t("custom-checkbox1"),t._t("custom-checkbox2"),t._l(t.tableColumns,(function(s,a){return e("el-table-column",{key:a,attrs:{prop:s.id,label:s.label,width:s.width,sortable:"date"===s.id},scopedSlots:t._u([{key:"default",fn:function(a){return["status"===s.id?e("el-tag",{attrs:{type:"簽核通過"===a.row.status||"審核通過"===a.row.status?"success":"拒絕申請"===a.row.status?"danger":"草稿"===a.row.status?"warning":"查無資料"}},[t._v(" "+t._s(a.row.status)+" ")]):"status_Id"===s.id?e("el-tag",{attrs:{type:"OPEN"===a.row.status_Id?"":"CLOSE"===a.row.status_Id?"danger":"FULL"===a.row.status_Id?"warning":"success"}},[t._v(" "+t._s(t.getCourseState(a.row.status_Id))+" ")]):"description2"===s.id?e("el-tag",{attrs:{type:"有效課程"===a.row.description?"":"danger"}},[t._v(" "+t._s(a.row.description)+" ")]):"approve_Status"===s.id?e("el-tag",{attrs:{type:"0"===a.row.approve_Status?"":"1"===a.row.approve_Status?"success":"danger"}},[t._v(" "+t._s(t.getApproveStatus(a.row.approve_Status))+" ")]):"approve_Status2"===s.id?e("el-tag",{attrs:{type:"審核中"===a.row.approve_Status2||"未審核"===a.row.approve_Status2?"":"審核完畢"===a.row.approve_Status2||"審核同意"===a.row.approve_Status2?"success":"danger"}},[t._v(" "+t._s(a.row.approve_Status2)+" ")]):"attend_Status"===s.id?e("el-tag",{attrs:{type:"0"===a.row.attend_Status?"":"1"===a.row.attend_Status?"success":"danger"}},[t._v(" "+t._s(t.getAttendStatus(a.row.attend_Status))+" ")]):"issue_Card"===s.id?e("el-tag",{attrs:{type:"0"===a.row.issue_Card?"":"1"===a.row.issue_Card?"success":"danger"}},[t._v(" "+t._s(t.getIssueCardStatus(a.row.issue_Card))+" ")]):"signUpStatus"===s.id?e("el-tag",{attrs:{type:"已結案"===t.signUpStatus(a.row.signUpStatus,a.row.approveStatus)?"success":"可取消報名"===t.signUpStatus(a.row.signUpStatus,a.row.approveStatus)?"danger":""}},[t._v(" "+t._s(t.signUpStatus(a.row.signUpStatus,a.row.approveStatus))+" ")]):"file_Name"===s.id||"d_File_Name"===s.id?e("a",{attrs:{href:"#"},on:{click:function(e){return t.downloadPdf(a.row)}}},[t._v(t._s(a.row[s.id]))]):"protocolInfo"===s.id?e("div",[e("div",[t._v(t._s(a.row.po_Name))]),t._l(a.row.files,(function(s){return e("div",[e("a",{attrs:{href:"#"},on:{click:function(e){return t.downloadPdf(s)}}},[t._v(t._s(s.file_Name))])])}))],2):"useable"===s.id&&"已刪除(廠商不可申請每日工單)"===a.row.useable?e("span",{staticStyle:{color:"red"}},[t._v(t._s(a.row.useable))]):"deleted"===s.id?e("span",{class:{"text-danger":"1"===a.row.deleted}},[t._v(" "+t._s(a.row.effect)+" ")]):"array_data"===s.id?e("span",t._l(a.row[s.id],(function(s,a){return e("p",{key:a,staticClass:"mb-0"},[t._v(t._s(s))])})),0):RegExp(/\n/).test(a.row[a.column.property])?e("span",{staticStyle:{"white-space":"pre-wrap"}},[t._v(" "+t._s(a.row[s.id])+" ")]):e("span",[t._v(t._s(a.row[s.id]))])]}}],null,!0)})})),t._t("custom-edit-select"),t._t("custom-switch"),t._t("custom-function"),t._t("slot-sheet-open")],2)],1)},r=[],o={name:"table-component",props:["data","tableColumns"],data(){return{api:this.apiUrl,loading:!0}},methods:{selectChangeHandler(t){this.$emit("selectionChange",t)},downloadPdf(t){const e=t.file_Id;this.$emit("downloadPdfHandler",e),this.$emit("downloadPdfHandler2",t)},getRowKeys(t){return t.index?t.index:t.id},rowStyleHandler(t){if("1"===t.row.isWeekend||"1"===t.row.isNight)return"fontColorBlue"}},mounted(){this.data&&(this.loading=!1)}},i=o,n=s(1001),l=(0,n.Z)(i,a,r,!1,null,"4a0f1604",null),u=l.exports},3710:function(t,e,s){s.r(e),s.d(e,{default:function(){return p}});var a=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:this.$root.overlay,expression:"this.$root.overlay",modifiers:{fullscreen:!0,lock:!0}}]},[e("div",{staticClass:"form form-container wrapper"},[e("h2",{staticClass:"form-title"},[t._v("新增工作群組填表")]),e("el-card",{attrs:{shadow:"never"}},[e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules}},[e("el-form-item",{attrs:{label:"1. 工作群組名稱",prop:"group_name"}},[e("div",{staticClass:"directions"},[t._v("所有欄位必須輸入，最多10字元，請勿輸入特殊字元(‘,&,”,%)")]),e("el-input",{attrs:{placeholder:"請輸入"},model:{value:t.form.group_name,callback:function(e){t.$set(t.form,"group_name",e)},expression:"form.group_name"}})],1),e("el-form-item",{attrs:{label:"2. 選擇工作群組人員",prop:"workGroupList"}},[e("div",{staticClass:"directions"},[t._v("若無任何名單顯示，表示貴公司目前尚未建立任何員工資料")]),e("el-select",{attrs:{multiple:"",placeholder:"請選擇"},model:{value:t.form.workGroupList,callback:function(e){t.$set(t.form,"workGroupList",e)},expression:"form.workGroupList"}},t._l(t.head,(function(t){return e("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})})),1)],1),e("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(e){return t.resetForm("form")}}},[t._v("重設")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.submitForm("form")}}},[t._v("送出")])],1)],1)],1),e("div",{staticClass:"form form-container wrapper"},[e("h2",{staticClass:"form-title mt-4"},[t._v("目前工作群組清單")]),e("div",{staticClass:"mb-3",staticStyle:{"font-size":"16px"}},[t._v("工作群組組數上限為 20 組")]),t.selectedData&&t.selectedData.Groups.length?e("div",{staticClass:"d-flex align-items-center my-2 selected-box"},[e("span",[t._v("已選 "+t._s(t.selectedData.Groups.length)+" 項")]),e("el-popconfirm",{attrs:{title:"確定要刪除？"},on:{confirm:function(e){return t.confirmHandler()}}},[e("el-button",{staticClass:"ms-2",attrs:{slot:"reference",size:"small",type:"danger"},slot:"reference"},[t._v("刪除")])],1)],1):t._e(),e("TableComponent",{ref:"multipleTable",attrs:{data:t.tableList,tableColumns:t.tableColumns},on:{selectionChange:t.changeSelection},scopedSlots:t._u([{key:"custom-selection",fn:function(){return[e("el-table-column",{attrs:{type:"selection",width:"100","reserve-selection":!0}})]},proxy:!0}])}),e("PaginationComponent",{attrs:{totalLength:t.tableData.length},on:{changePageHandler:t.changePage}})],1)])},r=[],o=(s(7658),s(1919)),i=s(4865);const n=t=>{let e=/[!@#$%^&*()_+]/;return!e.test(t)};var l={name:"constructionGroupSettingComponent",components:{TableComponent:o.Z,PaginationComponent:i.Z},data(){let t=(t,e,s)=>{n(e)?s():s(new Error("不合法特殊字元[ ' &%]存在，請移除"))};return{selectedData:null,formData:[],form:{group_name:"",workGroupList:[]},rules:{group_name:[{required:!0,message:"必填",trigger:"blur"},{max:10,message:"最多10個字元",trigger:"blur"},{validator:t,trigger:"blur"}],workGroupList:[{required:!0,message:"必填",trigger:"change"}]},tableColumns:[{id:"index",label:"項次",width:"70"},{id:"group_Name",label:"工作群組名稱",width:"250"},{id:"groupPeople",label:"人員清單與安全衛生人員"}],head:[],tableData:[],tableList:[]}},computed:{},methods:{setForm(){this.form.workGroupList.forEach((t=>{const e={GROUP_NAME:this.form.group_name,ID:t,S_ID:this.getSid(t)};this.formData.push(e)}))},changeSelection(t){const e={Groups:[]};e.Groups.push(t),e.Groups=e.Groups.flat(),this.selectedData=e},async confirmHandler(){try{const t=await this.$store.dispatch("delGroupList",this.selectedData);t.data.isOK&&(this.getGroupList(),this.$message({type:"success",duration:5e3,showClose:!0,message:"刪除成功"}),this.$refs.multipleTable.$refs.multipleTable.clearSelection(),this.$store.state.currentPage=1)}catch(t){console.log(t)}},changePage(t){this.$store.state.currentPage=t;const e=10*(t-1),s=10*t;this.tableList=this.tableData.slice(e,s)},getSid(t){const e=this.head.find((e=>e.id===t)).s_Id;return e},async getGroupList(){try{const t=await this.$store.dispatch("getGroupList"),e=t.data.data;this.head=e.head,this.head.forEach((t=>t.label=`${t.p_Name}(${t.id})`)),this.tableData=JSON.parse(JSON.stringify(e.list)),this.tableData.forEach(((t,e)=>{t.index=e+1;const s=t.person_List.map((t=>t.p_Name)),a=s.filter((t=>null!==t&&void 0!==t));t.groupPeople=a,t.groupPeople=t.groupPeople.join()})),this.tableList=this.tableData.slice(0,10)}catch(t){console.log(t)}},resetForm(t){this.$refs[t].resetFields()},submitForm(t){this.setForm(),this.$refs[t].validate((async e=>{if(e)try{const e=await this.$store.dispatch("insGroup",this.formData);e.data.isOK&&(this.getGroupList(),this.resetForm(t),this.$message({type:"success",duration:5e3,showClose:!0,message:"成功"}),this.$refs.multipleTable.$refs.multipleTable.clearSelection(),this.$store.state.currentPage=1)}catch(s){console.log(s)}else this.$message({type:"error",showClose:!0,message:"資料填寫錯誤"})}))}},mounted(){this.$store.state.currentPage=1,this.getGroupList(),this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0}},u=l,c=s(1001),d=(0,c.Z)(u,a,r,!1,null,"63d7d5bb",null),p=d.exports}}]);
//# sourceMappingURL=3710.95dd01d8a8045f86.js.map