"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[106],{7163:function(e,t,r){r.d(t,{Z:function(){return p}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"upload"},[t("el-upload",{ref:"Upload",staticClass:"upload-demo",attrs:{limit:e.limitNumber,action:e.uploadAction,"auto-upload":!1,"on-change":e.changeHandler,"on-remove":e.removeHandler}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上傳檔案")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.uploadTipText))])],1)],1)},a=[],o=r(942),l={name:"upload-component",data(){return{}},props:{uploadTipText:{type:[String],default:"檔案格式為PDF，在2MB以內"},uploadAction:{type:[String],default:o.apiUrl},limitNumber:{type:Number,default:1}},methods:{changeHandler(e,t){this.$emit("fileChangeHandler",t)},removeHandler(e,t){this.$emit("fileRemoveHandler",t)}},mounted(){}},i=l,n=r(1001),c=(0,n.Z)(i,s,a,!1,null,"442b61f1",null),p=c.exports},106:function(e,t,r){r.r(t),r.d(t,{default:function(){return p}});var s=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:this.$root.overlay,expression:"this.$root.overlay",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"newProjectApplication"},[t("div",{staticClass:"form form-container wrapper"},[t("h2",{staticClass:"form-title"},[e._v("新增工程表單")]),t("el-card",{attrs:{shadow:"never"}},[t("el-row",{staticClass:"info"},[t("el-col",{attrs:{span:8}},[t("div",{staticClass:"form-group"},[t("label",{staticClass:"me-2",attrs:{for:""}},[e._v("工程編號：")]),e.projectNumber?t("span",[e._v(e._s(e.projectNumber))]):e._e()])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"form-group"},[t("label",{staticClass:"me-2",attrs:{for:""}},[e._v("建立者：")]),t("span",[e._v(e._s(this.$store.state.loginName))])])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"form-group"},[t("label",{staticClass:"me-2",attrs:{for:""}},[e._v("建立日期：")]),t("span",[e._v(e._s(e.createDate))])])])],1),t("el-form",{ref:"form",attrs:{"label-position":"top",model:e.form,rules:e.rules}},[t("el-row",[t("el-col",{attrs:{span:3}},[t("h3",{staticClass:"row-title"},[e._v("基本資訊")])]),t("el-col",{attrs:{span:21}},[t("el-form-item",{attrs:{label:"工程名稱",prop:"project_Name"}},[t("div",{staticClass:"directions"},[e._v("若工程名稱與以前資料相同，請再附加日期以供區別。")]),t("el-input",{attrs:{placeholder:"請輸入",clearable:""},model:{value:e.form.project_Name,callback:function(t){e.$set(e.form,"project_Name",t)},expression:"form.project_Name"}})],1),t("div",{staticClass:"form-item-inline"},[t("el-form-item",{staticClass:"me-3",attrs:{label:"廠區名稱",prop:"LD1"}},[t("el-select",{attrs:{clearable:"",placeholder:"請選擇"},model:{value:e.form.LD1,callback:function(t){e.$set(e.form,"LD1",t)},expression:"form.LD1"}},e._l(e.location,(function(e){return t("el-option",{key:e.ld1,attrs:{label:e.ld2,value:e.ld1}})})),1)],1),t("el-form-item",{attrs:{label:"無塵室/非無塵室",prop:"Loaction_Type"}},[t("el-select",{attrs:{clearable:"",placeholder:"請選擇"},model:{value:e.form.Loaction_Type,callback:function(t){e.$set(e.form,"Loaction_Type",t)},expression:"form.Loaction_Type"}},e._l(e.location_Type,(function(e){return t("el-option",{key:e.id,attrs:{label:e.description,value:e.id}})})),1)],1)],1),t("el-form-item",{attrs:{prop:"FloorId"}},[t("label",{staticClass:"required",attrs:{for:""}},[e._v("FAB 廠別/區域 (依上方選項帶出施工區域)")]),t("div",{staticClass:"directions"},[e._v("可複選施工區域，複選後系統依申請區域自動生成不同張工程單號進行簽核")]),this.form.LD1&&this.form.Loaction_Type?t("el-checkbox-group",{staticClass:"d-flex flex-wrap",model:{value:e.form.FloorId,callback:function(t){e.$set(e.form,"FloorId",t)},expression:"form.FloorId"}},e._l(e.fabApproveList,(function(r){return t("el-checkbox",{key:r.id,attrs:{label:r.id}},[e._v(e._s(r.floor))])})),1):e._e()],1)],1)],1),t("el-row",{staticClass:"highRiskWork"},[t("el-col",{attrs:{span:3}},[t("h3",{staticClass:"row-title"},[e._v("作業選項")])]),t("el-col",{attrs:{span:21}},[t("el-form-item",{staticClass:"mb-2"},[t("label",[e._v("高風險作業")]),t("ul",{staticClass:"notice"},[t("p",{staticClass:"notice-title mb-1"},[e._v("注意事項：")]),t("li",[e._v("請依據承攬商工程需求及工程前安全會議，勾選本工程會進行之高風險作業")]),t("li",[e._v("勾選之項目，將與施工單連結，未勾選之高風險作業項目，每日工作許可單將不得申請")]),t("li",[e._v("請再次確認高風險作業項目是否確實勾選，本單送出後，高風險作業項目不得異動，若需異動者，煩請重新開單")])])]),e._l(e.workTypeClassList,(function(r,s){return t("el-form-item",{key:s},[t("el-form-item",{attrs:{prop:"Work_Type_Class"}},[t("label",[e._v(e._s(r.class_Pk)+". "+e._s(r.class_Name))]),t("el-checkbox-group",{model:{value:e.form.Work_Type_Class,callback:function(t){e.$set(e.form,"Work_Type_Class",t)},expression:"form.Work_Type_Class"}},e._l(r.details,(function(r){return t("el-checkbox",{key:r.work_Type_Pk,staticClass:"d-flex",attrs:{label:r.work_Type_Pk},on:{change:function(t){e.highRiskWorkChangeHandler(),e.file2ChangeHandler(t,r)}}},[e._v(e._s(r.work_Type_Name)+"("+e._s(r.description)+") ")])})),1)],1)],1)})),e.workTypeClassOtherList?t("el-form-item",{attrs:{prop:"Work_Type_Class_Other"}},[t("label",[e._v(e._s(e.workTypeClassOtherList.class_Pk)+". "+e._s(e.workTypeClassOtherList.class_Name))]),t("el-checkbox-group",{model:{value:e.form.Work_Type_Class_Other,callback:function(t){e.$set(e.form,"Work_Type_Class_Other",t)},expression:"form.Work_Type_Class_Other"}},e._l(e.workTypeClassOtherList.details,(function(r){return t("el-checkbox",{key:r.work_Type_Pk,staticClass:"d-flex",attrs:{label:r.work_Type_Pk},on:{change:function(t){e.highRiskWorkChangeHandler(),e.file2ChangeHandler(t,r)}}},[e._v(e._s(r.work_Type_Name)+"("+e._s(r.description)+") ")])})),1)],1):e._e()],2)],1),t("el-row",[t("el-col",{attrs:{span:3}},[t("div",{staticClass:"row-title"},[e._v("內容設定")])]),t("el-col",{attrs:{span:21}},[t("el-form-item",{attrs:{label:"工程內容",prop:"Description"}},[t("el-input",{attrs:{placeholder:"請輸入",clearable:""},model:{value:e.form.Description,callback:function(t){e.$set(e.form,"Description",t)},expression:"form.Description"}})],1),t("el-form-item",{attrs:{prop:"date"}},[t("label",{staticClass:"required",attrs:{for:""}},[e._v("工程開始～結束日期")]),t("p",{staticClass:"directions mb-0"},[e._v("施工期限最大一年 (含展延)")]),t("p",{staticClass:"directions"},[e._v("如「重新」申請工程時應「重新開立」工程前安全會議，不得沿用前年度之會議記錄")]),t("el-date-picker",{attrs:{type:"daterange","range-separator":"~","start-placeholder":"開始日期","end-placeholder":"結束日期","picker-options":e.pickerOptions},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1),t("el-form-item",{attrs:{label:"主承包商公司名稱",prop:"S_Id"}},[t("el-select",{attrs:{remote:"",clearable:"",filterable:"","reserve-keyword":"",placeholder:"輸入關鍵字",loading:e.sIdLoading,disabled:!this.form.LD1,"loading-text":"載入中","no-data-text":"查無資料"},on:{"visible-change":e.sidVisibleChange},nativeOn:{keyup:function(t){return e.sIdSearchHandler(t)}},model:{value:e.form.S_Id,callback:function(t){e.$set(e.form,"S_Id",t)},expression:"form.S_Id"}},e._l(e.supplier1,(function(e){return t("el-option",{key:e.s_Id,attrs:{label:e.s_Name,value:e.s_Id}})})),1),t("p",{staticClass:"note mb-0 mt-1"},[e._v(e._s(e.$store.state.remoteSearchNote))])],1),t("el-form-item",{attrs:{label:"下包商公司名稱"}},[t("el-select",{attrs:{remote:"",multiple:"",clearable:"",filterable:"","reserve-keyword":"",placeholder:"輸入關鍵字",loading:e.sId2Loading,disabled:!this.form.LD1,"loading-text":"載入中","no-data-text":"查無資料"},on:{"visible-change":e.sid2VisibleChange},nativeOn:{keyup:function(t){return e.sId2SearchHandler(t)}},model:{value:e.form.S_Id2,callback:function(t){e.$set(e.form,"S_Id2",t)},expression:"form.S_Id2"}},e._l(e.supplier2,(function(e){return t("el-option",{key:e.s_Id,attrs:{label:e.s_Name,value:e.s_Id}})})),1),t("p",{staticClass:"note mb-0 mt-1"},[e._v(e._s(e.$store.state.remoteSearchNote))])],1),t("el-form-item",{attrs:{label:"工程單請求編號",prop:"Project_Apply"}},[t("el-form-item",[t("el-radio",{staticClass:"mb-2",attrs:{label:"1"},on:{change:function(t){return e.engineerOrderNumberHandler(t)}},model:{value:e.form.Project_Apply,callback:function(t){e.$set(e.form,"Project_Apply",t)},expression:"form.Project_Apply"}},[e._v("廠務發包工程")])],1),t("el-form-item",[t("el-radio",{attrs:{label:"2"},on:{change:function(t){return e.engineerOrderNumberHandler(t)}},model:{value:e.form.Project_Apply,callback:function(t){e.$set(e.form,"Project_Apply",t)},expression:"form.Project_Apply"}},[e._v(" 非廠務發包工程")])],1),"1"===e.form.Project_Apply?t("el-form-item",{staticClass:"mb-3",attrs:{prop:"Project_Apply_No"}},[t("div",{staticClass:"directions"},[e._v("廠務發包工程請填入工程申請單號")]),t("el-input",{attrs:{placeholder:"請輸入"},model:{value:e.form.Project_Apply_No,callback:function(t){e.$set(e.form,"Project_Apply_No",t)},expression:"form.Project_Apply_No"}})],1):e._e(),"2"===e.form.Project_Apply?t("el-form-item",{staticClass:"mb-3",attrs:{prop:"Project_Apply_Remark"}},[t("div",{staticClass:"directions"},[e._v("非廠務發包工程請於下方欄位填入非廠務發包工程")]),t("el-input",{attrs:{placeholder:"請輸入"},model:{value:e.form.Project_Apply_Remark,callback:function(t){e.$set(e.form,"Project_Apply_Remark",t)},expression:"form.Project_Apply_Remark"}})],1):e._e()],1),t("el-form-item",{attrs:{label:"確認",prop:"confirm"}},[t("el-checkbox-group",{model:{value:e.form.confirm,callback:function(t){e.$set(e.form,"confirm",t)},expression:"form.confirm"}},[t("el-checkbox",{attrs:{name:"confirm"}},[e._v("本發包工程已召集有關部門人員完成工程前安會議，並留存紀錄")])],1)],1),t("el-form-item",{attrs:{label:"工程前安全會議紀錄",prop:"File1"}},[t("upload",{ref:"File1",on:{fileChangeHandler:e.meetRecordFileChangeHandler,fileRemoveHandler:e.meetRecordFileRemoveHandler}})],1),t("el-form-item",{attrs:{label:"施工防護計畫書",prop:"File2"}},[t("upload",{ref:"File2",on:{fileChangeHandler:e.constructionPlanChangeHandler,fileRemoveHandler:e.constructionPlanRemoveHandler}})],1),t("el-form-item",{attrs:{label:"本工程單是否為營建工程",prop:"Isbuild"}},[t("el-radio-group",{model:{value:e.form.Isbuild,callback:function(t){e.$set(e.form,"Isbuild",t)},expression:"form.Isbuild"}},[t("div",{staticClass:"mb-2"},[t("el-radio",{attrs:{label:"0"}},[e._v("是，請與各廠環安處窗口聯絡")])],1),t("div",[t("el-radio",{attrs:{label:"1"}},[e._v("否")])],1)])],1),t("el-form-item",{attrs:{label:"每日工作申請單發包工程師代簽人員",prop:"Signer"}},[t("div",{staticClass:"directions"},[e._v("最多 3 人")]),t("el-select",{ref:"remote",attrs:{multiple:"",clearable:"",filterable:"",remote:"","multiple-limit":3,"reserve-keyword":"",placeholder:"輸入關鍵字",loading:e.signerLoading},on:{"visible-change":e.visibleHandleChange},nativeOn:{keyup:function(t){return e.signerSearchHandler(t)}},model:{value:e.form.Signer,callback:function(t){e.$set(e.form,"Signer",t)},expression:"form.Signer"}},e._l(e.signerList,(function(e){return t("el-option",{key:e.EMP_NO,attrs:{label:e.customLabel,value:e.EMP_NO}})})),1),t("p",{staticClass:"note mb-0 mt-1"},[e._v(e._s(e.$store.state.remoteSearchNote))])],1)],1)],1)],1)],1)],1),t("div",{staticClass:"position-fixed"},[t("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){return e.resetForm("form")}}},[e._v("重設")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v("送出")])],1)])},a=[],o=(r(7658),r(7163)),l={name:"newProjectApplication-component",components:{upload:o.Z},data(){let e=(e,t,r)=>{if(t){const e=t[0].getTime(),s=t[1].getTime();e+31536e6<s?r(new Error("施工期限最大一年 ")):r()}else r(new Error("必填"))};return{createDate:this.formatDate(new Date),signerLoading:!1,sIdLoading:!1,sId2Loading:!1,projectNumber:"",supplier1:[],supplier2:[],workTypeLists:[],form:{project_Name:"",LD1:"",Loaction_Type:"",FloorId:[],Work_Type_Class:[],Work_Type_Class_Other:[],Description:"",date:"",S_Id:"",S_Id2:[],Project_Apply:"",Project_Apply_No:"",Project_Apply_Remark:"",confirm:[],File1:null,File2:null,Isbuild:"",Signer:[]},rules:{project_Name:[{required:!0,message:"必填",trigger:"blur"}],LD1:[{required:!0,message:"必填",trigger:"change"}],Loaction_Type:[{required:!0,message:"必填",trigger:"change"}],FloorId:[{required:!0,message:"必填",trigger:"change"}],Work_Type_Class:[{required:!1,message:"必填",trigger:"change"}],Work_Type_Class_Other:[{required:!1,message:"必填",trigger:"change"}],Description:[{required:!0,message:"必填",trigger:"blur"}],date:[{required:!0,message:"必填",trigger:"change"}],S_Id:[{required:!0,message:"必填",trigger:"change"}],Project_Apply:[{required:!1}],Project_Apply_No:[{required:!1,message:"必填",trigger:"change"}],Project_Apply_Remark:[{required:!0,message:"必填",trigger:"blur"}],confirm:[{required:!0,message:"必填",trigger:"change"}],File1:[{required:!0,message:"必填",trigger:"change"}],File2:[{required:!1,message:"必填",trigger:"change"}],Isbuild:[{required:!0,message:"必填",trigger:"change"}],Signer:[{required:!1,message:"必填",trigger:"change"}]},pickerOptions:{onPick:({maxDate:t,minDate:r})=>{t&&(this.rules.date={validator:e,trigger:"change"})}},fabApprove:[],location:[],location_Type:[],work_Type_Class:[],signerList:[]}},computed:{fabApproveList(){const e=this.fabApprove.filter((e=>e.ld1===Number(this.form.LD1)&&e.typeId===Number(this.form.Loaction_Type)));return e},workTypeClassList(){this.work_Type_Class.forEach(((e,t)=>{e.highRiskWorkNumber=`highRiskWork_${t+1}`}));let e=JSON.parse(JSON.stringify(this.work_Type_Class));return e.pop(),e},workTypeClassOtherList(){let e=JSON.parse(JSON.stringify(this.work_Type_Class));const t=e.pop();return t}},methods:{engineerOrderNumberHandler(e){"2"===e?(this.form.Project_Apply_No="",this.rules.Project_Apply_Remark=[{required:!0,message:"必填",trigger:"blur"}],this.rules.Project_Apply=[{required:!0,message:"必填",trigger:"blur"}]):(this.form.Project_Apply_Remark="",this.rules.Project_Apply_Remark=[],this.rules.Project_Apply=[],this.$refs.form.clearValidate("Project_Apply_No"))},submitForm(e){this.$refs[e].validate((async e=>{if(e){const e={project_Name:this.form.project_Name,Signer:this.form.Signer,LD1:this.form.LD1,Loaction_Type:this.form.Loaction_Type,FloorId:this.form.FloorId,Work_Type_Pk:this.form.Work_Type_Class.concat(this.form.Work_Type_Class_Other),Description:this.form.Description,Begin_Date:this.formatDate(this.form.date[0]),End_Date:this.formatDate(this.form.date[1]),S_Id:this.form.S_Id,S_Id2:this.form.S_Id2,Project_Apply_No:this.form.Project_Apply_No,Project_Apply_Remark:this.form.Project_Apply_Remark,Isbuild:this.form.Isbuild,File1:this.form.File1,File2:this.form.File2};this.addNewProjectApplication(e)}else this.$message({type:"error",duration:"5000",showClose:!0,message:"資料填寫錯誤"}),this.highRiskWorkChangeHandler()}))},resetForm(e){this.$refs[e].resetFields()},highRiskWorkChangeHandler(){this.form.Work_Type_Class.length||this.form.Work_Type_Class_Other.length?(this.rules.Work_Type_Class=[],this.rules.Work_Type_Class_Other=[],this.$refs.form.clearValidate("Work_Type_Class"),this.$refs.form.clearValidate("Work_Type_Class_Other")):(this.rules.Work_Type_Class=[{required:!1,message:"必填",trigger:"change"}],this.rules.Work_Type_Class_Other=[{required:!1,message:"必填",trigger:"change"}],this.$refs.form.validateField("Work_Type_Class"),this.$refs.form.validateField("Work_Type_Class_Other"))},file2ChangeHandler(e,t){e?this.workTypeLists.push(t):this.workTypeLists=this.workTypeLists.filter((e=>e.work_Type_Pk!==t.work_Type_Pk));const r=this.workTypeLists.some((e=>"Y"===e.cp_Plan));r?this.rules.File2=[{required:!0,message:"必填",trigger:"change"}]:(this.rules.File2=[],this.$refs.form.clearValidate("File2"))},meetRecordFileChangeHandler(e){const t=e[0].size>2097152,r=e[0].raw.type,s="application/pdf"===r;t||!s?(this.$message({type:"error",duration:5e3,showClose:!0,message:"檔案不可大於2MB且檔案格式必須為PDF"}),this.$refs.File1.$refs.Upload.clearFiles()):(this.form.File1=e[0].raw,this.$refs.form.clearValidate("File1"))},meetRecordFileRemoveHandler(e){this.form.File1=e,this.$refs.form.validateField("File1")},constructionPlanChangeHandler(e){const t=e[0].size>2097152,r=e[0].raw.type,s="application/pdf"===r;t||!s?(this.$message({type:"error",duration:5e3,showClose:!0,message:"檔案不可大於2MB且檔案格式必須為PDF"}),this.$refs.File2.$refs.Upload.clearFiles()):(this.form.File2=e[0].raw,this.$refs.form.clearValidate("File2"))},constructionPlanRemoveHandler(e){this.form.File2=e,this.$refs.form.validateField("File2")},visibleHandleChange(e){e||(this.signerList=[],this.$refs.remote.query="")},signerSearchHandler(e){this.signerLoading=!0,"Enter"!==e.code&&"NumpadEnter"!==e.code||this.throttledSignerSearch(e)},searchSigner(e){this.signerLoading=!1,e.target.value&&this.getSigner(e.target.value)},sidVisibleChange(e){e||(this.supplier1=[])},sIdSearchHandler(e){this.sIdLoading=!0,"Enter"!==e.code&&"NumpadEnter"!==e.code||this.throttledSIdSearch(e)},searchSupplier(e){this.sIdLoading=!1,e.target.value?this.getSupplier(e.target.value):this.supplier1=[]},async getSupplier(e){const t=await this.$store.dispatch("getSupplier",{query:e,id:this.form.LD1});this.supplier1=t.data.data},sid2VisibleChange(e){e||(this.supplier2=[])},sId2SearchHandler(e){this.sId2Loading=!0,"Enter"!==e.code&&"NumpadEnter"!==e.code||this.throttledSId2Search(e)},searchSupplier2(e){this.sId2Loading=!1,e.target.value?this.getSupplier2(e.target.value):this.supplier2=[]},async getSupplier2(e){const t=await this.$store.dispatch("getSupplier2",{query:e,id:this.form.LD1});this.supplier2=t.data.data},async addNewProjectApplication(e){try{var t=await this.$store.dispatch("addNewProjectApplication",e);this.$message({type:"success",duration:5e3,showClose:!0,message:`成功: ${t.data.data.msg}`}),this.$router.push({name:"engineeringDataManagement"}),t.data.data.msg.split(":")[1]&&(this.projectNumber=t.data.data.msg.split(":")[1])}catch(r){console.log(r)}},async getNewBillNo(){const e=await this.$store.dispatch("getNewBillNo"),t=e.data.data;this.fabApprove=t.fab_Approve,this.location=t.location,this.location_Type=t.location_Type,this.work_Type_Class=t.work_Type_Class},async getSigner(e){const t=await this.$store.dispatch("getSigner",e),r=t.data.data;this.signerList=r,this.signerList.forEach((e=>e.customLabel=`${e.EMP_NO}_${e.NAME}`))},throttledSId2Search:null,throttledSignerSearch:null,throttledSIdSearch:null},async mounted(){this.getNewBillNo(),this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0;const e=document.querySelector(".position-fixed"),t=e.offsetHeight,r=document.querySelector(".form");r.style.marginBottom=`${t}px`},created(){this.throttledSId2Search=this.throttle(this.searchSupplier2,2500,!1),this.throttledSignerSearch=this.throttle(this.searchSigner,1500,!1),this.throttledSIdSearch=this.throttle(this.searchSupplier,2500,!1)}},i=l,n=r(1001),c=(0,n.Z)(i,s,a,!1,null,null,null),p=c.exports}}]);
//# sourceMappingURL=106.78098a4028f0ee8c.js.map