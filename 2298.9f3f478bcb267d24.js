"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[2298],{4865:function(t,e,a){a.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.totalLength,"current-page":t.currentPage},on:{"current-change":t.changePage}})],1)},n=[],o={name:"pagination1-component",props:["totalLength"],computed:{currentPage(){return this.$store.state.currentPage}},methods:{changePage(t){this.$emit("changePageHandler",t)}},mounted(){}},i=o,r=a(1001),l=(0,r.Z)(i,s,n,!1,null,"86225bf4",null),c=l.exports},1919:function(t,e,a){a.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-responsive"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.data,"row-key":t.getRowKeys,"default-sort":{prop:"id",order:"ascending"},"empty-text":"查無資料","cell-class-name":t.rowStyleHandler,border:"","highlight-current-row":""},on:{"selection-change":t.selectChangeHandler}},[t._t("custom-selection"),t._t("custom-checkbox1"),t._t("custom-checkbox2"),t._l(t.tableColumns,(function(a,s){return e("el-table-column",{key:s,attrs:{prop:a.id,label:a.label,width:a.width,sortable:"date"===a.id},scopedSlots:t._u([{key:"default",fn:function(s){return["status"===a.id?e("el-tag",{attrs:{type:"簽核通過"===s.row.status||"審核通過"===s.row.status?"success":"拒絕申請"===s.row.status?"danger":"草稿"===s.row.status?"warning":"查無資料"}},[t._v(" "+t._s(s.row.status)+" ")]):"status_Id"===a.id?e("el-tag",{attrs:{type:"OPEN"===s.row.status_Id?"":"CLOSE"===s.row.status_Id?"danger":"FULL"===s.row.status_Id?"warning":"success"}},[t._v(" "+t._s(t.getCourseState(s.row.status_Id))+" ")]):"description2"===a.id?e("el-tag",{attrs:{type:"有效課程"===s.row.description?"":"danger"}},[t._v(" "+t._s(s.row.description)+" ")]):"approve_Status"===a.id?e("el-tag",{attrs:{type:"0"===s.row.approve_Status?"":"1"===s.row.approve_Status?"success":"danger"}},[t._v(" "+t._s(t.getApproveStatus(s.row.approve_Status))+" ")]):"approve_Status2"===a.id?e("el-tag",{attrs:{type:"審核中"===s.row.approve_Status2||"未審核"===s.row.approve_Status2?"":"審核完畢"===s.row.approve_Status2||"審核同意"===s.row.approve_Status2?"success":"danger"}},[t._v(" "+t._s(s.row.approve_Status2)+" ")]):"attend_Status"===a.id?e("el-tag",{attrs:{type:"0"===s.row.attend_Status?"":"1"===s.row.attend_Status?"success":"danger"}},[t._v(" "+t._s(t.getAttendStatus(s.row.attend_Status))+" ")]):"issue_Card"===a.id?e("el-tag",{attrs:{type:"0"===s.row.issue_Card?"":"1"===s.row.issue_Card?"success":"danger"}},[t._v(" "+t._s(t.getIssueCardStatus(s.row.issue_Card))+" ")]):"signUpStatus"===a.id?e("el-tag",{attrs:{type:"已結案"===t.signUpStatus(s.row.signUpStatus,s.row.approveStatus)?"success":"可取消報名"===t.signUpStatus(s.row.signUpStatus,s.row.approveStatus)?"danger":""}},[t._v(" "+t._s(t.signUpStatus(s.row.signUpStatus,s.row.approveStatus))+" ")]):"file_Name"===a.id||"d_File_Name"===a.id?e("a",{attrs:{href:"#"},on:{click:function(e){return t.downloadPdf(s.row)}}},[t._v(t._s(s.row[a.id]))]):"protocolInfo"===a.id?e("div",[e("div",[t._v(t._s(s.row.po_Name))]),t._l(s.row.files,(function(a){return e("div",[e("a",{attrs:{href:"#"},on:{click:function(e){return t.downloadPdf(a)}}},[t._v(t._s(a.file_Name))])])}))],2):"useable"===a.id&&"已刪除(廠商不可申請每日工單)"===s.row.useable?e("span",{staticStyle:{color:"red"}},[t._v(t._s(s.row.useable))]):"deleted"===a.id?e("span",{class:{"text-danger":"1"===s.row.deleted}},[t._v(" "+t._s(s.row.effect)+" ")]):"array_data"===a.id?e("span",t._l(s.row[a.id],(function(a,s){return e("p",{key:s,staticClass:"mb-0"},[t._v(t._s(a))])})),0):RegExp(/\n/).test(s.row[s.column.property])?e("span",{staticStyle:{"white-space":"pre-wrap"}},[t._v(" "+t._s(s.row[a.id])+" ")]):e("span",[t._v(t._s(s.row[a.id]))])]}}],null,!0)})})),t._t("custom-edit-select"),t._t("custom-switch"),t._t("custom-function"),t._t("slot-sheet-open")],2)],1)},n=[],o={name:"table-component",props:["data","tableColumns"],data(){return{api:this.apiUrl,loading:!0}},methods:{selectChangeHandler(t){this.$emit("selectionChange",t)},downloadPdf(t){const e=t.file_Id;this.$emit("downloadPdfHandler",e),this.$emit("downloadPdfHandler2",t)},getRowKeys(t){return t.index?t.index:t.id},rowStyleHandler(t){if("1"===t.row.isWeekend||"1"===t.row.isNight)return"fontColorBlue"}},mounted(){this.data&&(this.loading=!1)}},i=o,r=a(1001),l=(0,r.Z)(i,s,n,!1,null,"4a0f1604",null),c=l.exports},2298:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var s=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:this.$root.overlay,expression:"this.$root.overlay",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"wrapper"},[e("div",{staticClass:"container mw-100 p-0"},[e("div",{staticClass:"d-flex align-items-center"},[t._m(0),e("div",{staticClass:"col-4"},[e("el-input",{staticClass:"search-text",attrs:{placeholder:"Search","prefix-icon":"el-icon-search",clearable:""},nativeOn:{keyup:function(e){return t.searchInput(e)}},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)])]),e("tableComponent",{attrs:{data:t.tableList,tableColumns:t.tableColumns},scopedSlots:t._u([{key:"custom-function",fn:function(){return[e("el-table-column",{attrs:{prop:"function",label:"操作",fixed:"right",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[0===a.row.deleted?e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刪除",placement:"top-start"}},[e("el-popconfirm",{attrs:{title:"確定刪除此筆資料嗎?","cancel-button-type":"plain"},on:{confirm:function(e){return t.dialogSwitchHandler(a.row.project_No)}}},[e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e("i",{staticClass:"el-icon-document"})])],1)],1):e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"取消刪除",placement:"top-start"}},[e("el-popconfirm",{attrs:{title:"確定取消刪除此筆資料嗎?","cancel-button-type":"plain"},on:{confirm:function(e){return t.dialogSwitchHandler(a.row.project_No)}}},[e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e("i",{staticClass:"el-icon-document"})])],1)],1),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"工程明細",placement:"top-start"}},[e("el-button",{attrs:{type:"text"}},[e("router-link",{attrs:{to:{name:"engineeringDetails",params:{prjNo:a.row.project_No}}}},[e("i",{staticClass:"el-icon-document"})])],1)],1),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"修改",placement:"top-start"}},[e("el-button",{attrs:{type:"text"}},[a.row.Id?e("router-link",{attrs:{to:{name:"engineeringDataManagementEdit",params:{prjNo:a.row.project_No,id:a.row.Id}}}},[e("i",{staticClass:"el-icon-document"})]):t._e()],1)],1),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"檢視簽核明細",placement:"top-start"}},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.hintDialog(a.row.project_No)}}},[e("i",{staticClass:"el-icon-document"})])],1)]}}])})]},proxy:!0}])}),e("Pagination1",{attrs:{totalLength:t.tableData.length},on:{changePageHandler:t.changePage}}),e("el-dialog",{staticStyle:{top:"20vmin"},attrs:{title:"提示",visible:t.dialogHint,width:"40%"},on:{"update:visible":function(e){t.dialogHint=e},close:function(e){return t.cancelHintDialog()}}},[e("span",[t._v("請先檢視工程前安全會議紀錄再進行簽核動作")]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.intoViewSignOffDetails()}}},[t._v("確定")])],1)])],1)},n=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"col"},[e("h2",{staticClass:"form-title"},[t._v("工程資料管理")]),e("div",{staticClass:"form-text"},[t._v("工程申請簽核流程：發包工程師 ➞ 直屬主管 ➞ 工作場所負責人 ➞ 環安工安")]),e("div",{staticClass:"directions"},[t._v("僅顯示以 [工程開始日期] 之過去13個月以內(約400天)之工程申請單")])])}],o=a(1919),i=a(4865);const r=t=>t.toString().toLowerCase(),l=(t,e)=>e?t.filter((t=>r(t.proj).includes(r(e))||r(t.period).includes(r(e))||r(t.region).includes(r(e))||r(t.contract_count).includes(r(e))||r(t.status).includes(r(e))||r(t.useable).includes(r(e)))):t;var c={name:"engineeringDataManagement-component",components:{tableComponent:o.Z,Pagination1:i.Z},data(){return{search:"",tableColumns:[{id:"index",label:"項次",width:"50"},{id:"proj",label:"工程編號 (工程名稱)",width:"300"},{id:"period",label:"建立日期 (開始 ~ 結束日期)",width:"220"},{id:"region",label:"工作區域",width:"300"},{id:"contract_count",label:"總/下包廠商數",width:"125"},{id:"status",label:"工程狀態",width:"150"},{id:"useable",label:"可用狀態",width:"150"}],data:[],tableData:[],tableList:[],dialogHint:!1,dialogHintId:0}},methods:{async getEngineeringData(){try{const t=await this.$store.dispatch("getEngineeringData"),e=t.data.data;this.data=JSON.parse(JSON.stringify(e)),this.data.forEach(((t,e)=>{t.index=e+1,t.proj=`${t.project_No} (${t.project_Name})`,t.period=`${t.create_Date} (${t.begin_Date} ~ ${t.end_Date})`,t.region=`${t.LD2} / ${t.LD1} / ${t.LD4} / ${t.LD3} / ${t.floor}`,t.contract_count=`${t.tcount}家/${t.scount}家`,t.status=this.convertStatus(t.project_Status),t.useable=1==t.deleted?"已刪除(廠商不可申請每日工單)":"WAITAPP"==t.project_Status?"簽核中":"APPROVE"==t.project_Status?"廠商可申請每日施工單":"廠商不可申請每日工單"})),this.tableData=this.data,this.tableList=this.tableData.slice(0,10)}catch(t){console.log(t)}},searchInput(t){if("Enter"===t.code||"NumpadEnter"===t.code){const e=t.target.value;this.tableData=l(this.data,e),this.tableList=this.tableData.slice(0,10),this.$store.state.currentPage=1}},async dialogSwitchHandler(t){try{let e=await this.$store.dispatch("switchEngineeringData",t);e.data.isOK&&(this.$message({type:"success",duration:"5000",showClose:!0,message:"操作成功"}),this.getEngineeringData(),this.$store.state.currentPage=1)}catch(e){console.log(e)}},hintDialog(t){this.dialogHint=!0,this.dialogHintId=t},cancelHintDialog(){this.dialogHint=!1},async intoViewSignOffDetails(){this.dialogHint=!1;let t=[];try{const e=await this.$store.dispatch("getProjDetail",this.dialogHintId),a=await this.$store.dispatch("getSignOffHistory",this.dialogHintId);t=[e.data.data,a.data.data]}catch(a){console.log(a)}const{href:e}=this.$router.resolve({path:"/viewSignOffDetails",query:{data:JSON.stringify(t)}});window.open(e,"_blank")},changePage(t){this.$store.state.currentPage=t;const e=10*(t-1),a=10*t;this.tableList=this.tableData.slice(e,a)}},async mounted(){this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0,this.getEngineeringData(),this.$store.state.currentPage=1}},d=c,u=a(1001),p=(0,u.Z)(d,s,n,!1,null,"14885a47",null),g=p.exports}}]);
//# sourceMappingURL=2298.9f3f478bcb267d24.js.map