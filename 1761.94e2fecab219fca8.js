"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[1761],{4865:function(t,e,a){a.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.totalLength,"current-page":t.currentPage},on:{"current-change":t.changePage}})],1)},i=[],r={name:"pagination1-component",props:["totalLength"],computed:{currentPage(){return this.$store.state.currentPage}},methods:{changePage(t){this.$emit("changePageHandler",t)}},mounted(){}},n=r,l=a(1001),o=(0,l.Z)(n,s,i,!1,null,"86225bf4",null),c=o.exports},1919:function(t,e,a){a.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-responsive"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.data,"row-key":t.getRowKeys,"default-sort":{prop:"id",order:"ascending"},"empty-text":"查無資料","cell-class-name":t.rowStyleHandler,border:"","highlight-current-row":""},on:{"selection-change":t.selectChangeHandler}},[t._t("custom-selection"),t._t("custom-checkbox1"),t._t("custom-checkbox2"),t._l(t.tableColumns,(function(a,s){return e("el-table-column",{key:s,attrs:{prop:a.id,label:a.label,width:a.width,sortable:"date"===a.id},scopedSlots:t._u([{key:"default",fn:function(s){return["status"===a.id?e("el-tag",{attrs:{type:"簽核通過"===s.row.status||"審核通過"===s.row.status?"success":"拒絕申請"===s.row.status?"danger":"草稿"===s.row.status?"warning":"查無資料"}},[t._v(" "+t._s(s.row.status)+" ")]):"status_Id"===a.id?e("el-tag",{attrs:{type:"OPEN"===s.row.status_Id?"":"CLOSE"===s.row.status_Id?"danger":"FULL"===s.row.status_Id?"warning":"success"}},[t._v(" "+t._s(t.getCourseState(s.row.status_Id))+" ")]):"description2"===a.id?e("el-tag",{attrs:{type:"有效課程"===s.row.description?"":"danger"}},[t._v(" "+t._s(s.row.description)+" ")]):"approve_Status"===a.id?e("el-tag",{attrs:{type:"0"===s.row.approve_Status?"":"1"===s.row.approve_Status?"success":"danger"}},[t._v(" "+t._s(t.getApproveStatus(s.row.approve_Status))+" ")]):"approve_Status2"===a.id?e("el-tag",{attrs:{type:"審核中"===s.row.approve_Status2||"未審核"===s.row.approve_Status2?"":"審核完畢"===s.row.approve_Status2||"審核同意"===s.row.approve_Status2?"success":"danger"}},[t._v(" "+t._s(s.row.approve_Status2)+" ")]):"attend_Status"===a.id?e("el-tag",{attrs:{type:"0"===s.row.attend_Status?"":"1"===s.row.attend_Status?"success":"danger"}},[t._v(" "+t._s(t.getAttendStatus(s.row.attend_Status))+" ")]):"issue_Card"===a.id?e("el-tag",{attrs:{type:"0"===s.row.issue_Card?"":"1"===s.row.issue_Card?"success":"danger"}},[t._v(" "+t._s(t.getIssueCardStatus(s.row.issue_Card))+" ")]):"signUpStatus"===a.id?e("el-tag",{attrs:{type:"已結案"===t.signUpStatus(s.row.signUpStatus,s.row.approveStatus)?"success":"可取消報名"===t.signUpStatus(s.row.signUpStatus,s.row.approveStatus)?"danger":""}},[t._v(" "+t._s(t.signUpStatus(s.row.signUpStatus,s.row.approveStatus))+" ")]):"file_Name"===a.id||"d_File_Name"===a.id?e("a",{attrs:{href:"#"},on:{click:function(e){return t.downloadPdf(s.row)}}},[t._v(t._s(s.row[a.id]))]):"protocolInfo"===a.id?e("div",[e("div",[t._v(t._s(s.row.po_Name))]),t._l(s.row.files,(function(a){return e("div",[e("a",{attrs:{href:"#"},on:{click:function(e){return t.downloadPdf(a)}}},[t._v(t._s(a.file_Name))])])}))],2):"useable"===a.id&&"已刪除(廠商不可申請每日工單)"===s.row.useable?e("span",{staticStyle:{color:"red"}},[t._v(t._s(s.row.useable))]):"deleted"===a.id?e("span",{class:{"text-danger":"1"===s.row.deleted}},[t._v(" "+t._s(s.row.effect)+" ")]):"array_data"===a.id?e("span",t._l(s.row[a.id],(function(a,s){return e("p",{key:s,staticClass:"mb-0"},[t._v(t._s(a))])})),0):RegExp(/\n/).test(s.row[s.column.property])?e("span",{staticStyle:{"white-space":"pre-wrap"}},[t._v(" "+t._s(s.row[a.id])+" ")]):e("span",[t._v(t._s(s.row[a.id]))])]}}],null,!0)})})),t._t("custom-edit-select"),t._t("custom-switch"),t._t("custom-function"),t._t("slot-sheet-open")],2)],1)},i=[],r={name:"table-component",props:["data","tableColumns"],data(){return{api:this.apiUrl,loading:!0}},methods:{selectChangeHandler(t){this.$emit("selectionChange",t)},downloadPdf(t){const e=t.file_Id;this.$emit("downloadPdfHandler",e),this.$emit("downloadPdfHandler2",t)},getRowKeys(t){return t.index?t.index:t.id},rowStyleHandler(t){if("1"===t.row.isWeekend||"1"===t.row.isNight)return"fontColorBlue"}},mounted(){this.data&&(this.loading=!1)}},n=r,l=a(1001),o=(0,l.Z)(n,s,i,!1,null,"4a0f1604",null),c=o.exports},1761:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var s=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:this.$root.overlay,expression:"this.$root.overlay",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"wrapper"},[e("h2",{staticClass:"form-title mb-3"},[t._v("待簽核文件")]),e("el-tabs",{staticClass:"mb-4",attrs:{type:"border-card"},on:{"tab-click":t.handleClick},model:{value:t.tabPaneName,callback:function(e){t.tabPaneName=e},expression:"tabPaneName"}},[e("div",{staticClass:"w-50 mb-4",staticStyle:{float:"right"}},[e("el-input",{staticClass:"search-text",attrs:{placeholder:"查詢單號","prefix-icon":"el-icon-search",clearable:""},on:{change:t.searchHandler},model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:"searchInput"}})],1),e("el-tab-pane",{attrs:{label:"工程申請單",name:"工程申請單"}},[e("span",{attrs:{slot:"label"},slot:"label"},[t._v("工程申請單 "),e("el-badge",{attrs:{value:t.prjAssignData.length}})],1),e("TableComponent",{ref:"prj",staticClass:"w-100",attrs:{data:t.prjList,tableColumns:t.projectApplyTableColumns},on:{selectionChange:t.projectSelectedHandler},scopedSlots:t._u([{key:"custom-selection",fn:function(){return[e("el-table-column",{attrs:{type:"selection",width:"80","reserve-selection":!0}})]},proxy:!0},{key:"custom-function",fn:function(){return[e("el-table-column",{staticClass:"function-column",attrs:{prop:"function",label:"簽核明細",width:"125"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"檢視",placement:"top-start"}},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.viewSignOffDetails(a.row.project_No)}}},[e("i",{staticClass:"el-icon-edit-outline"})])],1)]}}])})]},proxy:!0}])}),e("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.prjData.length,"current-page":t.prjCurrentPage},on:{"current-change":t.prjChangePage}})],1),e("el-tab-pane",{attrs:{label:"每日施工單",name:"每日施工單"}},[e("span",{attrs:{slot:"label"},slot:"label"},[t._v("每日施工單 "),e("el-badge",{attrs:{value:t.dailyAssignData.length}})],1),e("label",{staticStyle:{color:"#006bb2"}},[t._v("每日施工單待簽文件反藍字表示假日/夜間施工")]),e("TableComponent",{ref:"daily",staticClass:"w-100",attrs:{data:t.dailyList,tableColumns:t.dailyWorkTableColumns},on:{selectionChange:t.dailyWorkSelectedHandler},scopedSlots:t._u([{key:"custom-selection",fn:function(){return[e("el-table-column",{attrs:{type:"selection",width:"80","reserve-selection":!0}})]},proxy:!0},{key:"custom-function",fn:function(){return[e("el-table-column",{staticClass:"function-column",attrs:{prop:"function",label:"簽核明細",width:"125"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"檢視",placement:"top-start"}},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.viewSignOffDailyWork(a.row.apply_Pk)}}},[e("i",{staticClass:"el-icon-edit-outline"})])],1)]}}])})]},proxy:!0}])}),e("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.dailyData.length,"current-page":t.dailyCurrentPage},on:{"current-change":t.dailyChangePage}})],1),e("el-tab-pane",{attrs:{label:"緊急搶修單",name:"緊急搶修單"}},[e("span",{attrs:{slot:"label"},slot:"label"},[t._v("緊急搶修單 "),e("el-badge",{attrs:{value:t.emergencyAssignData.length}})],1),e("TableComponent",{ref:"emergency",staticClass:"w-100",attrs:{data:t.emergencyList,tableColumns:t.emergencyRepairTableColumns},on:{selectionChange:t.emergencyRepairSelectedHandler},scopedSlots:t._u([{key:"custom-selection",fn:function(){return[e("el-table-column",{attrs:{type:"selection",width:"80","reserve-selection":!0}})]},proxy:!0},{key:"custom-function",fn:function(){return[e("el-table-column",{staticClass:"function-column",attrs:{prop:"function",label:"簽核明細",width:"125"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"檢視",placement:"top-start"}},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.emergencyRepairViewSignOff(a.row.project_No)}}},[e("i",{staticClass:"el-icon-edit-outline"})])],1)]}}])})]},proxy:!0}])}),e("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.emergencyData.length,"current-page":t.emergencyCurrentPage},on:{"current-change":t.emergencyChangePage}})],1)],1),e("h2",{staticClass:"form-title"},[t._v("批次簽核")]),e("el-card",{attrs:{shadow:"never"}},[e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules}},[e("div",{staticClass:"selected-box mb-4"},[e("span",{staticClass:"me-2"},[t._v("已選 "+t._s(t.projectSelectedLists.length+t.dailyWorkSelectedLists.length+t.emergencyRepairSelectedLists.length)+" 項")]),e("el-card",{staticClass:"my-2",attrs:{shadow:"never"}},[e("div",{staticClass:"my-2"},[e("h6",[t._v("工程申請單")]),t._l(t.projectSelectedLists,(function(a){return e("div",[e("div",{staticClass:"d-flex align-items-center"},[e("span",[t._v(t._s(a.info))]),e("el-button",{staticClass:"ms-auto",attrs:{type:"text"},on:{click:function(e){return t.selectedHandleRemove(a)}}},[e("i",{staticClass:"el-icon-delete"})])],1)])}))],2),e("div",{staticClass:"my-2"},[e("h6",[t._v("每日施工單")]),t._l(t.dailyWorkSelectedLists,(function(a){return e("div",[e("div",{staticClass:"d-flex align-items-center"},[e("span",[t._v(t._s(a.info))]),e("el-button",{staticClass:"ms-auto",attrs:{type:"text"},on:{click:function(e){return t.selectedHandleRemove(a)}}},[e("i",{staticClass:"el-icon-delete"})])],1)])}))],2),e("div",{staticClass:"my-2"},[e("h6",[t._v("緊急搶修單")]),t._l(t.emergencyRepairSelectedLists,(function(a){return e("div",[e("div",{staticClass:"d-flex align-items-center"},[e("span",[t._v(t._s(a.info))]),e("el-button",{staticClass:"ms-auto",attrs:{type:"text"},on:{click:function(e){return t.selectedHandleRemove(a)}}},[e("i",{staticClass:"el-icon-delete"})])],1)])}))],2)])],1),e("el-form-item",{attrs:{prop:"sr_Result"}},[e("el-radio-group",{model:{value:t.form.sr_Result,callback:function(e){t.$set(t.form,"sr_Result",e)},expression:"form.sr_Result"}},[e("el-radio",{attrs:{label:"APPROVE"}},[t._v("核准")]),e("el-radio",{attrs:{label:"REJECT"}},[t._v("駁回")])],1)],1),e("el-form-item",{attrs:{label:"意見欄",prop:"Sr_Comment"}},[e("el-input",{model:{value:t.form.Sr_Comment,callback:function(e){t.$set(t.form,"Sr_Comment",e)},expression:"form.Sr_Comment"}})],1)],1),e("div",{staticClass:"mt-4"},[e("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(e){return t.resetForm("form")}}},[t._v("取消")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.submitForm("form")}}},[t._v("送出")])],1)],1)],1)},i=[],r=a(1919),n=a(4865);const l=t=>t.toString().toLowerCase(),o=(t,e)=>e?t.filter((t=>l(t.info).includes(l(e)))):t;var c={name:"pendingFilesComponent",components:{TableComponent:r.Z,Pagination1:n.Z},data(){return{tabName:"",tabPaneName:"工程申請單",searchInput:"",form:{rr_Id:"",sr_Result:"",Sr_Comment:"",task_Id:""},rules:{sr_Result:[{required:!0,message:"必填",trigger:"change"}]},projectApplyTableColumns:[{id:"index",label:"項次",width:"70"},{id:"task_Id",label:"簽核任務編號",width:"200"},{id:"info",label:"工程編號/工程名稱",width:"200"},{id:"createDate",label:"建立日期(開始日期~結束日期)",width:"200"},{id:"area",label:"工作區域",width:"200"},{id:"sInfo",label:"主承包商編號/主承包商名稱/下承包商數",width:"200"},{id:"status",label:"工程狀態",width:"150"}],prjAssignData:[],prjData:[],prjList:[],prjCurrentPage:1,projectSelectedLists:[],dailyWorkTableColumns:[{id:"index",label:"項次",width:"70"},{id:"applyPk_taskId",label:"每日施工單號/簽核任務編號",width:"200"},{id:"info",label:"工程編號/工程名稱",width:"200"},{id:"createDate",label:"建立日期(開始日期~結束日期)",width:"200"},{id:"area",label:"施工日期/工作區域",width:"200"},{id:"workType",label:"施工種類",width:"200"},{id:"sInfo",label:"主承包商編號/主承包商名稱/下承包商數",width:"200"},{id:"status",label:"工程狀態",width:"150"}],dailyAssignData:[],dailyData:[],dailyList:[],dailyCurrentPage:1,dailyWorkSelectedLists:[],emergencyRepairTableColumns:[{id:"index",label:"項次",width:"70"},{id:"task_Id",label:"簽核任務編號",width:"200"},{id:"info",label:"工程編號/工程名稱",width:"200"},{id:"createDate",label:"建立日期(開始日期~結束日期)",width:"200"},{id:"area",label:"工作區域",width:"200"},{id:"status",label:"工程狀態",width:"150"}],emergencyAssignData:[],emergencyData:[],emergencyList:[],emergencyCurrentPage:1,emergencyRepairSelectedLists:[]}},computed:{},methods:{searchHandler(t){this.searchInput?"工程申請單"===this.tabPaneName?(this.prjData=o(this.prjAssignData,t),this.prjList=this.prjData.slice(0,10)):"每日施工單"===this.tabPaneName?(this.dailyData=o(this.dailyAssignData,t),this.dailyList=this.dailyData.slice(0,10)):(this.emergencyData=o(this.emergencyAssignData,t),this.emergencyList=this.emergencyData.slice(0,10)):"工程申請單"===this.tabPaneName?(this.prjData=this.prjAssignData,this.prjList=this.prjData.slice(0,10),this.prjCurrentPage=1):"每日施工單"===this.tabPaneName?(this.dailyData=this.dailyAssignData,this.dailyList=this.dailyData.slice(0,10),this.dailyCurrentPage=1):(this.emergencyData=this.emergencyAssignData,this.emergencyList=this.emergencyData.slice(0,10),this.emergencyCurrentPage=1)},handleClick(t){const e=t.$el.id;this.tabName=e.split("-")[1],this.searchInput=""},selectedHandleRemove(t){const e=t.type;"prj"===e?(this.projectSelectedLists=this.projectSelectedLists.filter((e=>e.project_No!==t.project_No)),this.$refs.prj.$refs["multipleTable"].toggleRowSelection(t)):"daily"===e?(this.dailyWorkSelectedLists=this.dailyWorkSelectedLists.filter((e=>e.project_No!==t.project_No)),this.$refs.daily.$refs["multipleTable"].toggleRowSelection(t)):(this.emergencyRepairSelectedLists=this.emergencyRepairSelectedLists.filter((e=>e.project_No!==t.project_No)),this.$refs.emergency.$refs["multipleTable"].toggleRowSelection(t))},resetForm(t){this.$refs[t].resetFields()},submitForm(t){this.$refs[t].validate((async e=>{if(e){const e=[...this.projectSelectedLists,...this.dailyWorkSelectedLists,...this.emergencyRepairSelectedLists],a=this.dataSetRRId(e);this.$store.dispatch("VertifyPendingFile",a).then((async e=>{e.data.isOK&&(this.$message({type:"success",duration:5e3,showClose:!0,message:"簽核成功"}),this.projectSelectedLists=[],this.dailyWorkSelectedLists=[],this.emergencyRepairSelectedLists=[],this.prjCurrentPage=1,this.dailyCurrentPage=1,this.emergencyCurrentPage=1,this.$refs.prj.$refs.multipleTable.clearSelection(),this.$refs.daily.$refs.multipleTable.clearSelection(),this.$refs.emergency.$refs.multipleTable.clearSelection(),this.tabPaneName="工程申請單",this.resetForm(t),await this.getPrjPendingList(),await this.getDailyPendingList(),await this.getUrgentPendingList())})).catch((t=>console.log(t)))}else this.$message({type:"error",duration:5e3,showClose:!0,message:"資料填寫錯誤"})}))},dataSetRRId(t){return t.forEach((t=>{"prj"===t.type||"emergency"===t.type?t.rr_Id=t.project_No:"daily"===t.type&&(t.rr_Id=t.apply_Pk),t.sr_Result=this.form.sr_Result,t.Sr_Comment=this.form.Sr_Comment})),t},async getPrjPendingList(){const t=await this.$store.dispatch("QryPrjPendingList"),e=t.data.data.projList;this.prjAssignData=JSON.parse(JSON.stringify(e)),this.prjAssignData.forEach(((t,e)=>{t.index=e+1,t.info=`${t.project_No}/${t.project_Name}`,t.createDate=`${t.create_Date}(${t.begin_Date}~${t.end_Date})`,t.area=`${t.floor}/${t.ld2}(${t.ld1})/${t.ld4}(${t.ld3})`,t.sInfo=`${t.s_Id}/${t.s_Name}/${t.sub_Vendor_Num}`,t.status=this.convertStatus(t.project_Status),t.type="prj"})),this.prjData=this.prjAssignData,this.prjList=this.prjData.slice(0,10)},prjChangePage(t){this.prjCurrentPage=t;const e=10*(t-1),a=10*t;this.prjList=this.prjData.slice(e,a)},async viewSignOffDetails(t){let e=[];try{const a=await this.$store.dispatch("getProjDetail",t),s=await this.$store.dispatch("getSignOffHistory",t);e=[a.data.data,s.data.data]}catch(s){console.log(s)}const{href:a}=this.$router.resolve({path:"/viewSignOffDetails",query:{data:JSON.stringify(e)}});window.open(a,"_blank")},projectSelectedHandler(t){this.projectSelectedLists=t},async getDailyPendingList(){const t=await this.$store.dispatch("QryDailyPendingList"),e=t.data.data.dailyList;this.dailyAssignData=JSON.parse(JSON.stringify(e)),this.dailyAssignData.forEach(((t,e)=>{t.index=e+1,t.applyPk_taskId=`${t.apply_Pk}/${t.task_Id}`,t.info=`${t.project_No}/${t.project_Name}`,t.createDate=`${t.create_Date}(${t.begin_Date}~${t.end_Date})`,t.area=`${t.work_Date}/${t.floor}/${t.ld2}(${t.ld1})/${t.ld4}(${t.ld3})`,t.workType=`${t.wtn?t.wtn:"一般作業"}`,t.sInfo=`${t.s_Id}/${t.s_Name}/${t.sub_Vendor_Num}`,t.status=this.convertStatus(t.project_Status),t.type="daily"})),this.dailyData=this.dailyAssignData,this.dailyList=this.dailyData.slice(0,10)},dailyChangePage(t){this.dailyCurrentPage=t;const e=10*(t-1),a=10*t;this.dailyList=this.dailyData.slice(e,a)},dailyWorkSelectedHandler(t){this.dailyWorkSelectedLists=t},viewSignOffDailyWork(t){window.open(`/#/pendingFileDailyDetail/${encodeURIComponent(t)}`)},async getUrgentPendingList(){const t=await this.$store.dispatch("QryUrgentPendingList"),e=t.data.data.urgentList;this.emergencyAssignData=JSON.parse(JSON.stringify(e)),this.emergencyAssignData.forEach(((t,e)=>{t.index=e+1,t.info=`${t.project_No}/${t.project_Name}`,t.createDate=`${t.create_Date}(${t.begin_Date}~${t.end_Date})`,t.area=`${t.ld2}(${t.ld1})/${t.ld4}(${t.ld3})/${t.floor}`,t.status=this.convertStatus(t.project_Status),t.type="emergency"})),this.emergencyData=this.emergencyAssignData,this.emergencyList=this.emergencyData.slice(0,10)},emergencyChangePage(t){this.emergencyCurrentPage=t;const e=10*(t-1),a=10*t;this.emergencyList=this.emergencyData.slice(e,a)},emergencyRepairSelectedHandler(t){this.emergencyRepairSelectedLists=t},async emergencyRepairViewSignOff(t){const e=await this.$store.dispatch("getViewSignOffDetail",t),a=e.data.data,{href:s}=this.$router.resolve({path:"/emergencyRepairOrderViewSighOffDetails",query:{data:JSON.stringify(a)}});window.open(s,"_blank")}},async mounted(){this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0,await this.getPrjPendingList(),await this.getDailyPendingList(),await this.getUrgentPendingList()}},d=c,u=a(1001),p=(0,u.Z)(d,s,i,!1,null,null,null),g=p.exports}}]);
//# sourceMappingURL=1761.94e2fecab219fca8.js.map