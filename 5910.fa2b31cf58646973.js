"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[5910],{7163:function(e,r,t){t.d(r,{Z:function(){return d}});var a=function(){var e=this,r=e._self._c;return r("div",{staticClass:"upload"},[r("el-upload",{ref:"Upload",staticClass:"upload-demo",attrs:{limit:e.limitNumber,action:e.uploadAction,"auto-upload":!1,"on-change":e.changeHandler,"on-remove":e.removeHandler}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上傳檔案")]),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.uploadTipText))])],1)],1)},s=[],o=t(942),i={name:"upload-component",data(){return{}},props:{uploadTipText:{type:[String],default:"檔案格式為PDF，在2MB以內"},uploadAction:{type:[String],default:o.apiUrl},limitNumber:{type:Number,default:1}},methods:{changeHandler(e,r){this.$emit("fileChangeHandler",r)},removeHandler(e,r){this.$emit("fileRemoveHandler",r)}},mounted(){}},l=i,n=t(1001),c=(0,n.Z)(l,a,s,!1,null,"442b61f1",null),d=c.exports},5910:function(e,r,t){t.r(r),t.d(r,{default:function(){return m}});var a=function(){var e=this,r=e._self._c;return r("div",[r("div",{staticClass:"apply wrapper"},[r("h2",{staticClass:"form-title"},[e._v("緊急搶修單申請")]),r("el-card",{attrs:{shadow:"never"}},[r("el-row",{staticClass:"info",attrs:{type:"flex",justify:"space-between"}},[r("el-col",{attrs:{span:8}},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"me-2",attrs:{for:""}},[e._v("申請單號：")]),r("span",[e._v(e._s(e.prjNo||"尚未給號"))])])]),r("el-col",{attrs:{span:8}},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"me-2",attrs:{for:""}},[e._v("申請日期：")]),r("span",[e._v(e._s(e.dayTime))])])])],1),r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"top"}},[r("el-row",[r("el-col",{attrs:{span:3}},[r("h3",{staticClass:"row-title"},[e._v("基本資訊")])]),r("el-col",{attrs:{span:21}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"緊急搶修單主旨",prop:"project_Name"}},[r("el-input",{attrs:{placeholder:"請輸入主旨",clearable:""},model:{value:e.form.project_Name,callback:function(r){e.$set(e.form,"project_Name",r)},expression:"form.project_Name"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{staticClass:"me-4",attrs:{label:"廠區名稱",prop:"ld1"}},[r("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.form.ld1,callback:function(r){e.$set(e.form,"ld1",r)},expression:"form.ld1"}},e._l(e.facList,(function(e){return r("el-option",{key:e.ld1,attrs:{label:e.ld2,value:e.ld1}})})),1)],1)],1),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"無塵室/非無塵室",prop:"location_Type"}},[r("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.form.location_Type,callback:function(r){e.$set(e.form,"location_Type",r)},expression:"form.location_Type"}},[r("el-option",{attrs:{label:"無塵室",value:"1"}}),r("el-option",{attrs:{label:"非無塵室",value:"0"}})],1)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{staticClass:"me-4",attrs:{label:"FAB 廠別/區域 (依上方選項帶出施工區域)"}},[r("div",{staticClass:"directions",staticStyle:{width:"150%"}},[e._v(" 本申請單限單一FAB廠(或區域)申請，若您有需要跨廠區域的工程，請拆單分別申請 ")]),r("el-select",{attrs:{placeholder:"請選擇",disabled:!(this.form.ld1&&this.form.location_Type)},model:{value:e.form.work_Id,callback:function(r){e.$set(e.form,"work_Id",r)},expression:"form.work_Id"}},e._l(e.workAreaList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.floor,value:e.id}})})),1)],1)],1)],1),r("el-form-item",{attrs:{label:"申請緊急搶修原因",prop:"urgent_Type"}},[r("el-radio",{attrs:{label:"L",value:"L"},on:{change:e.urgentTypeChgHandler},model:{value:e.form.urgent_Type,callback:function(r){e.$set(e.form,"urgent_Type",r)},expression:"form.urgent_Type"}},[e._v("低風險")]),r("el-radio",{attrs:{label:"H",value:"H"},on:{change:e.urgentTypeChgHandler},model:{value:e.form.urgent_Type,callback:function(r){e.$set(e.form,"urgent_Type",r)},expression:"form.urgent_Type"}},[e._v("高風險")])],1),r("el-form-item",{attrs:{prop:"urgent_Reason_raw"}},[r("el-checkbox-group",{model:{value:e.form.urgent_Reason_raw,callback:function(r){e.$set(e.form,"urgent_Reason_raw",r)},expression:"form.urgent_Reason_raw"}},e._l(e.reasonList,(function(t){return r("div",[r("el-checkbox",{attrs:{label:t.urgent_Type_Pk,value:t.urgent_Type_Pk},on:{change:function(r){return e.urgentReasonChgHandler(t,r)}}},[e._v(" "+e._s(t.urgent_Type_Name)+" ("+e._s(t.description)+") ")]),"202004160002"==t.urgent_Type_Pk?r("el-form-item",{staticStyle:{"margin-left":"25px"},attrs:{label:"工程單號：",prop:"project_No2"}},[r("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"請輸入單號"},model:{value:e.form.project_No2,callback:function(r){e.$set(e.form,"project_No2",r)},expression:"form.project_No2"}})],1):"202004160004"==t.urgent_Type_Pk?r("el-form-item",{staticStyle:{"margin-left":"25px"},attrs:{label:"工程單號：",prop:"project_No4"}},[r("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"請輸入單號",disabled:-1!=e.form.urgent_Reason_raw.indexOf("202004160003")},model:{value:e.form.project_No4,callback:function(r){e.$set(e.form,"project_No4",r)},expression:"form.project_No4"}})],1):e._e()],1)})),0)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:3}},[r("h3",{staticClass:"row-title"},[e._v("內容設定")])]),r("el-col",{attrs:{span:21}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"直屬主管/代理人",prop:"dupety_Mamager_Empno"}},[r("p",{staticClass:"directions mb-0"},[e._v("平日：開放由搶修單申請人指派代理主管簽核")]),r("p",{staticClass:"directions mb-0"},[e._v("可簽核人員：直屬主管職務代理人/廠內平行層級主管")]),r("p",{staticClass:"directions mb-0"},[e._v("假日/夜間：此簽核點不需簽核，系統會自動pass此簽核點")]),r("div",{staticClass:"mt-2"},[r("el-select",{staticClass:"me-3",attrs:{placeholder:"請輸入姓名或工號",filterable:"",remote:"","reverse-keyword":"",loading:e.managerLoading},nativeOn:{keyup:function(r){return e.managerSearchHandler(r)}},model:{value:e.form.dupety_Mamager_Empno,callback:function(r){e.$set(e.form,"dupety_Mamager_Empno",r)},expression:"form.dupety_Mamager_Empno"}},e._l(e.managerList,(function(e){return r("el-option",{key:e.emp_No,attrs:{label:e.name+"("+e.emp_No+"-"+e.real_Dept_Name+")",value:e.emp_No}})})),1),r("p",{staticClass:"note mb-0 mt-1"},[e._v(e._s(e.$store.state.remoteSearchNote))])],1)])],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"工作場所負責人",prop:"dupety_Work_Signer"}},[r("p",{staticClass:"directions mb-0"},[e._v("平日：開放由搶修單申請人指派代理主管簽核")]),r("p",{staticClass:"directions mb-0"},[e._v("可簽核人員：廠長職務代理人")]),r("p",{staticClass:"directions mb-0"},[e._v("假日/夜間：製造部值班組長")]),r("div",{staticClass:"mt-2"},[r("el-select",{staticClass:"me-3",attrs:{placeholder:"請輸入姓名或工號",filterable:"",remote:"","reverse-keyword":"",loading:e.signerLoading},nativeOn:{keyup:function(r){return e.signerSearchHandler(r)}},model:{value:e.form.dupety_Work_Signer,callback:function(r){e.$set(e.form,"dupety_Work_Signer",r)},expression:"form.dupety_Work_Signer"}},e._l(e.signerList,(function(e){return r("el-option",{key:e.emp_No,attrs:{label:e.name+"("+e.emp_No+"-"+e.real_Dept_Name+")",value:e.emp_No}})})),1),r("p",{staticClass:"note mb-0 mt-1"},[e._v(e._s(e.$store.state.remoteSearchNote))])],1)])],1)],1),r("el-form-item",{attrs:{label:"施工開始時間~結束時間"}},[r("p",{staticClass:"directions el-text-success"},[e._v("可申請時間：未來三天，夜間施工18:00~08:00，施工時數不得超過24小時")]),r("div",{staticClass:"d-flex align-items-center"},[r("el-form-item",{staticClass:"mb-0",attrs:{prop:"begin_Date"}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy/MM/dd HH:mm",format:"yyyy/MM/dd HH:mm",placeholder:"選擇開始日期時間"},on:{change:e.dateRangeHandler},model:{value:e.form.begin_Date,callback:function(r){e.$set(e.form,"begin_Date",r)},expression:"form.begin_Date"}})],1),r("span",{staticClass:"px-3"},[e._v("～")]),r("el-form-item",{staticClass:"mb-0",attrs:{prop:"end_Date"}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy/MM/dd HH:mm",format:"yyyy/MM/dd HH:mm",placeholder:"選擇結束日期時間"},on:{change:e.dateRangeHandler},model:{value:e.form.end_Date,callback:function(r){e.$set(e.form,"end_Date",r)},expression:"form.end_Date"}})],1)],1)]),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{staticClass:"me-4",attrs:{label:"廠商名稱",prop:"s_Name"}},[r("el-input",{attrs:{placeholder:"請輸入名稱"},model:{value:e.form.s_Name,callback:function(r){e.$set(e.form,"s_Name",r)},expression:"form.s_Name"}})],1)],1),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"廠商統編",prop:"s_Id"}},[r("el-input",{attrs:{placeholder:"請輸入統編"},model:{value:e.form.s_Id,callback:function(r){e.$set(e.form,"s_Id",r)},expression:"form.s_Id"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{staticClass:"me-4",attrs:{label:"廠商施工負責人",prop:"area_Name"}},[r("el-input",{attrs:{placeholder:"請輸入負責人"},model:{value:e.form.area_Name,callback:function(r){e.$set(e.form,"area_Name",r)},expression:"form.area_Name"}})],1)],1),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"廠商緊急聯絡電話",prop:"duty_Tel"}},[r("el-input",{attrs:{placeholder:"請輸入電話"},model:{value:e.form.duty_Tel,callback:function(r){e.$set(e.form,"duty_Tel",r)},expression:"form.duty_Tel"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{staticClass:"me-4",attrs:{label:"廠商安衛人員姓名",prop:"duty_Name"}},[r("el-input",{attrs:{placeholder:"請輸入姓名"},model:{value:e.form.duty_Name,callback:function(r){e.$set(e.form,"duty_Name",r)},expression:"form.duty_Name"}})],1)],1)],1),r("el-form-item",{attrs:{label:"施工人員"}},[r("p",{staticClass:"directions mb-0 el-text-success"},[e._v("1. 未滿18歲不得入廠施工")]),r("p",{staticClass:"directions mb-0"},[e._v("2. 搶救原因為on call時，施工人員限定為有群創光電承攬商合格證的人員")]),r("p",{staticClass:"directions mb-0 el-text-success"},[e._v("3. 儲存草稿模式時不會包含將附檔實際上傳，故若為呼叫草稿重新編輯時，請務必在送單前重新選擇上傳檔案")]),r("el-button",{staticClass:"el-button el-button--primary mt-2",attrs:{size:"small"},on:{click:function(r){return e.addConstruction()}}},[e._v("新增人員")]),r("div",{staticClass:"table-resposive mt-3"},[r("table",{staticClass:"table"},[r("thead",[r("tr",[r("th",{staticClass:"text-nowrap"},[e._v("項次")]),r("th",{staticClass:"text-nowrap"},[e._v("姓名")]),r("th",{staticClass:"text-nowrap"},[e._v("身分證")]),r("th",{staticClass:"text-nowrap"},[e._v("生日")]),r("th",{staticClass:"text-nowrap"},[e._v("刪除")]),r("th",{staticStyle:{width:"20%"}},[e._v(" 勞保資料及500萬以上雇主意外"),r("br"),e._v(" 責任險或團險，外籍人士檢附"),r("br"),e._v(" 海外保險(意外死殘)額度達"),r("br"),e._v(" 500萬元以上之證明資料 ")])])]),r("tbody",e._l(e.form.work_Person_List,(function(t,a){return r("tr",{key:t.index},[r("td",[e._v(e._s(a+1))]),r("td",[r("el-input",{attrs:{placeholder:"請輸入姓名",clearable:""},model:{value:t.name,callback:function(r){e.$set(t,"name",r)},expression:"item.name"}})],1),r("td",[r("el-form-item",{staticClass:"mb-0",attrs:{prop:"work_Person_List."+a+".id",rules:[{required:!0,message:"必填",trigger:"blur"}]}},[r("el-input",{attrs:{placeholder:"請輸入身分證"},on:{change:function(r){return e.validateCard(a,t.id)}},model:{value:t.id,callback:function(r){e.$set(t,"id",r)},expression:"item.id"}}),"0"==t.card_Status?r("span",{staticClass:"el-text-success"},[e._v("無效的發卡狀態")]):e._e()],1)],1),r("td",[r("el-form-item",{staticClass:"mb-0",attrs:{prop:"work_Person_List."+a+".birthday",rules:[{required:!0,message:"必填",trigger:"blur"},{validator:e.validateAge,trigger:"blur"}]}},[r("el-date-picker",{staticClass:"w-100",attrs:{type:"date","value-format":"yyyy/MM/dd",placeholder:"請選擇日期",clearable:""},model:{value:t.birthday,callback:function(r){e.$set(t,"birthday",r)},expression:"item.birthday"}})],1)],1),r("td",[r("el-button",{staticClass:"el-button el-button--primary is-plain",attrs:{size:"small",disabled:1==e.form.work_Person_List.length},on:{click:function(r){return e.deleteConstruction(a)}}},[e._v("刪除")])],1),r("td",["0"==t.card_Status?r("el-form-item",{staticClass:"my-1",attrs:{prop:"work_Person_List."+a+".fileName",rules:e.mustupload}},[e.form.isDraft&&t.fileName?r("div",[r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(r){return e.deleteFile(a,t.fileName,t.file_Id)}}},[e._v("刪除檔案")]),r("span",{staticClass:"mx-1"},[e._v(e._s(t.fileName))])],1):e._e(),e.form.isDraft&&t.fileName?e._e():r("div",[r("Upload",{on:{fileChangeHandler:r=>e.insuranceFileChgHandler(r,a),fileRemoveHandler:r=>e.insuranceFileRmvHandler(r,a)},model:{value:t.fileName,callback:function(r){e.$set(t,"fileName",r)},expression:"item.fileName"}})],1)]):e._e()],1)])})),0)])])],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:3}},[r("h3",{staticClass:"row-title"},[e._v("作業選項")])]),r("el-col",{attrs:{span:21}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"工作內容",prop:"description"}},[r("el-input",{staticClass:"mb-2",model:{value:e.form.description,callback:function(r){e.$set(e.form,"description",r)},expression:"form.description"}})],1),r("el-form-item",{attrs:{prop:"work_Type_Normal"}},[r("el-radio",{attrs:{label:"0",value:"0"},on:{change:e.workTypeChgHandler},model:{value:e.form.work_Type_Normal,callback:function(r){e.$set(e.form,"work_Type_Normal",r)},expression:"form.work_Type_Normal"}},[e._v("一般作業")]),r("el-radio",{attrs:{label:"1",value:"1"},on:{change:e.workTypeChgHandler},model:{value:e.form.work_Type_Normal,callback:function(r){e.$set(e.form,"work_Type_Normal",r)},expression:"form.work_Type_Normal"}},[e._v("高風險作業")])],1)],1)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:"1"==e.form.work_Type_Normal,expression:"form.work_Type_Normal=='1'"}]},[r("el-form-item",{attrs:{prop:"hightRiskType_raw"}},e._l(e.workTypeList,(function(t,a){return r("el-form-item",{key:a},[r("label",{attrs:{for:""}},[e._v(e._s(a+1)+". "+e._s(t.class_Name))]),e._l(t.value,(function(t){return r("div",{staticClass:"ms-3 mb-1"},[r("el-checkbox",{attrs:{label:t.work_Type_Pk,value:t.work_Type_Pk},on:{change:function(r){return e.cardInputHandler(t,r)}},model:{value:e.form.hightRiskType_raw,callback:function(r){e.$set(e.form,"hightRiskType_raw",r)},expression:"form.hightRiskType_raw"}},[e._v(" "+e._s(t.work_Type_Name)+" ("+e._s(t.description)+") ")]),"201103160001"==t.work_Type_Pk?r("el-row",[r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-2",attrs:{label:"施工架組配作業主管證號：",prop:"card_No32"}},[r("el-input",{attrs:{placeholder:"請輸入證號",disabled:-1==e.form.hightRiskType_raw.indexOf("201103160001")},model:{value:e.form.card_No32,callback:function(r){e.$set(e.form,"card_No32",r)},expression:"form.card_No32"}})],1)],1)],1):"202104200001"==t.work_Type_Pk?r("el-row",[r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-2",attrs:{label:"屋頂作業主管證號：",prop:"card_No35"}},[r("el-input",{attrs:{placeholder:"請輸入證號",disabled:-1==e.form.hightRiskType_raw.indexOf("202104200001")},model:{value:e.form.card_No35,callback:function(r){e.$set(e.form,"card_No35",r)},expression:"form.card_No35"}})],1)],1)],1):"200310150005"==t.work_Type_Pk?r("el-row",[r("el-row",[r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-2",attrs:{label:"吊車合格證號：",prop:"card_No41"}},[r("el-input",{attrs:{placeholder:"請輸入證號",disabled:-1==e.form.hightRiskType_raw.indexOf("200310150005")},model:{value:e.form.card_No41,callback:function(r){e.$set(e.form,"card_No41",r)},expression:"form.card_No41"}})],1)],1),r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-2",attrs:{label:"吊掛合格證號：",prop:"card_No42"}},[r("el-input",{attrs:{placeholder:"請輸入證號",disabled:-1==e.form.hightRiskType_raw.indexOf("200310150005")},model:{value:e.form.card_No42,callback:function(r){e.$set(e.form,"card_No42",r)},expression:"form.card_No42"}})],1)],1)],1),r("el-row",[r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-2",attrs:{label:"指揮手合格證號：",prop:"card_No43"}},[r("el-input",{attrs:{placeholder:"請輸入證號",disabled:-1==e.form.hightRiskType_raw.indexOf("200310150005")},model:{value:e.form.card_No43,callback:function(r){e.$set(e.form,"card_No43",r)},expression:"form.card_No43"}})],1)],1),r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-2",attrs:{label:"操作手合格證號：",prop:"card_No44"}},[r("el-input",{attrs:{placeholder:"請輸入證號",disabled:-1==e.form.hightRiskType_raw.indexOf("200310150005")},model:{value:e.form.card_No44,callback:function(r){e.$set(e.form,"card_No44",r)},expression:"form.card_No44"}})],1)],1)],1)],1):"200310150001"==t.work_Type_Pk?r("el-row",[r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-2",attrs:{label:"缺氧作業主管證號：",prop:"card_No51"}},[r("el-input",{attrs:{placeholder:"請輸入證號",disabled:-1==e.form.hightRiskType_raw.indexOf("200310150001")},model:{value:e.form.card_No51,callback:function(r){e.$set(e.form,"card_No51",r)},expression:"form.card_No51"}})],1)],1)],1):"200801090001"==t.work_Type_Pk?r("el-row",[r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-2",attrs:{label:"by pass 機台名稱：",prop:"card_No71"}},[r("el-input",{attrs:{placeholder:"請輸入名稱",disabled:-1==e.form.hightRiskType_raw.indexOf("200801090001")},model:{value:e.form.card_No71,callback:function(r){e.$set(e.form,"card_No71",r)},expression:"form.card_No71"}})],1)],1)],1):"200310150006"==t.work_Type_Pk?r("el-row",[r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-2",attrs:{label:"有機/特化作業主管證號：",prop:"card_No91"}},[r("el-input",{attrs:{placeholder:"請輸入證號",disabled:-1==e.form.hightRiskType_raw.indexOf("200310150006")},model:{value:e.form.card_No91,callback:function(r){e.$set(e.form,"card_No91",r)},expression:"form.card_No91"}})],1)],1)],1):"200403220001"==t.work_Type_Pk?r("el-row",[r("el-col",{staticClass:"ms-4",attrs:{span:8}},[r("el-form-item",{staticClass:"mt-1",attrs:{prop:"card_Other"}},[r("el-input",{staticClass:"mt-1",attrs:{placeholder:"請輸入其他項目",disabled:-1==e.form.hightRiskType_raw.indexOf("200403220001")},model:{value:e.form.card_Other,callback:function(r){e.$set(e.form,"card_Other",r)},expression:"form.card_Other"}})],1)],1)],1):e._e()],1)}))],2)})),1)],1)],1)],1)],1)],1)],1),r("div",{staticClass:"position-fixed"},[r("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(r){return e.submitForm("form",!0)}}},[e._v("儲存草稿")]),r("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(r){return e.resetForm("form")}}},[e._v("重設")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(r){return e.submitForm("form",!1)}}},[e._v("送出")])],1),r("el-dialog",{staticStyle:{top:"20vmin"},attrs:{title:"提示",visible:e.dialogVisible,width:"40%","before-close":e.dialogClose},on:{"update:visible":function(r){e.dialogVisible=r}}},[r("br"),e._v("1.請確認施工人員是否完成入廠危害告知教育訓練，尚未完成者，需至ESH指定之訓練地點完成訓練並取得憑證後，始得作業。"),r("br"),e._v(" 2.儲存草稿模式時不會包含將附檔實際上傳，故若為呼叫草稿重新編輯時，請務必在送單前重新選擇上傳檔案 "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(r){e.dialogVisible=!1}}},[e._v("確定")])],1)]),r("el-dialog",{staticStyle:{top:"22vmin"},attrs:{title:"提示",visible:e.hintVisible,width:"20%","before-close":e.hintClose},on:{"update:visible":function(r){e.hintVisible=r}}},[r("span",[e._v("請考慮是否需加選 [警報偵測訊號隔離]")]),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(r){e.hintVisible=!1}}},[e._v("確定")])],1)])],1)},s=[],o=(t(7658),t(7163));function i(){let e=new Date,r=e.toLocaleDateString(),t=e.toLocaleTimeString();if("下"==t[0]){let e=t.substr(2).split(":");t=(1*e[0]+12)%12+12+":"+e.slice(1).join(":")}else t=t.substr(2);return r+" "+t}var l={name:"apply-component",components:{Upload:o.Z},data(){return{prjNo:"",dayTime:i(),managerLoading:!1,signerLoading:!1,dialogVisible:!0,hintVisible:!1,form:{project_No:null,project_Name:"",ld1:"",location_Type:"",work_Id:"",urgent_Type:"",urgent_Reason:[],urgent_Reason_raw:[],project_No2:"",project_No4:"",dupety_Mamager_Empno:"",dupety_Work_Signer:"",begin_Date:"",end_Date:"",s_Name:"",s_Id:"",area_Name:"",duty_Tel:"",duty_Name:"",work_Person_List:[],description:"",work_Type_Normal:"",hightRiskType:[],hightRiskType_raw:[],card_No32:"",card_No35:"",card_No41:"",card_No42:"",card_No43:"",card_No44:"",card_No51:"",card_No71:"",card_No91:"",card_Other:"",isbuild:"0",isDraft:!1},rules:{project_No2:[{required:!1}],project_No4:[{required:!1}],begin_Date:[{required:!1}],end_Date:[{required:!1}],card_No32:[{required:!1}],card_No35:[{required:!1}],card_No41:[{required:!1}],card_No42:[{required:!1}],card_No43:[{required:!1}],card_No44:[{required:!1}],card_No51:[{required:!1}],card_No71:[{required:!1}],card_No91:[{required:!1}],card_Other:[{required:!1}]}}},computed:{facList(){return this.$store.state.factory_list},workAreaList(){let e=this.$store.state.workarea_list;return this.form.ld1&&this.form.location_Type?e.filter((e=>e.location_Id==this.form.ld1&&e.location_Type==this.form.location_Type)):e},reasonList(){let e=this.$store.state.reason_list;return this.form.urgent_Type?e.filter((e=>e.urgent_Type==this.form.urgent_Type)):[]},managerList(){return this.$store.state.manager_list},signerList(){return this.$store.state.signer_list},mustupload(){return-1!=this.form.urgent_Reason_raw.indexOf("202004160005")?[]:[{required:!0,message:"必填",trigger:"change"}]},workTypeList(){let e=this.$store.state.worktype_list,r=e.reduce(((e,r)=>{let t=e.findIndex((e=>e.class_Name==r.class_Name));return-1!==t?e[t].value.push({class_Name:r.class_Name,work_Type_Pk:r.work_Type_Pk,work_Type_Name:r.work_Type_Name,description:r.description,approve_Item:r.approve_Item,approve_She_Area:r.approve_She_Area,extra_Common:r.extra_Common}):e.push({class_Name:r.class_Name,value:[{class_Name:r.class_Name,work_Type_Pk:r.work_Type_Pk,work_Type_Name:r.work_Type_Name,description:r.description,approve_Item:r.approve_Item,approve_She_Area:r.approve_She_Area,extra_Common:r.extra_Common}]}),e}),[]);return r}},methods:{dialogClose(e){this.$confirm("確定要關閉？").then((()=>{e()})).catch((()=>{}))},urgentTypeChgHandler(){this.form.urgent_Reason_raw=[],this.form.project_No2="",this.rules.project_No2=[],this.$refs.form.clearValidate("project_No2"),this.form.project_No4="",this.rules.project_No4=[],this.$refs.form.clearValidate("project_No4")},urgentReasonChgHandler(e,r){"202004160002"==e.urgent_Type_Pk&&(r?this.rules.project_No2=[{required:!0,message:"工程單號不得為空",trigger:"blur"},{len:12,message:"你選擇了[on call]項目，工程單號不得為空且應為12碼，請確認",trigger:"blur"}]:(this.form.project_No2="",this.rules.project_No2=[],this.$refs.form.clearValidate("project_No2"))),"202004160003"==e.urgent_Type_Pk&&(r?(this.form.project_No4="",this.rules.project_No4=[],this.$refs.form.clearValidate("project_No4")):-1!=this.form.urgent_Reason_raw.indexOf("202004160004")&&(this.rules.project_No4=[{required:!0,message:"你選擇了[人員無識別證]項目，如無工程單編號，請一併勾選[未開立工程]",trigger:"blur"},{len:12,message:"工程單號應為12碼，請確認",trigger:"blur"}])),"202004160004"==e.urgent_Type_Pk&&(r?-1==this.form.urgent_Reason_raw.indexOf("202004160003")&&(this.rules.project_No4=[{required:!0,message:"你選擇了[人員無識別證]項目，如無工程單編號，請一併勾選[未開立工程]",trigger:"blur"},{len:12,message:"工程單號應為12碼，請確認",trigger:"blur"}]):(this.form.project_No4="",this.rules.project_No4=[],this.$refs.form.clearValidate("project_No4")))},managerSearchHandler(e){this.managerLoading=!0,"Enter"!==e.code&&"NumpadEnter"!==e.code||this.throttledManagerSearch(e)},searchManager(e){this.managerLoading=!1,e.target.value&&this.$store.dispatch("getManagerList",e.target.value)},signerSearchHandler(e){this.signerLoading=!0,"Enter"!==e.code&&"NumpadEnter"!==e.code||this.throttledSignerSearch(e)},searchSigner(e){this.signerLoading=!1,e.target.value&&this.$store.dispatch("getSignerList",e.target.value)},dateRangeHandler(){this.form.begin_Date?this.rules.begin_Date=[{validator:this.validateDate,trigger:"change"}]:(this.rules.begin_Date=[],this.$refs.form.clearValidate("begin_Date")),this.form.end_Date?this.rules.end_Date=[{validator:this.validateDate,trigger:"change"}]:(this.rules.end_Date=[],this.$refs.form.clearValidate("end_Date"))},validateDate(e,r,t){let a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()/1e3,o=new Date(r).getTime()/1e3;if(o<s||o-s>=345600)t(new Error("申請日期不得超過三天"));else if(this.form.begin_Date&&this.form.end_Date){let e=new Date(this.form.begin_Date).getTime()/1e3,r=new Date(this.form.end_Date).getTime()/1e3;e>=r||r-e>86400?t(new Error("時間範圍無效，或施工時數超過24小時")):(this.$refs.form.clearValidate("begin_Date"),this.$refs.form.clearValidate("end_Date"),t())}else t()},addConstruction(){const e={name:"",id:"",birthday:"",card_Status:"",fileBase64:"",fileName:"",file_Id:"",key_Id:""};this.form.work_Person_List.push(e)},deleteConstruction(e){this.form.work_Person_List.splice(e,1)},async validateCard(e,r){this.insuranceFileRmvHandler("",e);try{await this.$store.dispatch("getValidCard",{ld1:this.form.ld1,s_Id:this.form.s_Id,id:r}),this.form.work_Person_List[e].card_Status=this.$store.state.cardValid?"1":"0"}catch(t){console.log(t)}},validateAge(e,r,t){let a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()/1e3,o=new Date(r).getTime()/1e3;s-o<567648e3?t(new Error("未滿18歲，無法送出施工單")):t()},async insuranceFileChgHandler(e,r){let t=e[0].raw,a=await this.toBase64(t);this.form.work_Person_List[r].fileName=e[0].name,this.form.work_Person_List[r].fileBase64=a,this.$refs.form.clearValidate("work_Person_List."+r+".fileName")},insuranceFileRmvHandler(e,r){this.form.work_Person_List[r].fileName="",this.form.work_Person_List[r].fileBase64="",this.$refs.form.validateField("work_Person_List."+r+".fileName")},toBase64(e){return new Promise(((r,t)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>r(a.result),a.onerror=e=>t(e)}))},async deleteFile(e,r,t){try{await this.$store.dispatch("delInsuranceFile",{fileName:r,fileId:t}),this.form.work_Person_List[e].file_Id="",this.form.work_Person_List[e].fileName="",this.form.work_Person_List[e].fileBase64=""}catch(a){console.log(a)}},workTypeChgHandler(){this.form.hightRiskType_raw=[],this.form.card_No32="",this.rules.card_No32=[],this.$refs.form.clearValidate("card_No32"),this.form.card_No35="",this.rules.card_No35=[],this.$refs.form.clearValidate("card_No35"),this.form.card_No41="",this.rules.card_No41=[],this.$refs.form.clearValidate("card_No41"),this.form.card_No42="",this.rules.card_No42=[],this.$refs.form.clearValidate("card_No42"),this.form.card_No43="",this.rules.card_No43=[],this.$refs.form.clearValidate("card_No43"),this.form.card_No44="",this.rules.card_No44=[],this.$refs.form.clearValidate("card_No44"),this.form.card_No51="",this.rules.card_No51=[],this.$refs.form.clearValidate("card_No51"),this.form.card_No71="",this.rules.card_No71=[],this.$refs.form.clearValidate("card_No71"),this.form.card_No91="",this.rules.card_No91=[],this.$refs.form.clearValidate("card_No91"),this.form.card_Other="",this.rules.card_Other=[],this.$refs.form.clearValidate("card_Other")},cardInputHandler(e,r){"200310010002"!=e.work_Type_Pk&&"201005250001"!=e.work_Type_Pk||r&&(this.hintVisible=!0),"201103160001"==e.work_Type_Pk&&(r?this.rules.card_No32=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}]:(this.form.card_No32="",this.rules.card_No32=[],this.$refs.form.clearValidate("card_No32"))),"202104200001"==e.work_Type_Pk&&(r?this.rules.card_No35=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}]:(this.form.card_No35="",this.rules.card_No35=[],this.$refs.form.clearValidate("card_No35"))),"200310150005"==e.work_Type_Pk&&(r?(this.rules.card_No41=[{required:!1,message:"選填",trigger:"blur"}],this.rules.card_No42=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}],this.rules.card_No43=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}],this.rules.card_No44=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}]):(this.form.card_No41="",this.rules.card_No41=[],this.$refs.form.clearValidate("card_No41"),this.form.card_No42="",this.rules.card_No42=[],this.$refs.form.clearValidate("card_No42"),this.form.card_No43="",this.rules.card_No43=[],this.$refs.form.clearValidate("card_No43"),this.form.card_No44="",this.rules.card_No44=[],this.$refs.form.clearValidate("card_No44"))),"200310150001"==e.work_Type_Pk&&(r?this.rules.card_No51=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}]:(this.form.card_No51="",this.rules.card_No51=[],this.$refs.form.clearValidate("card_No51"))),"200801090001"==e.work_Type_Pk&&(r?this.rules.card_No71=[{required:!1,message:"選填",trigger:"blur"}]:(this.form.card_No71="",this.rules.card_No71=[],this.$refs.form.clearValidate("card_No71"))),"200310150006"==e.work_Type_Pk&&(r?this.rules.card_No91=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}]:(this.form.card_No91="",this.rules.card_No91=[],this.$refs.form.clearValidate("card_No91"))),"200403220001"==e.work_Type_Pk&&(r?this.rules.card_Other=[{required:!0,message:"必填",trigger:"blur"}]:(this.form.card_Other="",this.rules.card_Other=[],this.$refs.form.clearValidate("card_Other")))},hintClose(e){this.$confirm("確定要關閉？").then((()=>{e()})).catch((()=>{}))},async validateLicense(e,r,t){const a={d:this.form.work_Person_List.map((e=>e.id)),d2:this.form.s_Id,lincense:[r]};try{await this.$store.dispatch("getValidLicense",a),this.$store.state.idValid?t():t(new Error("證照號碼不正確"))}catch(s){console.log(s)}},resetForm(e){this.$refs[e].resetFields(),this.form.work_Person_List=[],this.addConstruction()},submitForm(e,r){this.form.isDraft=r,this.$refs[e].validate((async e=>{if(e){this.form.urgent_Reason=[];for(let e=0;e<this.form.urgent_Reason_raw.length;e++){let r=this.form.urgent_Reason_raw[e],t=this.reasonList.filter((e=>e.urgent_Type_Pk==r))[0];"202004160002"==r?t.extra_Common=this.form.project_No2:"202004160004"==r&&(t.extra_Common=this.form.project_No4),this.form.urgent_Reason.push(t)}this.form.hightRiskType=[];for(let e=0;e<this.form.hightRiskType_raw.length;e++){let r=this.form.hightRiskType_raw[e],t=this.$store.state.worktype_list.filter((e=>e.work_Type_Pk==r))[0];"201103160001"==r?t.extra_Common=this.form.card_No32:"202104200001"==r?t.extra_Common=this.form.card_No35:"200310150005"==r?t.extra_Common=`${this.form.card_No41}, ${this.form.card_No42}, ${this.form.card_No43}, ${this.form.card_No44}`:"200310150001"==r?t.extra_Common=this.form.card_No51:"200801090001"==r?t.extra_Common=this.form.card_No71:"200310150006"==r?t.extra_Common=this.form.card_No91:"200403220001"==r&&(t.extra_Common=this.form.card_Other),this.form.hightRiskType.push(t)}try{await this.$store.dispatch("submitApply",this.form),this.$message({type:"success",duration:5e3,showClose:!0,message:"申請成功"}),this.$router.go(0)}catch(r){console.log(r)}}else this.$message({type:"error",showClose:!0,message:"資料填寫錯誤"})}))},throttledManagerSearch:null,throttledSignerSearch:null},async mounted(){this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0;const e=document.querySelector(".position-fixed"),r=e.offsetHeight,t=document.querySelector(".apply");t.style.marginBottom=`${r}px`;try{if(this.prjNo=this.$route.params.prjNo,this.$route.params.prjNo){let e=await this.$store.dispatch("getApplyDataB",this.$route.params.prjNo),r={...e.data.data.insertData};r.urgent_Reason_raw=[],r.project_No2="",r.project_No4="";for(let t=0;t<r.urgent_Reason.length;t++){let e=r.urgent_Reason[t].urgent_Type_Pk;r.urgent_Reason_raw.push(e),"202004160002"==e?(r.project_No2=r.urgent_Reason[t].extra_Common,this.rules.project_No2=[{required:!0,message:"工程單號不得為空",trigger:"blur"},{len:12,message:"你選擇了[on call]項目，工程單號不得為空且應為12碼，請確認",trigger:"blur"}]):"202004160004"==e&&(r.project_No4=r.urgent_Reason[t].extra_Common,-1==r.urgent_Reason_raw.indexOf("202004160003")&&(this.rules.project_No4=[{required:!0,message:"你選擇了[人員無識別證]項目，如無工程單編號，請一併勾選[未開立工程]",trigger:"blur"},{len:12,message:"工程單號應為12碼，請確認",trigger:"blur"}]))}r.hightRiskType_raw=[],r.card_No32="",r.card_No35="",r.card_No41="",r.card_No42="",r.card_No43="",r.card_No44="",r.card_No51="",r.card_No71="",r.card_No91="",r.card_Other="";for(let t=0;t<r.hightRiskType.length;t++){let e=r.hightRiskType[t].work_Type_Pk;if(r.hightRiskType_raw.push(e),"201103160001"==e)r.card_No32=r.hightRiskType[t].extra_Common,this.rules.card_No32=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}];else if("202104200001"==e)r.card_No35=r.hightRiskType[t].extra_Common,this.rules.card_No35=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}];else if("200310150005"==e){let e=r.hightRiskType[t].extra_Common.split(",");r.card_No41=e[0],r.card_No42=e[1],r.card_No43=e[2],r.card_No44=e[3],this.rules.card_No41=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}],this.rules.card_No42=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}],this.rules.card_No43=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}],this.rules.card_No44=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}]}else"200310150001"==e?(r.card_No51=r.hightRiskType[t].extra_Common,this.rules.card_No51=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}]):"200801090001"==e?(r.card_No71=r.hightRiskType[t].extra_Common,this.rules.card_No71=[{required:!0,message:"必填",trigger:"blur"}]):"200310150006"==e?(r.card_No91=r.hightRiskType[t].extra_Common,this.rules.card_No91=[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateLicense,trigger:"blur"}]):"200403220001"==e&&(r.card_Other=r.hightRiskType[t].extra_Common,this.rules.card_Other=[{required:!0,message:"必填",trigger:"blur"}])}this.form=r}else this.addConstruction(),await this.$store.dispatch("getApplyDataA")}catch(a){console.log(a)}},created(){this.throttledManagerSearch=this.throttle(this.searchManager,2500,!1),this.throttledSignerSearch=this.throttle(this.searchSigner,2500,!1)}},n=l,c=t(1001),d=(0,c.Z)(n,a,s,!1,null,"a19e5882",null),m=d.exports}}]);
//# sourceMappingURL=5910.fa2b31cf58646973.js.map