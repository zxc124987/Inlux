"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[9831],{4865:function(t,e,a){a.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.totalLength,"current-page":t.currentPage},on:{"current-change":t.changePage}})],1)},r=[],o={name:"pagination1-component",props:["totalLength"],computed:{currentPage(){return this.$store.state.currentPage}},methods:{changePage(t){this.$emit("changePageHandler",t)}},mounted(){}},n=o,l=a(1001),i=(0,l.Z)(n,s,r,!1,null,"86225bf4",null),c=i.exports},1919:function(t,e,a){a.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-responsive"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.data,"row-key":t.getRowKeys,"default-sort":{prop:"id",order:"ascending"},"empty-text":"查無資料","cell-class-name":t.rowStyleHandler,border:"","highlight-current-row":""},on:{"selection-change":t.selectChangeHandler}},[t._t("custom-selection"),t._t("custom-checkbox1"),t._t("custom-checkbox2"),t._l(t.tableColumns,(function(a,s){return e("el-table-column",{key:s,attrs:{prop:a.id,label:a.label,width:a.width,sortable:"date"===a.id},scopedSlots:t._u([{key:"default",fn:function(s){return["status"===a.id?e("el-tag",{attrs:{type:"簽核通過"===s.row.status||"審核通過"===s.row.status?"success":"拒絕申請"===s.row.status?"danger":"草稿"===s.row.status?"warning":"查無資料"}},[t._v(" "+t._s(s.row.status)+" ")]):"status_Id"===a.id?e("el-tag",{attrs:{type:"OPEN"===s.row.status_Id?"":"CLOSE"===s.row.status_Id?"danger":"FULL"===s.row.status_Id?"warning":"success"}},[t._v(" "+t._s(t.getCourseState(s.row.status_Id))+" ")]):"description2"===a.id?e("el-tag",{attrs:{type:"有效課程"===s.row.description?"":"danger"}},[t._v(" "+t._s(s.row.description)+" ")]):"approve_Status"===a.id?e("el-tag",{attrs:{type:"0"===s.row.approve_Status?"":"1"===s.row.approve_Status?"success":"danger"}},[t._v(" "+t._s(t.getApproveStatus(s.row.approve_Status))+" ")]):"approve_Status2"===a.id?e("el-tag",{attrs:{type:"審核中"===s.row.approve_Status2||"未審核"===s.row.approve_Status2?"":"審核完畢"===s.row.approve_Status2||"審核同意"===s.row.approve_Status2?"success":"danger"}},[t._v(" "+t._s(s.row.approve_Status2)+" ")]):"attend_Status"===a.id?e("el-tag",{attrs:{type:"0"===s.row.attend_Status?"":"1"===s.row.attend_Status?"success":"danger"}},[t._v(" "+t._s(t.getAttendStatus(s.row.attend_Status))+" ")]):"issue_Card"===a.id?e("el-tag",{attrs:{type:"0"===s.row.issue_Card?"":"1"===s.row.issue_Card?"success":"danger"}},[t._v(" "+t._s(t.getIssueCardStatus(s.row.issue_Card))+" ")]):"signUpStatus"===a.id?e("el-tag",{attrs:{type:"已結案"===t.signUpStatus(s.row.signUpStatus,s.row.approveStatus)?"success":"可取消報名"===t.signUpStatus(s.row.signUpStatus,s.row.approveStatus)?"danger":""}},[t._v(" "+t._s(t.signUpStatus(s.row.signUpStatus,s.row.approveStatus))+" ")]):"file_Name"===a.id||"d_File_Name"===a.id?e("a",{attrs:{href:"#"},on:{click:function(e){return t.downloadPdf(s.row)}}},[t._v(t._s(s.row[a.id]))]):"protocolInfo"===a.id?e("div",[e("div",[t._v(t._s(s.row.po_Name))]),t._l(s.row.files,(function(a){return e("div",[e("a",{attrs:{href:"#"},on:{click:function(e){return t.downloadPdf(a)}}},[t._v(t._s(a.file_Name))])])}))],2):"useable"===a.id&&"已刪除(廠商不可申請每日工單)"===s.row.useable?e("span",{staticStyle:{color:"red"}},[t._v(t._s(s.row.useable))]):"deleted"===a.id?e("span",{class:{"text-danger":"1"===s.row.deleted}},[t._v(" "+t._s(s.row.effect)+" ")]):"array_data"===a.id?e("span",t._l(s.row[a.id],(function(a,s){return e("p",{key:s,staticClass:"mb-0"},[t._v(t._s(a))])})),0):RegExp(/\n/).test(s.row[s.column.property])?e("span",{staticStyle:{"white-space":"pre-wrap"}},[t._v(" "+t._s(s.row[a.id])+" ")]):e("span",[t._v(t._s(s.row[a.id]))])]}}],null,!0)})})),t._t("custom-edit-select"),t._t("custom-switch"),t._t("custom-function"),t._t("slot-sheet-open")],2)],1)},r=[],o={name:"table-component",props:["data","tableColumns"],data(){return{api:this.apiUrl,loading:!0}},methods:{selectChangeHandler(t){this.$emit("selectionChange",t)},downloadPdf(t){const e=t.file_Id;this.$emit("downloadPdfHandler",e),this.$emit("downloadPdfHandler2",t)},getRowKeys(t){return t.index?t.index:t.id},rowStyleHandler(t){if("1"===t.row.isWeekend||"1"===t.row.isNight)return"fontColorBlue"}},mounted(){this.data&&(this.loading=!1)}},n=o,l=a(1001),i=(0,l.Z)(n,s,r,!1,null,"4a0f1604",null),c=i.exports},9831:function(t,e,a){a.r(e),a.d(e,{default:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:this.$root.overlay,expression:"this.$root.overlay",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"wrapper"},[e("h2",{staticClass:"form-title mb-4"},[t._v("消防中斷申請作業查詢")]),e("el-card",{staticClass:"mb-4",attrs:{shadow:"never"}},[e("el-form",{ref:"form",attrs:{rules:t.rules,model:t.form}},[e("div",{staticClass:"d-flex"},[e("el-form-item",{staticClass:"w-100",attrs:{label:"消防中斷申請單號",prop:"InsuranceNo"}},[e("el-input",{attrs:{placeholder:"請輸入工程單單號"},model:{value:t.form.InsuranceNo,callback:function(e){t.$set(t.form,"InsuranceNo",e)},expression:"form.InsuranceNo"}})],1),e("el-form-item",{staticClass:"w-100 ms-2",attrs:{label:"工程單單號",prop:"Project_No"}},[e("el-select",{attrs:{placeholder:"請選擇"},model:{value:t.form.Project_No,callback:function(e){t.$set(t.form,"Project_No",e)},expression:"form.Project_No"}})],1)],1),e("div",{staticClass:"d-flex"},[e("el-form-item",{staticClass:"w-100",attrs:{label:"廠區選擇",prop:"Location_Id"}},[e("el-select",{attrs:{placeholder:"請選擇"},model:{value:t.form.Location_Id,callback:function(e){t.$set(t.form,"Location_Id",e)},expression:"form.Location_Id"}},[e("el-option",{attrs:{label:"全部",value:"LOCATION_ID"}}),t._l(t.facs,(function(t,a){return e("el-option",{key:a,attrs:{label:t.description,value:t.location_Id}})}))],2)],1),e("el-form-item",{staticClass:"w-100 ms-2",attrs:{label:"文件狀態",prop:"Status"}},[e("el-select",{attrs:{placeholder:"請選擇"},model:{value:t.form.Status,callback:function(e){t.$set(t.form,"Status",e)},expression:"form.Status"}},[e("el-option",{attrs:{value:"ALL",label:"全部"}}),e("el-option",{attrs:{value:"DONE",label:"簽核完成"}}),e("el-option",{attrs:{value:"REJECT",label:"退件"}}),e("el-option",{attrs:{value:"NEW",label:"簽核中"}})],1)],1)],1),e("div",{staticClass:"d-flex"},[e("el-form-item",{staticClass:"w-100",attrs:{label:"通知狀態",prop:"NotifyStatus"}},[e("el-select",{attrs:{placeholder:"請選擇"},model:{value:t.form.NotifyStatus,callback:function(e){t.$set(t.form,"NotifyStatus",e)},expression:"form.NotifyStatus"}},[e("el-option",{attrs:{value:"ALL",label:"全部"}}),e("el-option",{attrs:{value:"ISENTER",label:"中斷通知"}}),e("el-option",{attrs:{value:"ISRETIRED",label:"終止通知"}}),e("el-option",{attrs:{value:"NONE",label:"未通知"}})],1)],1),e("el-form-item",{staticClass:"w-100 ms-2",attrs:{label:"歷史資料",prop:"WorkDate"}},[e("el-date-picker",{staticClass:"w-100",attrs:{type:"daterange","value-format":"yyyy/MM/dd","range-separator":"～","start-placeholder":"開始日期","end-placeholder":"結束日期"},model:{value:t.form.WorkDate,callback:function(e){t.$set(t.form,"WorkDate",e)},expression:"form.WorkDate"}})],1)],1)]),e("div",[e("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(e){return t.resetForm("form")}}},[t._v("清除")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.searchForm("form")}}},[t._v("查詢")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.exportExcel("form")}}},[t._v("匯出 Excel")])],1)],1),e("div",{staticClass:"d-flex"},[t.selectedEnter.length?e("div",{staticClass:"selected-box me-2 mb-3"},[e("span",{staticClass:"me-2"},[t._v("已選 "+t._s(t.selectedEnter.length)+" 項")]),[e("el-popconfirm",{attrs:{title:"確定要消防中斷嗎？","cancel-button-type":"plain"},on:{confirm:t.confirmEnter}},[e("el-button",{attrs:{slot:"reference",size:"small",type:"danger"},slot:"reference"},[t._v("消防中斷通知")])],1)]],2):t._e(),t.selectedRetired.length?e("div",{staticClass:"selected-box mb-3"},[e("span",{staticClass:"me-2"},[t._v("已選 "+t._s(t.selectedRetired.length)+" 項")]),[e("el-popconfirm",{attrs:{title:"確定要消防終止嗎？","cancel-button-type":"plain"},on:{confirm:t.confirmRetired}},[e("el-button",{attrs:{slot:"reference",size:"small",type:"danger"},slot:"reference"},[t._v("消防終止通知")])],1)]],2):t._e()]),e("TableComponent",{ref:"insuranceTable",attrs:{data:t.tableList,tableColumns:t.fireSuspendApplyTableColumns},scopedSlots:t._u([{key:"custom-checkbox1",fn:function(){return[e("el-table-column",{attrs:{label:"消防中斷通知",width:"125"},scopedSlots:t._u([{key:"default",fn:function(a){return[null===a.row.enter_Date?e("el-checkbox",{attrs:{checked:a.row.enterCheck},on:{change:function(e){return t.stopEnterHandler(e,a.row)}}}):e("span",{staticClass:"text-danger"},[t._v(t._s(a.row.enter_Date))])]}}])})]},proxy:!0},{key:"custom-checkbox2",fn:function(){return[e("el-table-column",{attrs:{label:"消防終止通知",width:"125"},scopedSlots:t._u([{key:"default",fn:function(a){return[null===a.row.retired?e("el-checkbox",{attrs:{checked:a.row.retiredCheck},on:{change:function(e){return t.overRetiredHandler(e,a.row)}}}):e("span",{staticClass:"text-danger"},[t._v(t._s(a.row.Retired_Date))])]}}])})]},proxy:!0},{key:"slot-sheet-open",fn:function(){return[e("el-table-column",{attrs:{label:"作業施工單",width:"130"},scopedSlots:t._u([{key:"default",fn:function(a){return t._l(a.row.daily_No,(function(a,s){return e("div",{key:s},[e("a",{attrs:{href:"#"},on:{click:function(e){return t.openWorkOrderDetails(a)}}},[t._v(t._s(a))])])}))}}])})]},proxy:!0}])}),e("Pagination1",{attrs:{totalLength:t.tableData.length},on:{changePageHandler:t.changePage}})],1)},r=[],o=(a(7658),a(1919)),n=a(4865),l=a(942),i={name:"fireSuspendApplyComponent",components:{TableComponent:o.Z,Pagination1:n.Z},data(){return{form:{WorkDate:[this.formatDate(new Date),this.formatDate(new Date)],WorkDate1:"",WorkDate2:"",Location_Id:"LOCATION_ID",Project_No:"",InsuranceNo:"",NotifyStatus:"ALL",Status:"ALL"},rules:{WorkDate:[{required:!0,message:"必填",trigger:"change"}]},fireSuspendApplyTableColumns:[{id:"index",label:"項次",width:"70"},{id:"insurance_No",label:"中斷申請單號",width:"140"},{id:"project_No",label:"工程單單號",width:"140"},{id:"factory",label:"廠區/廠商名稱",width:"200"},{id:"department",label:"發包工程師/部門",width:"140"},{id:"dateRange",label:"中斷期間",width:"200"},{id:"status",label:"簽核狀態",width:"140"}],selectedEnter:[],selectedRetired:[],facs:[],tableData:[],tableList:[]}},computed:{},methods:{formatWorkDate(t){this.form.WorkDate1=t.WorkDate[0],this.form.WorkDate2=t.WorkDate[1]},stopEnterHandler(t,e){t?(this.selectedEnter.push(e.insurance_No),e.enterCheck=!0):(this.selectedEnter=this.selectedEnter.filter((t=>t!==e.insurance_No)),e.enterCheck=!1)},overRetiredHandler(t,e){t?(this.selectedRetired.push(e.insurance_No),e.retiredCheck=!0):(this.selectedRetired=this.selectedRetired.filter((t=>t!==e.insurance_No)),e.retiredCheck=!1)},async confirmEnter(){try{const t={Enter:this.selectedEnter,Retired:[]},e=await this.$store.dispatch("OSHUpdInsuranceNotify",t);e.data.isOK&&(this.$message({type:"success",duration:5e3,showClose:!0,message:"消防中斷修改成功"}),this.getInsuranceList(this.form),this.$refs.insuranceTable.$refs.multipleTable.clearSelection(),this.selectedEnter=[],this.selectedRetired=[],this.$store.state.currentPage=1)}catch(t){console.log(t)}},async confirmRetired(){try{const t={Enter:[],Retired:this.selectedRetired},e=await this.$store.dispatch("OSHUpdInsuranceNotify",t);e.data.isOK&&(this.$message({type:"success",duration:5e3,showClose:!0,message:"消防終止修改成功"}),this.getInsuranceList(this.form),this.$refs.insuranceTable.$refs.multipleTable.clearSelection(),this.selectedEnter=[],this.selectedRetired=[],this.$store.state.currentPage=1)}catch(t){console.log(t)}},changePage(t){this.$store.state.currentPage=t;const e=10*(t-1),a=10*t;this.tableList=this.tableData.slice(e,a)},openWorkOrderDetails(t){window.open(`/#/engineeringDataManagementViewDetail/${encodeURIComponent(t)}`)},async exportExcel(t){this.$refs[t].validate((async t=>{if(t){this.formatWorkDate(this.form);try{const t=await this.$store.dispatch("commonExportExcel",{obj:this.form,router_Name:l.getOSH,action_Name:"ExportInsurance"});this.downloadFile(t,"消防中斷申請","xlsx")}catch(e){console.log(e)}}else this.$message({type:"error",duration:5e3,showClose:!0,message:"資料填寫錯誤"})}))},resetForm(t){this.$refs[t].resetFields()},searchForm(t){this.$refs[t].validate((async t=>{t?(this.formatWorkDate(this.form),this.getInsuranceList(this.form)):this.$message({type:"error",duration:5e3,showClose:!0,message:"資料填寫錯誤"})}))},async getInsuranceList(t){try{const e=this.getURLNewParams(t),a=await this.$store.dispatch("OSHQryInsuranceList",e),s=a.data.data;this.tableData=JSON.parse(JSON.stringify(s)),this.tableData.forEach(((t,e)=>{t.index=e+1,t.factory=`${t.location_Name}/${t.s_Name}`,t.department=`${t.emp_Name}(${t.emp_No})/${t.dept_Name}`,t.dateRange=`${t.begin_Work_Date} ~ ${t.end_Work_Date}`,t.status=this.convertStatus(t.status)})),this.tableList=this.tableData.slice(0,10)}catch(e){console.log(e)}},async getInsuranceCondition(){try{const t=await this.$store.dispatch("OSHQryInsuranceCondition"),e=t.data.data;this.facs=e.facs}catch(t){console.log(t)}}},mounted(){this.getInsuranceCondition(),this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0}},c=i,d=a(1001),u=(0,d.Z)(c,s,r,!1,null,null,null),p=u.exports}}]);
//# sourceMappingURL=9831.0cc22d908c1dab05.js.map