"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[8341],{8341:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}});var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:this.$root.overlay,expression:"this.$root.overlay",modifiers:{fullscreen:!0,lock:!0}}],style:{marginBottom:e.positionFixedHeight}},[t("div",{staticClass:"wrapper"},[t("el-button",{staticClass:"goBack",attrs:{type:"text"},on:{click:function(t){return e.goBack()}}},[t("i",{staticClass:"el-icon-back me-1"}),e._v("回上頁 ")]),t("h2",{staticClass:"form-title"},[e._v("申請每日工作許可單")]),t("el-card",{attrs:{shadow:"never"}},[t("form",{staticClass:"mb-4"},[t("div",{staticClass:"form-group mb-2"},[t("label",[e._v("工程編號：")]),t("span",[e._v(e._s(e.vdrList.project_No))])]),t("div",{staticClass:"form-group mb-2"},[t("label",[e._v("工程名稱：")]),t("span",[e._v(e._s(e.vdrList.project_Name))])]),t("div",{staticClass:"form-group mb-2"},[t("label",[e._v("工作區域：")]),t("span",[e._v(e._s(e.vdrList.col3))])])]),t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[t("el-row",[t("el-col",{attrs:{span:3}},[t("h3",{staticClass:"row-title"},[e._v("施工資訊")])]),t("el-col",{attrs:{span:21}},[t("el-form-item",{attrs:{label:"廠商施工負責人 / 安衛人員",prop:"Duty_Id"}},[t("div",{staticClass:"el-text-success directions"},[e._v("必需當天到場監工 (南廠區已連接門禁，未到場將導致本施工單失效)")]),t("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.form.Duty_Id,callback:function(t){e.$set(e.form,"Duty_Id",t)},expression:"form.Duty_Id"}},e._l(e.dutyPeople,(function(e,r){return t("el-option",{key:e.id,attrs:{label:e.p_Name+"("+e.short_Name+")",value:e.id+"-"+r}})})),1)],1),t("el-form-item",{attrs:{label:"廠商施工負責人 / 安衛人員代理人",prop:"Safe_Id"}},[t("div",{staticClass:"directions"},[e._v("必需當天到場監工 (非必填，其權責與權限同施工負責人)")]),t("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.form.Safe_Id,callback:function(t){e.$set(e.form,"Safe_Id",t)},expression:"form.Safe_Id"}},e._l(e.dutyPeople,(function(e,r){return t("el-option",{key:e.id,attrs:{label:e.p_Name+"("+e.short_Name+")",value:e.id+"-"+r}})})),1)],1),t("el-form-item",{attrs:{label:"次工作區",prop:"Area_Pk"}},[t("div",{staticClass:"directions mb-0"},[e._v("1. 如果您不知道施工區域，請向發包工程師查詢次工作區")]),t("div",{staticClass:"directions"},[e._v("2. 如果無區域可選表示該區域尚未設定[次區域]")]),t("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.form.Area_Pk,callback:function(t){e.$set(e.form,"Area_Pk",t)},expression:"form.Area_Pk"}},e._l(e.secondWorkArea,(function(e){return t("el-option",{key:e.id,attrs:{label:e.description,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"工作內容",prop:"Work_Content"}},[t("el-input",{attrs:{type:"textarea",rows:"4"},model:{value:e.form.Work_Content,callback:function(t){e.$set(e.form,"Work_Content",t)},expression:"form.Work_Content"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:3}},[t("h3",{staticClass:"row-title"},[e._v("作業選項")])]),t("el-col",{attrs:{span:21}},[t("el-form-item",{attrs:{label:"作業種類",prop:"Work_Type_Normal"}},[t("el-radio",{attrs:{label:"0"},on:{change:function(t){return e.workTypeNormalHandler()}},model:{value:e.form.Work_Type_Normal,callback:function(t){e.$set(e.form,"Work_Type_Normal",t)},expression:"form.Work_Type_Normal"}},[e._v("一般作業")]),t("el-radio",{attrs:{label:"1"},on:{change:function(t){return e.workTypeNormalHandler()}},model:{value:e.form.Work_Type_Normal,callback:function(t){e.$set(e.form,"Work_Type_Normal",t)},expression:"form.Work_Type_Normal"}},[e._v("高風險作業")])],1),t("el-form-item",{attrs:{label:"施工日期",prop:"0"===e.form.Work_Type_Normal?"constructionDateRange":"constructionDate"}},[t("div",{staticClass:"el-text-danger"},[e._v("注意：下方作業選項勾選「一般作業」可選擇區間日期，勾選「高風險作業」只能選擇單日。")]),t("div",{staticClass:"el-text-success"},[e._v("可申請時間：未來 10 天 (由本日起算，六、日與國定假日=假日施工)")]),e.vdrList.begin_Date&&e.vdrList.end_Date?t("div",{staticClass:"el-text-success mb-1"},[e._v("工程日期："+e._s(e.vdrList.begin_Date)+" ~ "+e._s(e.vdrList.end_Date))]):e._e(),"0"===e.form.Work_Type_Normal?t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy/MM/dd","range-separator":"~","start-placeholder":"開始日期","end-placeholder":"結束日期","picker-options":e.pickerOptions},on:{change:e.constructionDateChange,blur:e.constructionDateChange},model:{value:e.form.constructionDateRange,callback:function(t){e.$set(e.form,"constructionDateRange",t)},expression:"form.constructionDateRange"}}):e._e(),"1"===e.form.Work_Type_Normal?t("el-date-picker",{attrs:{type:"date","value-format":"yyyy/MM/dd",placeholder:"選擇日期","picker-options":e.pickerOptions},on:{change:e.constructionDateChange},model:{value:e.form.constructionDate,callback:function(t){e.$set(e.form,"constructionDate",t)},expression:"form.constructionDate"}}):e._e()],1),t("el-form-item",{attrs:{label:"施工時間",prop:"constructionTime"}},[t("div",{staticClass:"directions"},[e._v("夜間施工 (18:00 ~ 08:00)")]),t("el-time-picker",{attrs:{"is-range":"","range-separator":"~","value-format":"HH:mm",format:"HH:mm","start-placeholder":"開始時間","end-placeholder":"結束時間",placeholder:"選擇時間範圍"},model:{value:e.form.constructionTime,callback:function(t){e.$set(e.form,"constructionTime",t)},expression:"form.constructionTime"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"1"===e.form.Work_Type_Normal&&e.form.Duty_Id&&e.form.constructionDate,expression:"form.Work_Type_Normal === '1' && form.Duty_Id && form.constructionDate"}]},[t("el-form-item",{attrs:{label:"高風險作業"}},[t("div",{staticClass:"el-text-success mb-3"},[e._v("僅可以選擇工程單已勾選之高風險作業項目")]),t("el-form-item",{},e._l(e.high_Risk_type,(function(r,i){return t("el-form-item",{key:i},[t("el-form-item",{attrs:{prop:"allWorkType"}},[t("label",[e._v(e._s(i+1)+". "+e._s(r.class_Name))]),t("el-checkbox-group",{model:{value:e.form.allWorkType,callback:function(t){e.$set(e.form,"allWorkType",t)},expression:"form.allWorkType"}},e._l(r.value,(function(r,i){return t("el-checkbox",{key:i,staticClass:"d-flex w-100",attrs:{label:r.work_Type_Pk,disabled:r.disable},on:{change:function(t){return e.highRiskTypeChange(r,t)}}},[e._v(" "+e._s(r.work_Type_Name)+"("+e._s(r.description)+") "),"201103160001"===r.work_Type_Pk?t("el-form-item",{staticClass:"my-2",attrs:{prop:"input3_1"}},[t("div",{staticClass:"directions"},[e._v("施工架組配作業主管證號：")]),t("el-input",{ref:"input3_1",refInFor:!0,attrs:{placeholder:"請輸入證號",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("201103160001")},on:{change:function(t){return e.changeLicenseInput("input3_1")}},model:{value:e.form.input3_1,callback:function(t){e.$set(e.form,"input3_1",t)},expression:"form.input3_1"}})],1):e._e(),"202104200001"===r.work_Type_Pk?t("el-form-item",{staticClass:"my-2",attrs:{prop:"input3_2"}},[t("div",{staticClass:"directions"},[e._v("屋頂作業主管證號：")]),t("el-input",{ref:"input3_2",refInFor:!0,attrs:{placeholder:"請輸入證號",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("202104200001")},on:{change:function(t){return e.changeLicenseInput("input3_2")}},model:{value:e.form.input3_2,callback:function(t){e.$set(e.form,"input3_2",t)},expression:"form.input3_2"}})],1):e._e(),"200310150005"===r.work_Type_Pk?t("el-row",[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{staticClass:"my-2",attrs:{prop:"input4_1"}},[t("div",{staticClass:"directions"},[e._v("吊車合格證號：")]),t("el-input",{ref:"input4_1",refInFor:!0,attrs:{placeholder:"請輸入證號",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("200310150005")},on:{change:function(t){return e.changeLicenseInput("input4_1")}},model:{value:e.form.input4_1,callback:function(t){e.$set(e.form,"input4_1",t)},expression:"form.input4_1"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{staticClass:"ms-3 my-2",attrs:{prop:"input4_2"}},[t("div",{staticClass:"directions"},[e._v("吊掛合格證號：")]),t("el-input",{ref:"input4_2",refInFor:!0,attrs:{placeholder:"請輸入證號",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("200310150005")},on:{change:function(t){return e.changeLicenseInput("input4_2")}},model:{value:e.form.input4_2,callback:function(t){e.$set(e.form,"input4_2",t)},expression:"form.input4_2"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{staticClass:"my-2",attrs:{prop:"input4_3"}},[t("div",{staticClass:"directions"},[e._v("指揮手合格證號：")]),t("el-input",{ref:"input4_3",refInFor:!0,attrs:{placeholder:"請輸入證號",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("200310150005")},on:{change:function(t){return e.changeLicenseInput("input4_3")}},model:{value:e.form.input4_3,callback:function(t){e.$set(e.form,"input4_3",t)},expression:"form.input4_3"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{staticClass:"ms-3 my-2",attrs:{prop:"input4_4"}},[t("div",{staticClass:"directions"},[e._v("操作手合格證號：")]),t("el-input",{ref:"input4_4",refInFor:!0,attrs:{placeholder:"請輸入證號",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("200310150005")},on:{change:function(t){return e.changeLicenseInput("input4_4")}},model:{value:e.form.input4_4,callback:function(t){e.$set(e.form,"input4_4",t)},expression:"form.input4_4"}})],1)],1)],1)],1):e._e(),"200310150001"===r.work_Type_Pk?t("el-form-item",{staticClass:"my-2",attrs:{prop:"input5_1"}},[t("div",{staticClass:"directions"},[e._v("缺氧作業主管證號：")]),t("el-input",{ref:"input5_1",refInFor:!0,attrs:{placeholder:"請輸入證號",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("200310150001")},on:{change:function(t){return e.changeLicenseInput("input5_1")}},model:{value:e.form.input5_1,callback:function(t){e.$set(e.form,"input5_1",t)},expression:"form.input5_1"}})],1):e._e(),"200801090001"===r.work_Type_Pk?t("el-form-item",{staticClass:"my-2",attrs:{prop:"input7_1"}},[t("div",{staticClass:"directions"},[e._v("by pass 機台名稱：")]),t("el-input",{ref:"input7_1",refInFor:!0,attrs:{placeholder:"請輸入證號",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("200801090001")},on:{change:function(t){return e.changeLicenseInput("input7_1")}},model:{value:e.form.input7_1,callback:function(t){e.$set(e.form,"input7_1",t)},expression:"form.input7_1"}})],1):e._e(),"200310150006"===r.work_Type_Pk?t("el-form-item",{staticClass:"my-2",attrs:{prop:"input9_1"}},[t("div",{staticClass:"directions"},[e._v("有機/特化作業主管證號：")]),t("el-input",{ref:"input9_1",refInFor:!0,attrs:{placeholder:"請輸入證號",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("200310150006")},on:{change:function(t){return e.changeLicenseInput("input9_1")}},model:{value:e.form.input9_1,callback:function(t){e.$set(e.form,"input9_1",t)},expression:"form.input9_1"}})],1):e._e(),"200403220001"===r.work_Type_Pk?t("el-form-item",{staticClass:"my-2",attrs:{prop:"input11_1"}},[t("el-input",{ref:"input11_1",refInFor:!0,attrs:{placeholder:"請輸入其他項目",disabled:e.form.constructionWorkers&&!e.form.constructionWorkers.length||e.form.allWorkType&&-1===e.form.allWorkType.indexOf("200403220001")},on:{change:function(t){return e.changeLicenseInput("input11_1")}},model:{value:e.form.input11_1,callback:function(t){e.$set(e.form,"input11_1",t)},expression:"form.input11_1"}})],1):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:"200310150003"===r.work_Type_Pk&&e.form.allWorkType&&-1!==e.form.allWorkType.indexOf("200310150003"),expression:"detail.work_Type_Pk === '200310150003' && (form.allWorkType && form.allWorkType.indexOf('200310150003') !== -1)"}],staticClass:"card rounded-1 mt-2 p-3"},[t("h3",{staticClass:"row-title mb-3"},[e._v("消防中斷申請")]),t("el-form-item",{staticClass:"mb-4",attrs:{label:"中斷申請單單號",prop:"insurance_no"}},[t("div",{staticClass:"directions"},[e._v(" 若未開立中斷申請單請填寫以下資訊，系統會在送審後產生中斷申請單單號。 ")]),t("el-select",{attrs:{placeholder:"請選擇"},on:{change:e.insuranceNoHandler},model:{value:e.form.insurance_no,callback:function(t){e.$set(e.form,"insurance_no",t)},expression:"form.insurance_no"}},e._l(e.dailyInsuranceData,(function(e,r){return t("el-option",{key:r,attrs:{label:"消防單單號: "+e.insurance_no+", 工程單單號: "+e.project_No,value:e.insurance_no}})})),1)],1),t("div",{staticClass:"table-view"},[t("div",{staticClass:"table-responsive"},[t("table",{staticClass:"table table-bordered"},[t("tbody",[t("tr",[t("th",[e._v("申請部門")]),t("td",[e._v(e._s(e.vdrList.emp_Dept_Full_Name))]),t("th",[e._v("工程承辦人")]),t("td",[e._v(e._s(e.form.SidProjectDailyInsurance.emp_No))])]),t("tr",[t("th",[e._v("聯絡電話")]),t("td",[e._v(e._s(e.form.SidProjectDailyInsurance.tel1))]),t("th",[e._v("施工廠商")]),t("td",[e._v(e._s(e.sidSupplier.short_Name))])]),t("tr",[t("th",[e._v("廠商現場負責人")]),t("td",[e._v(e._s(e.form.SidProjectDailyInsurance.duty_Name))]),t("th",[e._v("現場電話")]),t("td",[e._v(e._s(e.form.SidProjectDailyInsurance.duty_Tel))])])])])])]),t("el-form-item",{staticClass:"mb-4",attrs:{label:"預計作業時間",prop:"estimatedWorkingTime"}},[t("div",{staticClass:"directions"},[e._v("申請時間以 7 天為限")]),t("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy/MM/dd HH:mm",format:"yyyy/MM/dd HH:mm","range-separator":"~","start-placeholder":"開始日期","end-placeholder":"結束日期","picker-options":e.insurancePickerOptions},model:{value:e.form.estimatedWorkingTime,callback:function(t){e.$set(e.form,"estimatedWorkingTime",t)},expression:"form.estimatedWorkingTime"}})],1),t("h3",{staticClass:"row-title mb-4"},[e._v("中斷系統")]),t("el-form-item",{staticClass:"mb-4",attrs:{label:"滅火系統",prop:"break_Work_System"}},[t("div",{staticClass:"form-group d-flex align-items-center mb-3"},[t("label",{staticClass:"fs-6"},[e._v("3.1.1 水系統")]),t("el-checkbox-group",{staticClass:"ms-3 d-flex flex-wrap",model:{value:e.form.break_Work_System,callback:function(t){e.$set(e.form,"break_Work_System",t)},expression:"form.break_Work_System"}},[t("el-checkbox",{staticClass:"d-flex",attrs:{label:"自動撒水設備"}}),t("el-checkbox",{staticClass:"d-flex",attrs:{label:"水霧滅火設備"}}),t("el-checkbox",{staticClass:"d-flex",attrs:{label:"室內外消防栓設備"}})],1)],1),t("div",{staticClass:"form-group d-flex align-items-center mb-3"},[t("label",{staticClass:"fs-6"},[e._v("3.1.2 泡沫系統")]),t("el-checkbox-group",{staticClass:"ms-3 d-flex flex-wrap",model:{value:e.form.break_Work_System,callback:function(t){e.$set(e.form,"break_Work_System",t)},expression:"form.break_Work_System"}},[t("el-checkbox",{staticClass:"d-flex",attrs:{label:"泡沫滅火設備"}})],1)],1),t("div",{staticClass:"form-group d-flex align-items-center mb-3"},[t("label",{staticClass:"fs-6"},[e._v("3.1.3 氣體系統")]),t("el-checkbox-group",{staticClass:"ms-3 d-flex flex-wrap",model:{value:e.form.break_Work_System,callback:function(t){e.$set(e.form,"break_Work_System",t)},expression:"form.break_Work_System"}},[t("el-checkbox",{staticClass:"d-flex",attrs:{label:"二氧化碳滅火設備"}}),t("el-checkbox",{staticClass:"d-flex",attrs:{label:"烹調區簡易自動滅火設備"}}),t("el-checkbox",{staticClass:"d-flex",attrs:{label:"生成設備二氧化碳自動滅火設備"}})],1)],1),t("div",{staticClass:"form-group d-flex align-items-center mb-3"},[t("label",{staticClass:"fs-6"},[e._v("3.1.4 其他")]),t("el-checkbox-group",{staticClass:"ms-3",on:{change:e.breakWorkOtherHandler},model:{value:e.form.break_Work_Other_checkbox,callback:function(t){e.$set(e.form,"break_Work_Other_checkbox",t)},expression:"form.break_Work_Other_checkbox"}},[t("el-checkbox",{staticClass:"d-flex",attrs:{label:"其他，請列舉"}})],1),t("el-form-item",{staticClass:"mb-0",attrs:{prop:"break_Work_Other"}},[t("el-input",{staticClass:"ms-2",attrs:{placeholder:"請輸入",disabled:!e.form.break_Work_Other_checkbox},on:{input:e.breakWorkInputHandler},model:{value:e.form.SidProjectDailyInsurance.break_Work_Other,callback:function(t){e.$set(e.form.SidProjectDailyInsurance,"break_Work_Other",t)},expression:"form.SidProjectDailyInsurance.break_Work_Other"}})],1)],1)]),t("el-form-item",{staticClass:"mb-2",attrs:{label:"影響區域",prop:"effect_Area_Type"}},[t("div",{staticClass:"directions"},[e._v("至少需標明樓層、柱拉，或設備之 I.D ：")]),t("el-checkbox-group",{model:{value:e.form.effect_Area_Type,callback:function(t){e.$set(e.form,"effect_Area_Type",t)},expression:"form.effect_Area_Type"}},[t("el-checkbox",{attrs:{label:"FAB"}}),t("el-checkbox",{attrs:{label:"SUP"}}),t("el-checkbox",{attrs:{label:"Office"}}),t("el-checkbox",{attrs:{label:"CUB"}}),t("el-checkbox",{attrs:{label:"其他"}})],1)],1),t("el-form-item",{staticClass:"d-flex align-items-center",attrs:{label:"影響區域說明：",prop:"effect_Area_Remark"}},[t("el-input",{attrs:{placeholder:"請輸入說明"},model:{value:e.form.effect_Area_Remark,callback:function(t){e.$set(e.form,"effect_Area_Remark",t)},expression:"form.effect_Area_Remark"}})],1),t("el-form-item",[t("label",[e._v("中斷說明")]),t("el-form-item",{staticClass:"mb-3",attrs:{prop:"SidProjectDailyInsurance.break_Work_Reason"}},[t("div",{staticClass:"directions"},[e._v("中斷原因及施工目的：")]),e.form.SidProjectDailyInsurance?t("el-input",{attrs:{type:"textarea"},model:{value:e.form.SidProjectDailyInsurance.break_Work_Reason,callback:function(t){e.$set(e.form.SidProjectDailyInsurance,"break_Work_Reason",t)},expression:"form.SidProjectDailyInsurance.break_Work_Reason"}}):e._e()],1),t("el-form-item",{staticClass:"mb-3",attrs:{prop:"SidProjectDailyInsurance.fire_Replace_Plan"}},[t("div",{staticClass:"directions"},[e._v("消防替代方案：")]),e.form.SidProjectDailyInsurance?t("el-input",{attrs:{type:"textarea"},model:{value:e.form.SidProjectDailyInsurance.fire_Replace_Plan,callback:function(t){e.$set(e.form.SidProjectDailyInsurance,"fire_Replace_Plan",t)},expression:"form.SidProjectDailyInsurance.fire_Replace_Plan"}}):e._e()],1),t("el-form-item",{staticClass:"mb-3",attrs:{prop:"SidProjectDailyInsurance.break_Work_Explain"}},[t("div",{staticClass:"directions"},[e._v("中斷施工說明：")]),e.form.SidProjectDailyInsurance?t("el-input",{attrs:{type:"textarea"},model:{value:e.form.SidProjectDailyInsurance.break_Work_Explain,callback:function(t){e.$set(e.form.SidProjectDailyInsurance,"break_Work_Explain",t)},expression:"form.SidProjectDailyInsurance.break_Work_Explain"}}):e._e()],1),t("el-form-item",{staticClass:"mb-3",attrs:{label:"公告單號",prop:"company_Bbs_Id"}},[t("el-input",{staticClass:"w-50 me-3",attrs:{disabled:!e.form.company_Bbs_Id_Check},model:{value:e.form.company_Bbs_Id,callback:function(t){e.$set(e.form,"company_Bbs_Id",t)},expression:"form.company_Bbs_Id"}}),t("a",{staticClass:"link",attrs:{href:"http://pbulletin.cminl.oa/MainPage/Apply.aspx?ID=USER所KEY的公告單號",target:"_blank"}},[e._v("公告單號連結")])],1),t("el-checkbox-group",{model:{value:e.form.company_Bbs_Id_Check,callback:function(t){e.$set(e.form,"company_Bbs_Id_Check",t)},expression:"form.company_Bbs_Id_Check"}},[t("el-checkbox",{staticClass:"d-flex mt-2",attrs:{label:"申請單位已確實公告，並知會中斷受影響區域之單位最高主管(如廠長、廠務部主管等)，並宣告本區為禁止動火區 (若不清楚公告單號請聯繫發包工程師)"},on:{change:function(t){return e.companyBbsIdHandler()}}})],1)],1)],1)],1)})),1)],1)],1)})),1)],1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:3}},[t("h3",{staticClass:"row-title"},[e._v("施工人員")])]),t("el-col",{attrs:{span:21}},[t("el-form-item",{attrs:{label:"規範宣導",prop:"normAdvocacy"}},[t("el-checkbox",{staticClass:"d-flex",model:{value:e.form.normAdvocacy,callback:function(t){e.$set(e.form,"normAdvocacy",t)},expression:"form.normAdvocacy"}},[e._v("每日施工單申請人已閱讀及暸解群創各廠商施工及防疫措施之規範，並已向所有工作人員宣導遵循。")])],1),t("el-form-item",{attrs:{label:"工作群組名稱",prop:"workgroupName"}},[t("el-checkbox-group",{model:{value:e.form.workgroupName,callback:function(t){e.$set(e.form,"workgroupName",t)},expression:"form.workgroupName"}},e._l(e.workGroupList,(function(r,i){return t("el-checkbox",{key:i,attrs:{label:r.group_Name,disabled:"1"===e.form.Work_Type_Normal},on:{change:function(t){return e.workGroupNameHandler(t,r)}}},[e._v(e._s(r.group_Name)+"("+e._s(r.short_Name)+")")])})),1)],1),t("el-form-item",{attrs:{label:"施工人員",prop:"constructionWorkers"}},[t("ol",{staticClass:"p-0"},[t("li",{staticClass:"directions mb-0"},[t("span",{staticClass:"el-text-success"},[e._v("可選的人員僅限已持有承攬商識別證及保險未逾期的人員，")]),e._v(" 若您要的人選並無出現，請先確認該人員是否已上完課，保險未過期且取得承攬商識別證。 ")]),t("li",{staticClass:"directions mb-0"},[e._v("請自行評估本次(本日)施工進廠所需人數，確實慎選人員 (你可以向發包工程師詢問)")]),t("li",{staticClass:"directions mb-0"},[e._v("欲增加施工人員，請另填每日工作申請表")])]),t("el-checkbox-group",{model:{value:e.form.constructionWorkers,callback:function(t){e.$set(e.form,"constructionWorkers",t)},expression:"form.constructionWorkers"}},e._l(e.canGroupPeople,(function(r,i){return t("el-checkbox",{key:i,attrs:{label:r.id}},[e._v(" "+e._s(r.p_Name)+"("+e._s(r.short_Name)+") ")])})),1)],1)],1)],1)],1)],1)],1),t("div",{staticClass:"position-fixed"},[t("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){return e.resetForm("form")}}},[e._v("重設")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v("送出")])],1)])},o=[],s=(r(7658),{name:"applyDailyJobPermitComponent",data(){return{positionFixedHeight:"",vdrList:{},constructionWorkerList:[],dailyInsuranceData:null,copyForm:{},limitDay:"",projectDate:"",minDate:"",maxDate:"",limitMin:"",limitRange:"",defaultDayRange:"7",insuranceMinDate:"",form:{Apply_Pk:null,Draft:!1,Project_No:"",Area_Pk:"",Area_Name:"",Duty_Id:"",Duty_Name:"",Duty_Tel:"",Safe_Id:"",Safe_Name:"",Work_Date:"",Work_End_Date:"",Work_Content:"",constructionDateRange:[],constructionDate:"",constructionTime:["08:00","18:00"],Begin_Time:"",End_Time:"",Duty_S_Id:"",Safe_S_Id:"",Project_Name:"",Eng_No:"",Eng_Name:"",Eng_Ext_No:"",Location_Id:"",Location_Name:"",Location_Type_Description:"",Supplier_Short_Name:"",Supplier_Tel:"",Floor_Id:"",Location_Type_Id:null,allWorkType:[],All_Work_Type:[],Work_Type_Normal:"0",normAdvocacy:[],workgroupName:[],company_Bbs_Id:"",company_Bbs_Id_Check:!1,effect_Area_Type:[],effect_Area_Remark:"",SidProjectDailyInsurance:{insurance_no:"",apply_Pk:"",project_No:"",apply_Date:"",location_Id:"",location_Name:"",s_Id:"",s_Name:"",duty_Id:"",duty_Name:"",duty_Tel:"",begin_Work_Date:"",end_Work_Date:"",begin_Work_Time:"",end_Work_Time:"",break_Work_System:"",break_Work_Other:"",fire_Replace_Plan:"",break_Work_Explain:"",create_Date:null,create_By:null,emp_No:"",dept_Name:"",tel1:"",effect_Area_Type:[],effect_Area_Remark:"",break_Work_Reason:"",company_Bbs_Id:"",retired:"",retired_Date:"",enter:"",enter_Date:"",enter_By:"",retired_By:""},Can_Group_Persons:[],constructionWorkers:[],insurance_no:"",estimatedWorkingTime:[],break_Work_System:[],break_Work_Other:"",break_Work_Other_checkbox:!1,break_Work_Reason:"",fire_Replace_Plan:"",break_Work_Explain:""},rules:{Duty_Id:[{required:!0,message:"必填",trigger:"change"}],Safe_Id:[{required:!1,message:"必填",trigger:"change"}],constructionDate:[{required:!1,trigger:"blur"}],constructionDateRange:[{required:!1,trigger:"blur"}],constructionTime:[{required:!0,message:"必填",trigger:"blur"}],Area_Pk:[{required:!0,message:"必填",trigger:"change"}],Work_Content:[{required:!0,message:"必填",trigger:"blur"}],Work_Type_Normal:[{required:!0,message:"必填",trigger:"change"}],normAdvocacy:[{required:!0,message:"必填",trigger:"change"}],workgroupName:[{required:!1,message:"必填",trigger:"change"}],constructionWorkers:[{required:!0,message:"必填",trigger:"change"}],allWorkType:[{required:!1,message:"必填",trigger:"change"}],insurance_no:[{required:!1,message:"必填",trigger:"change"}],estimatedWorkingTime:[{required:!1,message:"必填",trigger:"change"}],break_Work_System:[{required:!1,message:"必填",trigger:"change"}],effect_Area_Type:[{required:!1,message:"必填",trigger:"change"}],effect_Area_Remark:[{required:!1,message:"必填",trigger:"change"}],SidProjectDailyInsurance:{break_Work_Reason:[{required:!1,message:"必填",trigger:"change"}],fire_Replace_Plan:[{required:!1,message:"必填",trigger:"change"}],break_Work_Explain:[{required:!1,message:"必填",trigger:"change"}]},break_Work_Other:[{required:!1,message:"必填",trigger:"blur"}],company_Bbs_Id:[{required:!1,message:"必填",trigger:"blur"}],input3_1:[{required:!1,trigger:"blur"}],input3_2:[{required:!1,trigger:"blur"}],input4_1:[{required:!1,trigger:"blur"}],input4_2:[{required:!1,trigger:"blur"}],input4_3:[{required:!1,trigger:"blur"}],input4_4:[{required:!1,trigger:"blur"}],input5_1:[{required:!1,trigger:"blur"}],input7_1:[{required:!1,trigger:"blur"}],input9_1:[{required:!1,trigger:"blur"}],input11_1:[{required:!1,trigger:"blur"}]},pickerOptions:{disabledDate:e=>{this.maxDay.find((e=>1===e.flag))?this.limitDay=this.maxDay.find((e=>1===e.flag)):this.limitDay=this.maxDay.find((e=>0===e.flag)),this.projectDate=this.maxDay.find((e=>2===e.flag)).max_Day;const t=this.formatDate(new Date);if("1"===this.form.Work_Type_Normal){if(0===this.limitDay.flag){const r=(new Date).getTime()+864e5*(this.limitDay.max_Day-1);return e.getTime()>r||e.getTime()<new Date(t).getTime()||e.getTime()>new Date(this.projectDate).getTime()}return e.getTime()>new Date(this.limitDay.max_Day).getTime()||e.getTime()<new Date(t).getTime()||e.getTime()>new Date(this.projectDate).getTime()}if(this.maxDate||(this.maxDate=this.projectDate),0===this.limitDay.flag){const r=(new Date).getTime()+864e5*(this.limitDay.max_Day-1);return e.getTime()<this.limitMin||e.getTime()>r||e.getTime()>this.maxDate||e.getTime()<new Date(t).getTime()||e.getTime()>new Date(this.projectDate).getTime()}return e.getTime()<this.limitMin||e.getTime()>this.maxDate||e.getTime()>new Date(this.limitDay.max_Day).getTime()||e.getTime()<new Date(t).getTime()||e.getTime()>new Date(this.projectDate).getTime()},onPick:({minDate:e})=>{this.minDate=e,this.minDate&&(0===this.limitDay.flag?(Number(this.limitDay.max_Day)>=Number(this.defaultDayRange)?this.limitRange=this.defaultDayRange:this.limitRange=this.limitDay.max_Day,this.limitMin=this.minDate.getTime()-24*(this.limitRange-1)*3600*1e3,this.maxDate=e.getTime()+24*(this.limitRange-1)*3600*1e3):(this.limitMin=this.minDate.getTime()-24*(this.defaultDayRange-1)*3600*1e3,this.maxDate=e.getTime()+24*(this.defaultDayRange-1)*3600*1e3))}},insurancePickerOptions:{disabledDate:e=>{const t=this.formatDate(new Date),r=new Date(this.insuranceMinDate).getTime(),i=new Date(this.formatDate(this.insuranceMinDate)).getTime()+5184e5;return e.getTime()<r||e.getTime()>i||e.getTime()<new Date(t).getTime()},onPick:({minDate:e})=>{this.insuranceMinDate=e}},highRiskType:[],dutyPeople:[],dailyInsurance:[],secondWorkArea:[],work_Group_List:[],canGroupPeople:[],sidSupplier:{},maxDay:[]}},computed:{high_Risk_type(){let e=this.highRiskType.reduce(((e,t)=>{let r=e.findIndex((e=>e.class_Name==t.class_Name));return-1!==r?e[r].value.push({class_Name:t.class_Name,work_Type_Pk:t.work_Type_Pk,work_Type_Name:t.work_Type_Name,description:t.description,approve_Item:t.approve_Item,approve_She_Area:t.approve_She_Area,extra_Common:t.extra_Common,disable:t.disable,disabled:!1}):e.push({class_Name:t.class_Name,value:[{class_Name:t.class_Name,work_Type_Pk:t.work_Type_Pk,work_Type_Name:t.work_Type_Name,description:t.description,approve_Item:t.approve_Item,approve_She_Area:t.approve_She_Area,extra_Common:t.extra_Common,disable:t.disable,disabled:!1}]}),e}),[]);return e},workGroupList(){let e=[...this.work_Group_List];const t=new Set,r=e.filter((e=>!t.has(e.group_Name)&&t.add(e.group_Name)));return r}},methods:{async getInit(){const e=await this.$store.dispatch("getInit",{prjNo:this.vdrList.project_No}),t=e.data.data;this.highRiskType=t.high_Risk_type,this.dutyPeople=t.duty_People,this.dailyInsurance=t.daily_Insurance,this.secondWorkArea=t.second_Work_Area,this.work_Group_List=t.work_Group_List,this.canGroupPeople=t.can_Group_People,this.sidSupplier=t.sid_Supplier,this.maxDay=t.max_Day,this.canGroupPeople.forEach(((e,t)=>e.id=`${e.id}-${t}`))},goBack(){this.$router.go(-1)},constructionDateChange(){this.minDate=new Date((new Date).getTime()-864e5),this.limitMin=new Date((new Date).getTime()-864e5),this.maxDate=this.projectDate},breakWorkOtherHandler(e){e?(this.rules.break_Work_Other=[{required:!0,message:"必填",trigger:"blur"}],this.$refs.form.validateField("break_Work_Other")):(this.rules.break_Work_Other=[],this.form.SidProjectDailyInsurance.break_Work_Other="",this.$refs.form.clearValidate("break_Work_Other"))},breakWorkInputHandler(e){e?(this.rules.break_Work_Other=[],this.$refs.form.clearValidate("break_Work_Other")):(this.rules.break_Work_Other=[{required:!0,message:"必填",trigger:"blur"}],this.$refs.form.validateField("break_Work_Other"))},changeLicenseInput(e){this.$refs.form.clearValidate(e),this.rules[e]=[]},getKeyByValue(e,t){return Object.keys(e).filter((r=>e[r]===t))},async getChkLicense(e){try{const t=await this.$store.dispatch("chkLicense",e);if(t.data.isOK)return!0;{const e=Object.keys(this.$refs.form.model).filter((e=>e.includes("input"))).reduce(((e,t)=>Object.assign(e,{[t]:this.$refs.form.model[t]})),{});return String(t.data.data).split(",").forEach((t=>{const r=this.getKeyByValue(e,t);r.forEach((e=>{this.rules[e]=[{validator:function(e,t,r){r(new Error("證號錯誤"))},trigger:"blur"}],this.$refs.form.validateField(e)}))})),!1}}catch(t){console.log(t)}},workTypeNormalHandler(){this.$refs.form.clearValidate("Work_Type_Normal"),"0"===this.form.Work_Type_Normal?(this.rules.constructionDateRange=[{required:!0,message:"必填",trigger:"blur"}],this.rules.constructionDate=[{required:!1,trigger:"blur"}],this.form.constructionDate="",this.form.All_Work_Type=[],this.rules.allWorkType=[{required:!1,trigger:"change"}]):(this.rules.constructionDate=[{required:!0,message:"必填",trigger:"blur"}],this.rules.constructionDateRange=[{required:!1,trigger:"blur"}],this.form.constructionDateRange="",this.rules.allWorkType=[{required:!0,message:"必填",trigger:"change"}])},companyBbsIdHandler(){this.form.company_Bbs_Id_Check?(this.rules.company_Bbs_Id=[{required:!0,message:"必填",trigger:"change"}],this.$refs.form.validateField("company_Bbs_Id")):(this.form.company_Bbs_Id="",this.rules.company_Bbs_Id=[],this.$refs.form.clearValidate("company_Bbs_Id"))},workGroupNameHandler(e,t){if(e){const e=t.ids;this.canGroupPeople.forEach((t=>{-1!==e.indexOf(t.id.split("-")[0])&&this.form.constructionWorkers.push(t.id)}))}},insuranceNoHandler(e){const t=this.dailyInsuranceData.find((t=>t.insurance_no===e));this.form.SidProjectDailyInsurance=t,this.$set(this.form.estimatedWorkingTime,[0],t.begin_Work_Time),this.$set(this.form.estimatedWorkingTime,[1],t.end_Work_Time),this.form.break_Work_System=t.break_Work_System.split(","),this.form.effect_Area_Type=t.effect_Area_Type.split(","),t.break_Work_Other&&(this.form.break_Work_Other_checkbox=!0),t.company_Bbs_Id&&(this.form.company_Bbs_Id_Check=!0)},highRiskTypeChange(e,t){if("200310150003"===e.work_Type_Pk&&t){this.rules.SidProjectDailyInsurance.break_Work_Reason=[{required:!0,message:"必填",trigger:"change"}],this.rules.SidProjectDailyInsurance.fire_Replace_Plan=[{required:!0,message:"必填",trigger:"change"}],this.rules.SidProjectDailyInsurance.break_Work_Explain=[{required:!0,message:"必填",trigger:"change"}],this.rules.effect_Area_Type=[{required:!0,message:"必填",trigger:"change"}];const e=[...this.dailyInsurance],t=new Date(this.form.constructionDate).getTime(),r=new Date(this.form.constructionDate).getTime(),i=this.vdrList.s_Id,o=this.form.Duty_Id.split("-")[0];this.dailyInsuranceData=e.filter((e=>new Date(e.begin_Work_Date).getTime()<=t&&new Date(e.end_Work_Date).getTime()>=r&&e.duty_Id===o&&e.s_Id===i))}else this.rules.company_Bbs_Id=[],this.rules.effect_Area_Type=[],this.rules.insurance_no=[],this.rules.SidProjectDailyInsurance.break_Work_Reason=[{required:!1,trigger:"blur"}],this.rules.SidProjectDailyInsurance.fire_Replace_Plan=[{required:!1,trigger:"blur"}],this.rules.SidProjectDailyInsurance.break_Work_Explain=[{required:!1,trigger:"blur"}];"201103160001"===e.work_Type_Pk&&t?(this.rules.input3_1=[{required:!0,message:"必填",trigger:"blur"}],this.$refs.form.validateField("input3_1")):"201103160001"!==e.work_Type_Pk||t?"202104200001"===e.work_Type_Pk&&t?(this.rules.input3_2=[{required:!0,message:"必填",trigger:"blur"}],this.$refs.form.validateField("input3_2")):"202104200001"!==e.work_Type_Pk||t?"200310150005"===e.work_Type_Pk&&t?(this.rules.input4_1=[{required:!1,trigger:"blur"}],this.rules.input4_2=[{required:!0,message:"必填",trigger:"blur"}],this.rules.input4_3=[{required:!0,message:"必填",trigger:"blur"}],this.rules.input4_4=[{required:!0,message:"必填",trigger:"blur"}],this.$refs.form.validateField("input4_1"),this.$refs.form.validateField("input4_2"),this.$refs.form.validateField("input4_3"),this.$refs.form.validateField("input4_4")):"200310150005"!==e.work_Type_Pk||t?"200310150001"===e.work_Type_Pk&&t?(this.rules.input5_1=[{required:!0,message:"必填",trigger:"blur"}],this.$refs.form.validateField("input5_1")):"200310150001"!==e.work_Type_Pk||t?"200801090001"===e.work_Type_Pk&&t?(this.rules.input7_1=[{required:!1,trigger:"blur"}],this.$refs.form.validateField("input7_1"),this.$message({type:"warning",duration:5e3,showClose:!0,message:"您已申請interlock by pass，此作業具嚴重危害性，請提供「變更管制查核表」及「interlock By pass施工單申請紀錄」予INNOLUX發包工程單位，由發包工程師提出「安全防護裝置變更申請」，經核准後進行作業。"})):"200801090001"!==e.work_Type_Pk||t?"200310150006"===e.work_Type_Pk&&t?(this.rules.input9_1=[{required:!0,message:"必填",trigger:"blur"}],this.$refs.form.validateField("input9_1")):"200310150006"!==e.work_Type_Pk||t?"200403220001"===e.work_Type_Pk&&t?(this.rules.input11_1=[{required:!0,message:"必填",trigger:"blur"}],this.$refs.form.validateField("input11_1")):"200403220001"!==e.work_Type_Pk||t?("200310010002"===e.work_Type_Pk&&t||"201005250001"===e.work_Type_Pk&&t)&&this.$message({type:"warning",duration:5e3,showClose:!0,message:"請考慮是否需加選[警報偵測訊號隔離]"}):(this.rules.input11_1=[{required:!1,trigger:"blur"}],this.$refs.form.clearValidate("input11_1"),this.form.input11_1=""):(this.rules.input9_1=[{required:!1,trigger:"blur"}],this.$refs.form.clearValidate("input9_1"),this.form.input9_1=""):(this.rules.input7_1=[{required:!1,trigger:"blur"}],this.$refs.form.clearValidate("input7_1"),this.form.input7_1=""):(this.rules.input5_1=[{required:!1,trigger:"blur"}],this.$refs.form.clearValidate("input5_1"),this.form.input5_1=""):(this.rules.input4_1=[{required:!1,trigger:"blur"}],this.rules.input4_2=[{required:!1,trigger:"blur"}],this.rules.input4_3=[{required:!1,trigger:"blur"}],this.rules.input4_4=[{required:!1,trigger:"blur"}],this.$refs.form.clearValidate("input4_1"),this.$refs.form.clearValidate("input4_2"),this.$refs.form.clearValidate("input4_3"),this.$refs.form.clearValidate("input4_4"),this.form.input4_1="",this.form.input4_2="",this.form.input4_3="",this.form.input4_4=""):(this.rules.input3_2=[{required:!1,trigger:"blur"}],this.$refs.form.clearValidate("input3_2"),this.form.input3_2=""):(this.rules.input3_1=[{required:!1,trigger:"blur"}],this.$refs.form.clearValidate("input3_1"),this.form.input3_1="")},getDutyName(e){if(!e)return;const t=this.dutyPeople.find((t=>t.id===e)).p_Name;return t},getDutyTel(e){if(!e)return;const t=this.dutyPeople.find((t=>t.id===e)).tel1;return t},getSafeName(e){if(!e)return;const t=this.dutyPeople.find((t=>t.id===e)).p_Name;return t},getAreaName(e){if(!e)return;const t=this.secondWorkArea.find((t=>t.id===e)).description;return t},getSid(e){if(!e)return;const t=this.dutyPeople.find((t=>t.id===e)).s_Id;return t},getWorkTypeName(e){if(!e)return;const t=this.highRiskType.find((t=>t.work_Type_Pk===e)).work_Type_Name;return t},getWorkTypeDescription(e){if(!e)return;const t=this.highRiskType.find((t=>t.work_Type_Pk===e)).description;return t},getWorkTypeClassName(e){if(!e)return;const t=this.highRiskType.find((t=>t.work_Type_Pk===e)).class_Name;return t},getWorkTypeApproveSheArea(e){if(!e)return;const t=this.highRiskType.find((t=>t.work_Type_Pk===e)).approve_She_Area;return t},getWorkTypeApproveItem(e){if(!e)return;const t=this.highRiskType.find((t=>t.work_Type_Pk===e)).approve_Item;return t},getGroupPeopleCourseId(e){const t=this.canGroupPeople.find((t=>t.id===e)).course_Id;return t},getGroupPeopleGroupName(e){const t=this.canGroupPeople.find((t=>t.id===e)).group_Name;return t},getGroupPeopleId(e){const t=this.canGroupPeople.find((t=>t.id===e)).id;return t.split("-")[0]},getGroupPeoplePName(e){const t=this.canGroupPeople.find((t=>t.id===e)).p_Name;return t},getGroupPeopleSId(e){let t=this.canGroupPeople.find((t=>t.id===e)).s_Id;return t},getGroupPeopleState(e){const t=this.canGroupPeople.find((t=>t.id===e)).state;return t},allWorkTypeHandler(){this.form.allWorkType.length?(this.form.All_Work_Type=[],this.form.allWorkType.forEach((e=>{const t={class_Name:this.getWorkTypeClassName(e),work_Type_Pk:e,work_Type_Name:this.getWorkTypeName(e),description:this.getWorkTypeDescription(e),approve_Item:this.getWorkTypeApproveItem(e),approve_She_Area:this.getWorkTypeApproveSheArea(e),extra_Common:""};this.copyForm.All_Work_Type.push(t);const r=new Set;this.copyForm.All_Work_Type=this.copyForm.All_Work_Type.filter((e=>!r.has(e.work_Type_Pk)&&r.add(e.work_Type_Pk))),"200310150003"!==e&&(this.copyForm.SidProjectDailyInsurance=null)}))):this.copyForm.SidProjectDailyInsurance=null},input3SetDraftValue(e){e.All_Work_Type.forEach((e=>{"201103160001"===e.work_Type_Pk&&(this.form.input3_1=e.extra_Common),"202104200001"===e.work_Type_Pk&&(this.form.input3_2=e.extra_Common)}))},input4SetDraftValue(e){e.All_Work_Type.forEach((e=>{"200310150005"===e.work_Type_Pk&&(this.form.input4_1=e.extra_Common.split(";")[0],this.form.input4_2=e.extra_Common.split(";")[1],this.form.input4_3=e.extra_Common.split(";")[2],this.form.input4_4=e.extra_Common.split(";")[3])}))},input5SetDraftValue(e){e.All_Work_Type.forEach((e=>{"200310150001"===e.work_Type_Pk&&(this.form.input5_1=e.extra_Common)}))},input7SetDraftValue(e){e.All_Work_Type.forEach((e=>{"200801090001"===e.work_Type_Pk&&(this.form.input7_1=e.extra_Common)}))},input9SetDraftValue(e){e.All_Work_Type.forEach((e=>{"200310150006"===e.work_Type_Pk&&(this.form.input9_1=e.extra_Common)}))},input11SetDraftValue(e){e.All_Work_Type.forEach((e=>{"200403220001"===e.work_Type_Pk&&(this.form.input11_1=e.extra_Common)}))},input3SetValue(){this.copyForm.input3_1&&this.copyForm.All_Work_Type.forEach((e=>{"201103160001"===e.work_Type_Pk&&(e.extra_Common=this.copyForm.input3_1)})),this.copyForm.input3_2&&this.copyForm.All_Work_Type.forEach((e=>{"202104200001"===e.work_Type_Pk&&(e.extra_Common=this.copyForm.input3_2)}))},input4SetValue(){this.copyForm.input4_1&&this.copyForm.All_Work_Type.forEach((e=>{"200310150005"===e.work_Type_Pk&&(e.extra_Common=`${this.copyForm.input4_1};${this.copyForm.input4_2};${this.copyForm.input4_3};${this.copyForm.input4_4}`)}))},input5SetValue(){this.copyForm.input5_1&&this.copyForm.All_Work_Type.forEach((e=>{"200310150001"===e.work_Type_Pk&&(e.extra_Common=this.copyForm.input5_1)}))},input7SetValue(){this.copyForm.input7_1&&this.copyForm.All_Work_Type.forEach((e=>{"200801090001"===e.work_Type_Pk&&(e.extra_Common=this.copyForm.input7_1)}))},input9SetValue(){this.copyForm.input9_1&&this.copyForm.All_Work_Type.forEach((e=>{"200310150006"===e.work_Type_Pk&&(e.extra_Common=this.copyForm.input9_1)}))},input11SetValue(){this.copyForm.input11_1&&this.copyForm.All_Work_Type.forEach((e=>{"200403220001"===e.work_Type_Pk&&(e.extra_Common=this.copyForm.input11_1)}))},dutySetValue(){this.copyForm.Duty_Id&&(this.copyForm.Duty_Name=this.getDutyName(this.copyForm.Duty_Id.split("-")[0]),this.copyForm.Duty_Tel=this.getDutyTel(this.copyForm.Duty_Id.split("-")[0]),this.copyForm.Duty_S_Id=this.getSid(this.copyForm.Duty_Id.split("-")[0]))},safeSetValue(){this.copyForm.Safe_Id&&(this.copyForm.Safe_Name=this.getSafeName(this.copyForm.Safe_Id.split("-")[0]),this.copyForm.Safe_S_Id=this.getSid(this.copyForm.Safe_Id.split("-")[0]))},areaPkSetValue(){this.copyForm.Area_Pk&&(this.copyForm.Area_Name=this.getAreaName(this.copyForm.Area_Pk))},theFireSet(){if("0"===this.copyForm.Work_Type_Normal)this.copyForm.SidProjectDailyInsurance=null,this.copyForm.Work_Date=this.copyForm.constructionDateRange[0],this.copyForm.Work_End_Date=this.copyForm.constructionDateRange[1];else{const e=this.copyForm.allWorkType;e.length&&-1!==e.indexOf("200310150003")&&(this.copyForm.SidProjectDailyInsurance=this.form.SidProjectDailyInsurance,this.copyForm.SidProjectDailyInsurance.insurance_no=this.form.insurance_no,this.copyForm.SidProjectDailyInsurance.effect_Area_Remark=this.form.effect_Area_Remark,this.copyForm.SidProjectDailyInsurance.duty_Id=this.copyForm.Duty_Id.split("-")[0],this.copyForm.SidProjectDailyInsurance.duty_Name=this.getDutyName(this.copyForm.Duty_Id.split("-")[0]),this.copyForm.SidProjectDailyInsurance.duty_Tel=this.getDutyTel(this.copyForm.Duty_Id.split("-")[0]),this.copyForm.estimatedWorkingTime&&(this.copyForm.SidProjectDailyInsurance.begin_Work_Date=this.copyForm.estimatedWorkingTime[0],this.copyForm.SidProjectDailyInsurance.begin_Work_Time=this.copyForm.estimatedWorkingTime[0],this.copyForm.SidProjectDailyInsurance.end_Work_Date=this.copyForm.estimatedWorkingTime[1],this.copyForm.SidProjectDailyInsurance.end_Work_Time=this.copyForm.estimatedWorkingTime[1]),this.copyForm.SidProjectDailyInsurance.company_Bbs_Id=this.copyForm.company_Bbs_Id,this.copyForm.break_Work_System.length&&(this.copyForm.SidProjectDailyInsurance.break_Work_System=this.copyForm.break_Work_System.join(",")),this.copyForm.effect_Area_Type.length&&(this.copyForm.SidProjectDailyInsurance.effect_Area_Type=this.copyForm.effect_Area_Type.join(","))),this.copyForm.Work_Date=this.copyForm.constructionDate,this.copyForm.Work_End_Date=this.copyForm.constructionDate}},constructionTimeSet(){this.copyForm.constructionTime.length&&(this.copyForm.Begin_Time=this.copyForm.constructionTime[0],this.copyForm.End_Time=this.copyForm.constructionTime[1])},constructionWorkersSet(){this.copyForm.constructionWorkers.length&&(this.copyForm.Can_Group_Persons=[],this.copyForm.constructionWorkers.forEach((e=>{let t={id:this.getGroupPeopleId(e),s_Id:this.getGroupPeopleSId(e),group_Name:this.getGroupPeopleGroupName(e),p_Name:this.getGroupPeoplePName(e),state:this.getGroupPeopleState(e),course_Id:this.getGroupPeopleCourseId(e)};this.copyForm.Can_Group_Persons.push(t)})))},fireWorkRules(e){if(e.All_Work_Type.length){const t=e.All_Work_Type.some((e=>"200310150003"===e.work_Type_Pk));t&&(e.SidProjectDailyInsurance.company_Bbs_Id&&(this.rules.company_Bbs_Id=[{required:!0,message:"必填",trigger:"blur"}]),this.rules.effect_Area_Type=[{required:!0,message:"必填",trigger:"change"}],this.rules.insurance_no=[{required:!0,message:"必填",trigger:"blur"}])}},setForm(){this.copyForm=Object.assign({},this.form),this.copyForm.Project_No=this.vdrList.project_No,this.copyForm.Project_Name=this.vdrList.project_Name,this.copyForm.Eng_No=this.vdrList.emp_No,this.copyForm.Eng_Name=this.vdrList.emp_Name,this.copyForm.Eng_Ext_No=this.vdrList.emp_Extension_No,this.copyForm.Location_Id=this.vdrList.lid,this.copyForm.Location_Name=this.vdrList.ld2,this.copyForm.Location_Type_Description=this.vdrList.ld4,this.copyForm.Supplier_Short_Name=this.sidSupplier.short_Name,this.copyForm.Supplier_Tel=this.sidSupplier.tel,this.copyForm.Floor_Id=this.vdrList.fab_Id,this.copyForm.Floor_Id=this.vdrList.fab_Id;let e=[];this.form.constructionWorkers.forEach((t=>{e.push(t.split("-")[0])})),"1"===this.copyForm.Work_Type_Normal?(this.allWorkTypeHandler(),this.input3SetValue(),this.input4SetValue(),this.input5SetValue(),this.input7SetValue(),this.input9SetValue(),this.input11SetValue()):this.copyForm.All_Work_Type=[],this.theFireSet(),this.dutySetValue(),this.safeSetValue(),this.areaPkSetValue(),this.constructionTimeSet(),this.constructionWorkersSet()},submitForm(e){this.setForm(),this.$refs[e].validate((async e=>{if(e)try{const e=[];let r=["x"],i=[];i.push(this.form.input3_1,this.form.input3_2,this.form.input4_1,this.form.input4_2,this.form.input4_3,this.form.input4_4,this.form.input5_1,this.form.input7_1,this.form.input9_1,this.form.input11_1),this.form.constructionWorkers.forEach((t=>{this.canGroupPeople.forEach((e=>{t===e.id&&r.push(e.s_Id)})),e.push(t.split("-")[0])})),i=i.filter((e=>void 0!==e&&""!==e)),r.push(this.vdrList.s_Id);const o={d:e,d2:r.toString(),d3:i},s=Object.keys(this.$refs.form.model).filter((e=>e.includes("input"))).reduce(((e,t)=>Object.assign(e,{[t]:this.$refs.form.model[t]})),{});Object.keys(s).forEach((e=>this.changeLicenseInput(e)));var t=JSON.parse(JSON.stringify(o));const a=this.copyForm.All_Work_Type.some((e=>"200310150005"===e.work_Type_Pk||"200801090001"===e.work_Type_Pk));if(a){let e=[];e.push(this.form.input3_1,this.form.input3_2,this.form.input4_2,this.form.input4_3,this.form.input4_4,this.form.input5_1,this.form.input9_1,this.form.input11_1),e=e.filter((e=>void 0!==e&&""!==e)),t.d3=e}let n=!0;if("1"===this.form.Work_Type_Normal&&(n=await this.getChkLicense(t,"")),n){this.copyForm.Duty_Id=this.copyForm.Duty_Id.split("-")[0],this.copyForm.Safe_Id=this.copyForm.Safe_Id.split("-")[0],this.copyForm.Can_Group_Persons.forEach((e=>e.id=e.id.split("-")[0]));const e=await this.$store.dispatch("insData",this.copyForm);e.data.isOK&&(this.$message({type:"success",duration:5e3,showClose:!0,message:"申請成功"}),this.$router.push({name:"dailyJobApplication"}))}else this.$message({type:"error",duration:5e3,showClose:!0,message:"證號有誤"})}catch(r){console.log(r)}else this.$message({type:"error",duration:5e3,showClose:!0,message:"資料填寫錯誤"})}))},groupFormDailyInsurance(){if(this.dailyInsurance.length)return;const e={insurance_no:"",apply_Pk:null,project_No:this.vdrList.project_No,apply_Date:null,location_Id:this.vdrList.lid,location_Name:this.vdrList.ld2,s_Id:this.sidSupplier.s_Id,s_Name:this.sidSupplier.s_Name,duty_Id:"",duty_Name:"",duty_Tel:"",begin_Work_Date:"",end_Work_Date:"",begin_Work_Time:"",end_Work_Time:"",break_Work_System:"",break_Work_Other:"",fire_Replace_Plan:"",break_Work_Explain:"",create_Date:null,create_By:null,emp_No:null,dept_Name:null,tel1:null,effect_Area_Type:[],effect_Area_Remark:"",break_Work_Reason:"",company_Bbs_Id:"",retired:null,retired_Date:null,enter:null,enter_Date:null,enter_By:null,retired_By:null};this.form.SidProjectDailyInsurance=e},resetForm(e){this.$refs[e].resetFields()}},async mounted(){this.vdrList=JSON.parse(this.$route.params.obj),await this.getInit(),this.groupFormDailyInsurance(),this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0;const e=document.querySelector(".position-fixed"),t=e.offsetHeight;this.positionFixedHeight=`${t}px`}}),a=s,n=r(1001),l=(0,n.Z)(a,i,o,!1,null,"227594ea",null),c=l.exports}}]);
//# sourceMappingURL=8341.6194df218192a7a0.js.map