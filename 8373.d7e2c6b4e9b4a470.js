"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[8373],{7163:function(e,t,a){a.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"upload"},[t("el-upload",{ref:"Upload",staticClass:"upload-demo",attrs:{limit:e.limitNumber,action:e.uploadAction,"auto-upload":!1,"on-change":e.changeHandler,"on-remove":e.removeHandler}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上傳檔案")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.uploadTipText))])],1)],1)},s=[],l=a(942),i={name:"upload-component",data(){return{}},props:{uploadTipText:{type:[String],default:"檔案格式為PDF，在2MB以內"},uploadAction:{type:[String],default:l.apiUrl},limitNumber:{type:Number,default:1}},methods:{changeHandler(e,t){this.$emit("fileChangeHandler",t)},removeHandler(e,t){this.$emit("fileRemoveHandler",t)}},mounted(){}},o=i,n=a(1001),m=(0,n.Z)(o,r,s,!1,null,"442b61f1",null),c=m.exports},8373:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:this.$root.overlay,expression:"this.$root.overlay",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"wrapper"},[t("h2",{staticClass:"form-title"},[e._v("新增證照資料")]),t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[t("el-row",[t("el-col",{staticClass:"px-1",staticStyle:{"margin-right":"20px"},attrs:{span:6}},[t("el-form-item",{attrs:{label:"身份證字號",prop:"Id"}},[t("el-input",{model:{value:e.form.Id,callback:function(t){e.$set(e.form,"Id",t)},expression:"form.Id"}})],1)],1),t("el-col",{staticClass:"px-1",attrs:{span:6}},[t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1),t("el-row",[t("el-col",{staticClass:"px-1",attrs:{span:6}},[t("el-form-item",{attrs:{label:"證照類別",prop:"License_Pk"}},[t("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.form.License_Pk,callback:function(t){e.$set(e.form,"License_Pk",t)},expression:"form.License_Pk"}},e._l(e.typeList,(function(e){return t("el-option",{key:e.LICENSE_PK,attrs:{label:e.LICENSE_TYPE,value:e.LICENSE_PK}})})),1)],1)],1)],1),t("el-row",[t("el-col",{staticClass:"px-1",staticStyle:{"margin-right":"20px"},attrs:{span:6}},[t("el-form-item",{attrs:{label:"證照初訓日期",prop:"Begin_Data"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"選擇日期","value-format":"yyyy/MM/dd"},model:{value:e.form.Begin_Data,callback:function(t){e.$set(e.form,"Begin_Data",t)},expression:"form.Begin_Data"}})],1)],1),t("el-col",{staticClass:"px-1",attrs:{span:6}},[t("el-form-item",{attrs:{label:"證照有效截止日期",prop:"End_Data"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"選擇日期","value-format":"yyyy/MM/dd"},model:{value:e.form.End_Data,callback:function(t){e.$set(e.form,"End_Data",t)},expression:"form.End_Data"}})],1)],1)],1),t("el-row",[t("el-col",{staticClass:"px-1",attrs:{span:6}},[t("el-form-item",{attrs:{label:"證照號碼",prop:"License_Id"}},[t("el-input",{model:{value:e.form.License_Id,callback:function(t){e.$set(e.form,"License_Id",t)},expression:"form.License_Id"}})],1)],1)],1),t("el-form-item",{attrs:{label:"初訓證照上傳",prop:"file"}},[t("Upload",{ref:"fileRef",attrs:{uploadTipText:"初訓檔案上傳後即無法刪除，欲刪除請通知安衛部人員"},on:{fileChangeHandler:e.fileHandleChange,fileRemoveHandler:e.fileHandleRemove},model:{value:e.form.file,callback:function(t){e.$set(e.form,"file",t)},expression:"form.file"}})],1)],1),t("div",{staticClass:"btn-group mt-3"},[t("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){return e.resetForm("form")}}},[e._v("重設")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v("送出")])],1)],1)},s=[],l=a(7163),i={name:"addLicenseInformation-component",components:{Upload:l.Z},data(){return{form:{Id:"",name:"",License_Pk:"",Begin_Data:"",End_Data:"",License_Id:"",file:""},rules:{Id:[{required:!0,message:"必填",trigger:"blur"},{validator:this.validateCard,trigger:"blur"}],name:[{required:!0,message:"必填",trigger:"blur"}],License_Pk:[{required:!0,message:"必填",trigger:"change"}],Begin_Data:[{required:!0,message:"必填",trigger:"change"}],End_Data:[{required:!0,message:"必填",trigger:"change"},{validator:this.validateDate,trigger:"change"}],License_Id:[{required:!0,message:"必填 ",trigger:"blur"}],file:[{required:!0,message:"必填",trigger:"change"}]}}},computed:{typeList(){return this.$store.state.license_type}},methods:{validateCard(e,t,a){let r=this.$store.state.license_people.filter((e=>e.id==t));r.length?(this.form.name=r[0].p_Name,a()):a(new Error("查無人員資料，請確認該身份證字號已建立"))},validateDate(e,t,a){let r=new Date(t).getTime()/1e3,s=new Date,l=new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime()/1e3;r<l?a(new Error("證照有效期限已過期")):a()},fileHandleChange(e){this.form.file=e[0].raw,this.$refs.form.clearValidate("file")},fileHandleRemove(){this.form.file="",this.$refs.fileRef.$refs.Upload.clearFiles(),this.$refs.form.validateField("file")},resetForm(e){this.$refs[e].resetFields(),this.$refs.fileRef.$refs.Upload.clearFiles()},submitForm(e){let t=this.$store.state.license_people.filter((e=>e.id==this.form.Id&&e.p_Name==this.form.name));if(t.length){let t=new Date(this.form.Begin_Data).getTime()/1e3,a=new Date(this.form.End_Data).getTime()/1e3;t>=a?this.$message({type:"error",showClose:!0,message:"證照有效截止日期需大於證照初證日期"}):this.$refs[e].validate((async t=>{if(t){let t=this.changeFormData(this.form);try{const a=await this.$store.dispatch("addLicenseInfo",t);a.data.isOK&&(this.$message({type:"success",duration:5e3,showClose:!0,message:"新增成功"}),this.resetForm(e))}catch(a){console.log(a)}}else this.$message({type:"error",duration:"5000",showClose:!0,message:"資料填寫錯誤"})}))}else this.$message({type:"error",showClose:!0,message:"人員資料有誤，請確認輸入內容"})}},async mounted(){this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0;try{await this.$store.dispatch("getLicenseFormInfo")}catch(e){console.log(e)}}},o=i,n=a(1001),m=(0,n.Z)(o,r,s,!1,null,null,null),c=m.exports}}]);
//# sourceMappingURL=8373.d7e2c6b4e9b4a470.js.map