"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[5270],{4865:function(e,t,r){r.d(t,{Z:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:e.totalLength,"current-page":e.currentPage},on:{"current-change":e.changePage}})],1)},o=[],s={name:"pagination1-component",props:["totalLength"],computed:{currentPage(){return this.$store.state.currentPage}},methods:{changePage(e){this.$emit("changePageHandler",e)}},mounted(){}},i=s,n=r(1001),l=(0,n.Z)(i,a,o,!1,null,"86225bf4",null),u=l.exports},1919:function(e,t,r){r.d(t,{Z:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"table-responsive"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.data,"row-key":e.getRowKeys,"default-sort":{prop:"id",order:"ascending"},"empty-text":"查無資料","cell-class-name":e.rowStyleHandler,border:"","highlight-current-row":""},on:{"selection-change":e.selectChangeHandler}},[e._t("custom-selection"),e._t("custom-checkbox1"),e._t("custom-checkbox2"),e._l(e.tableColumns,(function(r,a){return t("el-table-column",{key:a,attrs:{prop:r.id,label:r.label,width:r.width,sortable:"date"===r.id},scopedSlots:e._u([{key:"default",fn:function(a){return["status"===r.id?t("el-tag",{attrs:{type:"簽核通過"===a.row.status||"審核通過"===a.row.status?"success":"拒絕申請"===a.row.status?"danger":"草稿"===a.row.status?"warning":"查無資料"}},[e._v(" "+e._s(a.row.status)+" ")]):"status_Id"===r.id?t("el-tag",{attrs:{type:"OPEN"===a.row.status_Id?"":"CLOSE"===a.row.status_Id?"danger":"FULL"===a.row.status_Id?"warning":"success"}},[e._v(" "+e._s(e.getCourseState(a.row.status_Id))+" ")]):"description2"===r.id?t("el-tag",{attrs:{type:"有效課程"===a.row.description?"":"danger"}},[e._v(" "+e._s(a.row.description)+" ")]):"approve_Status"===r.id?t("el-tag",{attrs:{type:"0"===a.row.approve_Status?"":"1"===a.row.approve_Status?"success":"danger"}},[e._v(" "+e._s(e.getApproveStatus(a.row.approve_Status))+" ")]):"approve_Status2"===r.id?t("el-tag",{attrs:{type:"審核中"===a.row.approve_Status2||"未審核"===a.row.approve_Status2?"":"審核完畢"===a.row.approve_Status2||"審核同意"===a.row.approve_Status2?"success":"danger"}},[e._v(" "+e._s(a.row.approve_Status2)+" ")]):"attend_Status"===r.id?t("el-tag",{attrs:{type:"0"===a.row.attend_Status?"":"1"===a.row.attend_Status?"success":"danger"}},[e._v(" "+e._s(e.getAttendStatus(a.row.attend_Status))+" ")]):"issue_Card"===r.id?t("el-tag",{attrs:{type:"0"===a.row.issue_Card?"":"1"===a.row.issue_Card?"success":"danger"}},[e._v(" "+e._s(e.getIssueCardStatus(a.row.issue_Card))+" ")]):"signUpStatus"===r.id?t("el-tag",{attrs:{type:"已結案"===e.signUpStatus(a.row.signUpStatus,a.row.approveStatus)?"success":"可取消報名"===e.signUpStatus(a.row.signUpStatus,a.row.approveStatus)?"danger":""}},[e._v(" "+e._s(e.signUpStatus(a.row.signUpStatus,a.row.approveStatus))+" ")]):"file_Name"===r.id||"d_File_Name"===r.id?t("a",{attrs:{href:"#"},on:{click:function(t){return e.downloadPdf(a.row)}}},[e._v(e._s(a.row[r.id]))]):"protocolInfo"===r.id?t("div",[t("div",[e._v(e._s(a.row.po_Name))]),e._l(a.row.files,(function(r){return t("div",[t("a",{attrs:{href:"#"},on:{click:function(t){return e.downloadPdf(r)}}},[e._v(e._s(r.file_Name))])])}))],2):"useable"===r.id&&"已刪除(廠商不可申請每日工單)"===a.row.useable?t("span",{staticStyle:{color:"red"}},[e._v(e._s(a.row.useable))]):"deleted"===r.id?t("span",{class:{"text-danger":"1"===a.row.deleted}},[e._v(" "+e._s(a.row.effect)+" ")]):"array_data"===r.id?t("span",e._l(a.row[r.id],(function(r,a){return t("p",{key:a,staticClass:"mb-0"},[e._v(e._s(r))])})),0):RegExp(/\n/).test(a.row[a.column.property])?t("span",{staticStyle:{"white-space":"pre-wrap"}},[e._v(" "+e._s(a.row[r.id])+" ")]):t("span",[e._v(e._s(a.row[r.id]))])]}}],null,!0)})})),e._t("custom-edit-select"),e._t("custom-switch"),e._t("custom-function"),e._t("slot-sheet-open")],2)],1)},o=[],s={name:"table-component",props:["data","tableColumns"],data(){return{api:this.apiUrl,loading:!0}},methods:{selectChangeHandler(e){this.$emit("selectionChange",e)},downloadPdf(e){const t=e.file_Id;this.$emit("downloadPdfHandler",t),this.$emit("downloadPdfHandler2",e)},getRowKeys(e){return e.index?e.index:e.id},rowStyleHandler(e){if("1"===e.row.isWeekend||"1"===e.row.isNight)return"fontColorBlue"}},mounted(){this.data&&(this.loading=!1)}},i=s,n=r(1001),l=(0,n.Z)(i,a,o,!1,null,"4a0f1604",null),u=l.exports},5270:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:this.$root.overlay,expression:"this.$root.overlay",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"wrapper"},[t("el-button",{staticClass:"goBack",attrs:{type:"text"},on:{click:function(t){return e.goBack()}}},[t("i",{staticClass:"el-icon-back me-1"}),e._v("回上頁 ")]),t("h2",{staticClass:"form-title"},[e._v("管理會員")]),t("el-card",{staticClass:"mb-4",attrs:{shadow:"never"}},[t("el-form",{ref:"queryForm",attrs:{model:e.queryForm,rules:e.rules}},[t("div",{staticClass:"form-group mb-3"},[t("label",{attrs:{for:""}},[e._v("當前協議組織：")]),t("span",[e._v(e._s(e.organizeData.po_Name))])]),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{staticClass:"me-3",attrs:{label:"承攬商編號",prop:"S_ID"}},[t("el-input",{attrs:{clearable:"",placeholder:"請輸入內容"},model:{value:e.queryForm.S_ID,callback:function(t){e.$set(e.queryForm,"S_ID",t)},expression:"queryForm.S_ID"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"承攬商名稱",prop:"S_NAME"}},[t("el-input",{attrs:{clearable:"",placeholder:"請輸入內容"},model:{value:e.queryForm.S_NAME,callback:function(t){e.$set(e.queryForm,"S_NAME",t)},expression:"queryForm.S_NAME"}})],1)],1)],1),t("el-form-item",{attrs:{label:"當前狀態",prop:"valid"}},[t("el-radio-group",{model:{value:e.queryForm.valid,callback:function(t){e.$set(e.queryForm,"valid",t)},expression:"queryForm.valid"}},[t("el-radio",{attrs:{label:"1",value:"1"}},[e._v("有效")]),t("el-radio",{attrs:{label:"0",value:"0"}},[e._v("無效")])],1)],1),t("el-form-item",{attrs:{label:"資格",prop:"authorization"}},[t("el-checkbox-group",{model:{value:e.queryForm.authorization,callback:function(t){e.$set(e.queryForm,"authorization",t)},expression:"queryForm.authorization"}},[t("el-checkbox",{attrs:{label:"F",value:"F"}},[e._v("主包")]),t("el-checkbox",{attrs:{label:"S",value:"S"}},[e._v("下包")])],1)],1),t("el-form-item",{attrs:{label:"入會時間",prop:"inDate"}},[t("el-date-picker",{attrs:{"value-format":"yyyy/MM/dd",type:"daterange","range-separator":"～","start-placeholder":"開始日期","end-placeholder":"結束日期"},model:{value:e.queryForm.inDate,callback:function(t){e.$set(e.queryForm,"inDate",t)},expression:"queryForm.inDate"}})],1),t("el-form-item",{attrs:{label:"退會時間",prop:"outDate"}},[t("el-date-picker",{attrs:{"value-format":"yyyy/MM/dd",type:"daterange","range-separator":"～","start-placeholder":"開始日期","end-placeholder":"結束日期"},model:{value:e.queryForm.outDate,callback:function(t){e.$set(e.queryForm,"outDate",t)},expression:"queryForm.outDate"}})],1)],1),t("div",{staticClass:"mt-4"},[t("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){return e.resetForm("queryForm")}}},[e._v("重設")]),t("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){return e.exportProtocal()}}},[e._v("匯出EXCEL")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitForm("queryForm")}}},[e._v("查詢會員")])],1)],1),t("h2",{staticClass:"form-title"},[e._v("會員清單")]),t("div",{staticClass:"d-flex mb-3"},[e.selectedMember.length?t("div",{staticClass:"selected-box me-auto"},[t("span",{staticClass:"me-2"},[e._v("已選 "+e._s(e.selectedMember.length)+" 項")]),[t("el-popconfirm",{attrs:{title:"確定要刪除嗎？","cancel-button-type":"plain"},on:{confirm:function(t){return e.deleteHandler()}}},[t("el-button",{attrs:{slot:"reference",size:"small",type:"danger"},slot:"reference"},[e._v("刪除")])],1)]],2):e._e(),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.createMemberHandler()}}},[e._v("新增會員 ")])],1),t("TableComponent",{ref:"TableComponent",attrs:{data:e.tableList,tableColumns:e.tableColumns},on:{selectionChange:e.changeSelection},scopedSlots:e._u([{key:"custom-selection",fn:function(){return[t("el-table-column",{attrs:{type:"selection",width:"75","reserve-selection":!0}})]},proxy:!0},{key:"custom-function",fn:function(){return[t("el-table-column",{staticClass:"function-column",attrs:{prop:"function",fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"修改",placement:"top-start"}},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.editHandler(r.row)}}},[t("i",{staticClass:"el-icon-edit-outline"})])],1)]}}])})]},proxy:!0}])}),t("Pagination1",{attrs:{totalLength:e.tableData.length},on:{changePageHandler:e.changePage}}),t("el-dialog",{attrs:{title:"修改會員資料",visible:e.dialogVisible,width:"40%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"memberInfoForm",attrs:{model:e.memberInfoForm,rules:e.memberInfoRules}},[t("div",{staticClass:"form-group d-flex mb-3"},[t("div",{staticClass:"form-group me-4"},[t("label",{attrs:{for:""}},[e._v("承攬商編號：")]),t("span",[e._v(e._s(e.memberInfoForm.s_Id))])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v("承攬商名稱：")]),t("span",[e._v(e._s(e.memberInfoForm.s_Name))])])]),t("div",{staticClass:"form-group d-flex mb-3"},[t("div",{staticClass:"form-group me-4"},[t("label",{attrs:{for:""}},[e._v("電話：")]),t("span",[e._v(e._s(e.memberInfoForm.tel))])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v("負責人: ")]),t("span",[e._v(e._s(e.memberInfoForm.key_Man))])])]),t("el-form-item",{staticClass:"mb-2",attrs:{label:"組別",prop:"group"}},[t("el-checkbox",{staticClass:"px-3",attrs:{disabled:""},model:{value:e.memberInfoForm.group,callback:function(t){e.$set(e.memberInfoForm,"group",t)},expression:"memberInfoForm.group"}},[e._v("一般承攬商")])],1),t("el-form-item",{staticClass:"mb-0",attrs:{label:"資格",prop:"authorization"}},[t("el-checkbox-group",{model:{value:e.memberInfoForm.authorization,callback:function(t){e.$set(e.memberInfoForm,"authorization",t)},expression:"memberInfoForm.authorization"}},[t("el-checkbox",{staticClass:"px-3",attrs:{label:"F",value:"F"}},[e._v("主包")]),t("el-checkbox",{attrs:{label:"S",value:"S"}},[e._v("下包")])],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitDialog("memberInfoForm")}}},[e._v("確定")])],1)],1)],1)},o=[],s=(r(7658),r(1919)),i=r(4865),n={name:"memberManagementComponent",components:{TableComponent:s.Z,Pagination1:i.Z},data(){return{organizeData:{},obj:{},queryForm:{PO_ID:"",S_ID:"",S_NAME:"",valid:"",authorization:[],IN_DATE1:"",IN_DATE2:"",OUT_DATE1:"",OUT_DATE2:"",inDate:[],outDate:[],ISWORK:"",ISNOTWORK:""},rules:{S_ID:[{required:!1,message:"必填",trigger:"blur"}],S_NAME:[{required:!1,message:"必填",trigger:"blur"}],valid:[{required:!1,message:"必填",trigger:"change"}],authorization:[{required:!1,message:"必填",trigger:"change"}],inDate:[{required:!1,message:"必填",trigger:"change"}],outDate:[{required:!1,message:"必填",trigger:"change"}]},tableColumns:[{id:"index",label:"項次",width:"70"},{id:"s_Id",label:"承攬商編號",width:"150"},{id:"s_Name",label:"承攬商名稱",width:"150"},{id:"in_Date",label:"入會日期",width:"150"},{id:"out_Date",label:"退會日期",width:"150"},{id:"Status",label:"當前狀態",width:"150"},{id:"qualifications",label:"資格分類",width:"150"}],selectedMember:[],dialogVisible:!1,memberInfoForm:{s_Id:"",s_Name:"",tel:"",key_Man:"",group:!0,authorization:[]},memberInfoRules:{group:[{required:!0,message:"必填",trigger:"change"}],authorization:[{required:!1,message:"必填",trigger:"change"}]},tableData:[],tableList:[],work_Group:{}}},computed:{},methods:{async exportProtocal(){this.queryForm.PO_ID=this.organizeData.po_id;let e=JSON.stringify(this.queryForm),t=e.replace(/""/g,null),r=JSON.parse(t);try{const e=await this.$store.dispatch("exportProtocal",r),t=URL.createObjectURL(e.data),a=document.createElement("a");a.href=t,a.setAttribute("download",`${this.organizeData.po_Name}.xlsx`),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}catch(a){console.log(a)}},goBack(){this.$router.go(-1)},resetForm(e){this.$refs[e].resetFields()},setForm(){this.queryForm.inDate||(this.queryForm.inDate=[]),this.queryForm.outDate||(this.queryForm.outDate=[]),this.queryForm.inDate.length?(this.queryForm.IN_DATE1=this.queryForm.inDate[0],this.queryForm.IN_DATE2=this.queryForm.inDate[1]):(this.queryForm.IN_DATE1="",this.queryForm.IN_DATE2=""),this.queryForm.outDate.length?(this.queryForm.OUT_DATE1=this.queryForm.outDate[0],this.queryForm.OUT_DATE2=this.queryForm.outDate[1]):(this.queryForm.OUT_DATE1="",this.queryForm.OUT_DATE2=""),this.queryForm.authorization.length&&this.queryForm.authorization.includes("F")?this.queryForm.F_AUTHORIZATION="Y":this.queryForm.F_AUTHORIZATION="",this.queryForm.authorization.length&&this.queryForm.authorization.includes("S")?this.queryForm.S_AUTHORIZATION="Y":this.queryForm.S_AUTHORIZATION="",""===this.queryForm.valid?(this.queryForm.ISWORK="",this.queryForm.ISNOTWORK=""):"1"===this.queryForm.valid?(this.queryForm.ISWORK="Y",this.queryForm.ISNOTWORK=""):(this.queryForm.ISWORK="",this.queryForm.ISNOTWORK="Y"),this.queryForm.PO_ID=this.organizeData.po_id},async submitForm(e){this.$refs[e].validate((async e=>{e?(this.$refs.TableComponent.$refs.multipleTable.clearSelection(),this.setForm(),await this.queryMember(this.queryForm)):this.$message({type:"error",duration:5e3,showClose:!0,message:"資料填寫錯誤"})}))},changeSelection(e){this.selectedMember=e,this.selectedMember.forEach((e=>{e.po_Id=this.organizeData.po_id,e.workGroup_Id=this.work_Group.workgroup_Id}))},createMemberHandler(){this.$router.push({name:"createMember",params:{po_Id:this.organizeData.po_id},query:{po_Name:this.organizeData.po_Name}})},async deleteHandler(){const e=await this.$store.dispatch("delMember",this.selectedMember);e.data.isOK&&(this.$message({type:"success",duration:5e3,showClose:!0,message:"刪除成功"}),await this.queryMember(this.obj),this.$store.state.currentPage=1,this.$refs.TableComponent.$refs.multipleTable.clearSelection())},editHandler(e){this.dialogVisible=!0,this.memberInfoForm={...this.memberInfoForm,...e},"Y"===e.f_Authorization&&"Y"===e.S_Authorization?this.memberInfoForm.authorization=["F","S"]:"Y"===e.f_Authorization&&"Y"!==e.S_Authorization?this.memberInfoForm.authorization=["F"]:"Y"!==e.f_Authorization&&"Y"===e.S_Authorization?this.memberInfoForm.authorization=["S"]:this.memberInfoForm.authorization=[],this.memberInfoForm.workGroup_Id=this.work_Group.workgroup_Id,this.memberInfoForm.po_Id=this.organizeData.po_id},handleClose(e){e()},async submitDialog(e){this.$refs[e].validate((async e=>{if(e){this.memberInfoForm.authorization.length?(this.memberInfoForm.authorization.includes("F")?this.memberInfoForm.f_Authorization="Y":this.memberInfoForm.f_Authorization=null,this.memberInfoForm.authorization.includes("S")?this.memberInfoForm.S_Authorization="Y":this.memberInfoForm.S_Authorization=null):(this.memberInfoForm.f_Authorization=null,this.memberInfoForm.S_Authorization=null);const e=await this.$store.dispatch("editMember",this.memberInfoForm);e.data.isOK&&(this.$message({type:"success",duration:5e3,showClose:!0,message:"修改成功"}),this.dialogVisible=!1,await this.queryMember(this.obj),this.$store.state.currentPage=1)}else this.$message({type:"error",duration:5e3,showClose:!0,message:"資料填寫錯誤"})}))},changePage(e){this.$store.state.currentPage=e;const t=10*(e-1),r=10*e;this.tableList=this.tableData.slice(t,r)},async queryMember(e){const t=this.getURLNewParams(e),r=await this.$store.dispatch("queryMember",t),a=r.data.data;this.tableData=JSON.parse(JSON.stringify(a.members)),this.tableData.forEach(((e,t)=>{e.index=t+1,"Y"===e.f_Authorization&&"Y"===e.S_Authorization?e.qualifications="主包 下包":"Y"===e.f_Authorization&&"Y"!==e.S_Authorization?e.qualifications="主包":"Y"!==e.f_Authorization&&"Y"===e.S_Authorization?e.qualifications="下包":e.qualifications=""})),this.tableList=this.tableData.slice(0,10),this.work_Group=a.work_Group}},async mounted(){this.$store.state.currentPage=1,this.organizeData=JSON.parse(this.$route.query.data),this.obj={PO_ID:this.organizeData.po_id,S_ID:"",S_NAME:"",IN_DATE1:"",IN_DATE2:"",OUT_DATE1:"",OUT_DATE2:"",F_AUTHORIZATION:"",S_AUTHORIZATION:"",ISWORK:"",ISNOTWORK:""},this.queryMember(this.obj),this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0}},l=n,u=r(1001),m=(0,u.Z)(l,a,o,!1,null,null,null),c=m.exports}}]);
//# sourceMappingURL=5270.6d90e726b091dd1a.js.map