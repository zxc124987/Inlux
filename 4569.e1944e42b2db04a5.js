"use strict";(self["webpackChunkinnolux"]=self["webpackChunkinnolux"]||[]).push([[4569],{4569:function(t,e,i){i.r(e),i.d(e,{default:function(){return d}});var r=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:this.$root.overlay,expression:"this.$root.overlay",modifiers:{fullscreen:!0,lock:!0}}]},[e("div",{staticClass:"wrapper form-container"},[e("el-button",{staticClass:"goBack",attrs:{type:"text"},on:{click:function(e){return t.goBack()}}},[e("i",{staticClass:"el-icon-back me-1"}),t._v("回上頁 ")]),e("h2",{staticClass:"form-title"},[t._v("修改工程單")]),e("div",{staticClass:"card rounded-1 p-3"},[t._m(0),e("span",{staticClass:"el-text-success mb-4"},[t._v("每一更改，系統自動以電子郵件通知相關人員(主管/上下包廠商)")]),e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-position":"top"}},[e("el-form-item",{attrs:{label:"工程結束時間",prop:"end_Date"}},[t.modifyProjInfoProjectDetail&&t.modifyProjInfoProjectDetail.length?e("div",{staticClass:"directions"},[t._v("原始日期："+t._s(t.modifyProjInfoProjectDetail[0].begin_Date)+" ~ "+t._s(t.modifyProjInfoProjectDetail[0].end_Date)+" "),e("br"),t._v(" 工程施工期限最大為一年，延長工程的結束日期不可超過一年。 ")]):t._e(),e("el-date-picker",{attrs:{"value-format":"yyyy/MM/dd",type:"date",placeholder:"選擇日期"},model:{value:t.form.end_Date,callback:function(e){t.$set(t.form,"end_Date",e)},expression:"form.end_Date"}})],1),e("el-form-item",{attrs:{label:"下包廠商公司",prop:"insSuppiler"}},[e("div",{staticClass:"directions"},[t._v("補加 若無下包商，則免填。"),e("br")]),e("div",{staticClass:"d-flex align-items-center"},[e("el-select",{staticClass:"me-2",attrs:{filterable:"",multiple:"",clearable:"",placeholder:"請搜尋廠商名稱"},model:{value:t.form.insSuppiler,callback:function(e){t.$set(t.form,"insSuppiler",e)},expression:"form.insSuppiler"}},t._l(t.modifyProjInfoSidSupplier,(function(t){return e("el-option",{key:t.s_Id,attrs:{label:t.s_Name,value:t.s_Id}})})),1),e("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.addUnderCompanyLists()}}},[t._v("新增到列表")])],1)]),e("el-form-item",{attrs:{label:"已選擇承攬商列表"}},[e("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:t.modifyProjInfoVendorDetail}},[e("el-table-column",{attrs:{prop:"id",label:"項次",width:"50"}}),e("el-table-column",{attrs:{prop:"s_Status",label:"承攬商型態",width:"100"}}),e("el-table-column",{attrs:{prop:"Compilation",label:"承攬商(統一編號)",width:"400"}}),e("el-table-column",{attrs:{prop:"ableStatus",label:"可用狀態"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-switch",{attrs:{"active-color":"#006BB2","inactive-color":"#ABABAB","active-value":"1","inactive-value":"0"},model:{value:i.row.deleted,callback:function(e){t.$set(i.row,"deleted",e)},expression:"scope.row.deleted"}})]}}])})],1)],1),e("el-form-item",{attrs:{label:"新增承攬商列表"}},[e("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:t.tableData}},[e("el-table-column",{attrs:{prop:"id",label:"項次",width:"50"}}),e("el-table-column",{attrs:{prop:"s_Status",label:"承攬商型態",width:"100"}}),e("el-table-column",{attrs:{prop:"Compilation",label:"承攬商(統一編號)"}})],1)],1),e("el-form-item",{attrs:{label:"每日工作申請單 發包工程師代簽人員",prop:"insSigner"}},[t.modifyProjInfoSigner.length?e("div",{staticClass:"directions mb-1"},[t._v(" 原始資料: "),t._l(t.modifyProjInfoSigner,(function(i,r){return e("span",{key:r,staticClass:"directions"},[t._v(t._s(r+1)+". "+t._s(i.name)+"(工號: "+t._s(i.emp_No)+"/狀態: "+t._s(i.per_State)+")。")])}))],2):t._e(),e("div",{staticClass:"directions"},[t._v("重新指定，最多 3 人")]),e("el-select",{ref:"remote",attrs:{multiple:"",clearable:"",filterable:"",remote:"","multiple-limit":3,"reserve-keyword":"",placeholder:"輸入關鍵字",loading:t.signerLoading,"loading-text":"載入中","no-data-text":"查無資料"},on:{"visible-change":t.visibleHandleChange},nativeOn:{keyup:function(e){return t.signerSearchHandler(e)}},model:{value:t.form.insSigner,callback:function(e){t.$set(t.form,"insSigner",e)},expression:"form.insSigner"}},t._l(t.signerList,(function(t){return e("el-option",{key:t.EMP_NO,attrs:{label:t.customLabel,value:t.EMP_NO}})})),1),e("p",{staticClass:"note mb-0 mt-1"},[t._v(t._s(t.$store.state.remoteSearchNote))])],1),e("div",{staticClass:"table-view"},[e("h3",{staticClass:"table-view-title"},[t._v("工程資料")]),t._l(t.modifyProjInfoProjectDetail,(function(i,r){return e("div",{key:r,staticClass:"table-responsive"},[e("table",{staticClass:"table table-bordered"},[e("tbody",[e("tr",[e("th",[t._v("工程編號/工程名稱")]),e("td",[t._v(t._s(i.project_No)+"/ "+t._s(i.project_Name))])]),e("tr",[e("th",[t._v("開始日期~結束日期")]),e("td",[t._v(t._s(i.begin_Date)+" ~ "+t._s(i.end_Date))])]),e("tr",[e("th",[t._v("工作區域")]),e("td",[t._v(t._s(i.LD1)+"/"+t._s(i.LD2)+"/"+t._s(i.LD3)+"/"+t._s(i.LD4))])]),e("tr",[e("th",[t._v("工程狀態")]),e("td",[t._v(t._s(i.project_Status))])]),e("tr",[e("th",[t._v("建立者/建立日期")]),e("td",[t._v(t._s(i.emp_Name)+"/"+t._s(i.emp_No)+"/("+t._s(i.create_Date)+")")])])])])])}))],2),e("div",{staticClass:"table-view"},[e("h3",{staticClass:"table-view-title"},[t._v("承攬商資料")]),t._l(t.projectVendorDetail,(function(i,r){return e("div",{key:r,staticClass:"table-responsive"},[e("table",{staticClass:"table table-bordered"},[e("tbody",[e("tr",[e("th",[t._v("承攬商型態")]),e("td",{attrs:{colspan:"3"}},[t._v(t._s("S"===i.vendor_Type?"下承包商":"主承包商"))])]),e("tr",[e("th",[t._v("承攬商")]),e("td",{attrs:{colspan:"3"}},[t._v(t._s(i.s_Name))])]),e("tr",[e("th",[t._v("統一編號")]),e("td",[t._v(t._s(i.s_Id))]),e("th",[t._v("聯絡電話")]),e("td",[t._v(t._s(i.tel))])]),e("tr",[e("th",[t._v("電子郵件(Email)/通知")]),e("td",{attrs:{colspan:"3"}},[t._v(t._s(i.email))])])])])])}))],2)],1)],1)],1),e("div",{staticClass:"position-fixed"},[e("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(e){return t.resetForm("form")}}},[t._v("重設")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.submitForm("form")}}},[t._v("送出")])],1)])},a=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-text fw-normal"},[t._v("目前開放可修改項目："),e("br"),t._v(" 延長工程時間、增加下包廠商、更新指定發包工程師審核(代理簽核人員) ")])}],s=(i(7658),{name:"engineeringDataManagementEdit-component",data(){let t=(t,e,i)=>{const r=this.modifyProjInfoProjectDetail[0].begin_Date,a=new Date(e)-new Date(r);r>e||a/864e5>365?i(new Error("結束日不得早於起始日，且施工期限最長為一年")):i()};return{subcontractor:[],signerLoading:!1,signerList:[],form:{prjNo:"",end_Date:"",insSuppiler:[],insSigner:[],chgSuppiler:[]},tableData:[],rules:{end_Date:[{required:!0,message:"必填",trigger:"change"},{validator:t,trigger:"change"}],insSuppiler:[{required:!1,message:"必填",trigger:"change"}]},modifyProjInfoVendorDetail:[],modifyProjInfoProjectDetail:[],modifyProjInfoSidSupplier:[],projectVendorDetail:[],modifyProjInfoSigner:[]}},computed:{},methods:{goBack(){this.$router.go(-1)},resetForm(t){this.$refs[t].resetFields()},submitForm(t){this.form.chgSuppiler=this.modifyProjInfoVendorDetail,this.$refs[t].validate((async t=>{t?this.addChgStateProject():this.$message({type:"error",duration:5e3,showClose:!0,message:"資料填寫錯誤"})}))},async addChgStateProject(){try{await this.$store.dispatch("addChgStateProject",this.form),this.$message({type:"success",duration:5e3,showClose:!0,message:"新增成功"}),this.$router.push({name:"engineeringDataManagement"})}catch(t){console.log(t)}},visibleHandleChange(t){t||(this.signerList=[],this.$refs.remote.query="")},signerSearchHandler(t){if(this.signerLoading=!0,"Enter"===t.code||"NumpadEnter"===t.code){if(this.signerLoading=!1,!t.target.value)return;this.getEditSigner(t.target.value)}},async getEditSigner(t){const e=await this.$store.dispatch("getEditSigner",{query:t,prjNo:this.form.prjNo});this.signerList=e.data.data,this.signerList.forEach((t=>t.customLabel=`${t.EMP_NO}_${t.NAME}`))},addUnderCompanyLists(){this.form.insSuppiler.forEach(((t,e)=>{const i={id:e+1,s_Id:t,s_Status:"下承包商",Compilation:`${this.getSName(t)}(${this.getIeNo(t)})`};this.tableData.push(i);const r=new Set;this.tableData=this.tableData.filter((t=>!r.has(t.s_Id)&&r.add(t.s_Id)))}))},getSName(t){const e=this.modifyProjInfoSidSupplier.find((e=>e.s_Id===t));if(e)return e.s_Name},getIeNo(t){const e=this.modifyProjInfoSidSupplier.find((e=>e.s_Id===t));if(e)return e.s_Id},async getModifyProjInfo(t,e){const i=await this.$store.dispatch("getModifyProjInfo",{prjNo:t,id:e}),r=i.data.data;this.modifyProjInfoVendorDetail=r.vendor_Detail,this.modifyProjInfoVendorDetail.length&&this.modifyProjInfoVendorDetail.forEach(((t,e)=>{t.id=e+1,t.s_Status="下承包商",t.Compilation=`${t.s_Name}(${t.s_Id})`,t.sid=t.s_Id})),this.modifyProjInfoProjectDetail=r.proj_Detail,this.modifyProjInfoSidSupplier=r.sid_Supplier,this.modifyProjInfoSigner=r.signer,this.getProjDetail(t)},async getProjDetail(t){const e=await this.$store.dispatch("getProjDetail",t),i=e.data.data;this.projectVendorDetail=i.vendor_Detail,this.subcontractor=this.projectVendorDetail.filter((t=>"S"===t.vendor_Type))}},async mounted(){const t=this.$route.params.prjNo,e=this.$route.params.id;this.form.prjNo=t,this.getModifyProjInfo(t,e),this.$store.commit("HEADER_HANDLER",!0),this.$store.commit("BREADCRUMB_HANDLER",!0),this.$root.$children[0].sidebarSwitch=!0;const i=document.querySelector(".position-fixed"),r=document.querySelector(".form-container"),a=i.offsetHeight;r.style.marginBottom=`${a}px`}}),o=s,l=i(1001),n=(0,l.Z)(o,r,a,!1,null,"4f9c1969",null),d=n.exports}}]);
//# sourceMappingURL=4569.e1944e42b2db04a5.js.map